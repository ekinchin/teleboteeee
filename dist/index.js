"use strict";

var _http = require("http");

var _https = require("https");

var _url = require("url");

var _events = require("events");

var _httpRequest = _interopRequireDefault(require("./httpRequest"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const eventer = new _events.EventEmitter();
const CMD = {
  setWebHook: 'setWebhook',
  getUpdates: 'getUpdates',
  sendMessage: 'sendMessage'
};
const token = '674082318:AAG4e5AXQu_SbJkYSVji4chwaiggtGrMLBc';
const telegramUrl = new _url.URL('https://api.telegram.org');
console.log(telegramUrl);
telegramUrl.pathname = `bot${token}/${CMD.sendMessage}`;

async function sendHttpRequest_(urlReq, headers, dataReq, method) {
  return new Promise((resolve, reject) => {
    const options = {
      hostname: urlReq.hostname,
      port: 443,
      path: urlReq.pathname + urlReq.search
    };
    options.method = method;
    options.headers = headers;

    const req = _https.https.request(options, res => {
      let answer = '';
      res.on('data', dataRes => {
        answer += dataRes;
      });
      res.on('end', () => {
        resolve(answer);
      });
      res.on('error', () => {
        reject(answer);
      });
    });

    if (options.headers !== undefined) {
      if ('Content-Type' in options.headers) {
        if (options.headers['Content-Type'] === 'application/json') {
          req.write(JSON.stringify(dataReq));
        }
      }
    }

    req.end();
  });
}

const yaApi = {
  getLocation: async city => {
    const geoUrl = new url.URL('https://geocode-maps.yandex.ru');
    geoUrl.pathname = '/1.x/';
    geoUrl.searchParams.append('format', 'json');
    geoUrl.searchParams.append('results', '1');
    geoUrl.searchParams.append('geocode', city);
    const geoLocation = await (0, _httpRequest.default)(geoUrl, {}, null, 'GET');
    const geoLocationParse = JSON.parse(geoLocation);
    let cityParse;
    let lon;
    let lat;

    if (geoLocationParse.response.GeoObjectCollection.metaDataProperty.GeocoderResponseMetaData.found !== '0') {
      cityParse = geoLocationParse.response.GeoObjectCollection.featureMember[0].GeoObject.metaDataProperty.GeocoderMetaData.text;
      [lon, lat] = geoLocationParse.response.GeoObjectCollection.featureMember[0].GeoObject.Point.pos.split(' ');
    }

    return [cityParse || city, lon || 0, lat || 0];
  },
  getWeather: async (lon, lat) => {
    const weatherUrl = new url.URL('https://api.weather.yandex.ru');
    weatherUrl.pathname = '/v1/informers';
    weatherUrl.searchParams.append('lang', 'ru_RU');
    weatherUrl.searchParams.append('lat', lat);
    weatherUrl.searchParams.append('lon', lon);
    const weatherHeader = {
      'X-Yandex-API-Key': '40f0e52b-168d-40a4-ba38-0c2bf4d98726'
    };
    let weather = await (0, _httpRequest.default)(weatherUrl, weatherHeader, null, 'GET');
    weather = JSON.parse(weather);
    return [weather.fact.temp, weather.fact.feels_like, weather.fact.wind_speed];
  }
};
const botCommands = {
  '/start': {
    descripion: 'Начать работу с ботом',
    handler: async (chatId, data) => {
      const answer = `Hello, ${data.message.from.first_name}`;
      await (0, _httpRequest.default)(telegramUrl, {
        'Content-Type': 'application/json'
      }, {
        method: CMD.sendMessage,
        chat_id: chatId,
        text: answer
      }, 'POST');
    }
  },
  '/help': {
    descripion: 'Помощь',
    handler: async chatId => {
      const answer = '/start - поздороваться\n/weather - текущая погода\n/help - эта справка';
      await (0, _httpRequest.default)(telegramUrl, {
        'Content-Type': 'application/json'
      }, {
        method: CMD.sendMessage,
        chat_id: chatId,
        text: answer
      }, 'POST');
    }
  },
  '/weather': {
    descripion: 'Погода',
    handler: async (chatId, data) => {
      let city = 'Tyumen';
      let lat = 57;
      let lon = 65;
      let answer = '';

      if (data.message.text.split(' ')[1] !== undefined) {
        [city, lon, lat] = await yaApi.getLocation(data.message.text.split(' ')[1]);
      }

      if (lon !== 0 || lat !== 0) {
        const [temp, tempFeel, wind] = await yaApi.getWeather(lon, lat);
        answer = `Погода в: ${city}\n` + `Текущая температура: ${temp}\n` + `Ощущается как: ${tempFeel}\n` + `Ветер: ${wind}`;
      } else {
        answer = 'Не удалось найти город';
      }

      await (0, _httpRequest.default)(telegramUrl, {
        'Content-Type': 'application/json'
      }, {
        method: CMD.sendMessage,
        chat_id: chatId,
        text: answer
      }, 'POST');
    }
  },
  undefined: {
    descripion: 'Неизвестная команда',
    handler: async chatId => {
      const answer = 'Неизвестная команда, воспользуйтесь справкой /help';
      await (0, _httpRequest.default)(telegramUrl, {
        'Content-Type': 'application/json'
      }, {
        method: CMD.sendMessage,
        chat_id: chatId,
        text: answer
      }, 'POST');
    }
  }
};

function reqParse(data) {
  const dataParse = JSON.parse(data);
  const entities = dataParse.message.entities[0] || '';

  if (entities.type === 'bot_command') {
    switch (dataParse.message.text.split(' ')[0].toLowerCase()) {
      case '/start':
      case '/help':
      case '/weather':
        eventer.emit(dataParse.message.text.split(' ')[0].toLowerCase(), dataParse.message.chat.id, dataParse);
        break;

      default:
        eventer.emit('undefined', dataParse.message.chat.id);
        break;
    }
  }

  return 0;
}

async function Server() {
  console.log(_http.http);

  const server = _http.http.createServer();

  server.listen(process.env.PORT);
  server.on('request', (request, response) => {
    let requestData = '';
    request.on('data', data => {
      requestData += data;
    });
    request.on('end', () => {
      reqParse(requestData);
      response.end();
    });
  });
}

eventer.on('/weather', botCommands['/weather'].handler);
eventer.on('/start', botCommands['/start'].handler);
eventer.on('/help', botCommands['/help'].handler);
eventer.on('undefined', botCommands.undefined.handler);
const setWebHookUrl = new _url.URL('https://api.telegram.org/');
setWebHookUrl.pathname = `bot${token}${CMD.setWebHook}`;
setWebHookUrl.searchParams.append('url', 'https://teleboteeee.herokuapp.com/');
(0, _httpRequest.default)(setWebHookUrl, {}, null, 'GET').then(Server);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJldmVudGVyIiwiRXZlbnRFbWl0dGVyIiwiQ01EIiwic2V0V2ViSG9vayIsImdldFVwZGF0ZXMiLCJzZW5kTWVzc2FnZSIsInRva2VuIiwidGVsZWdyYW1VcmwiLCJVUkwiLCJjb25zb2xlIiwibG9nIiwicGF0aG5hbWUiLCJzZW5kSHR0cFJlcXVlc3RfIiwidXJsUmVxIiwiaGVhZGVycyIsImRhdGFSZXEiLCJtZXRob2QiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsIm9wdGlvbnMiLCJob3N0bmFtZSIsInBvcnQiLCJwYXRoIiwic2VhcmNoIiwicmVxIiwiaHR0cHMiLCJyZXF1ZXN0IiwicmVzIiwiYW5zd2VyIiwib24iLCJkYXRhUmVzIiwidW5kZWZpbmVkIiwid3JpdGUiLCJKU09OIiwic3RyaW5naWZ5IiwiZW5kIiwieWFBcGkiLCJnZXRMb2NhdGlvbiIsImNpdHkiLCJnZW9VcmwiLCJ1cmwiLCJzZWFyY2hQYXJhbXMiLCJhcHBlbmQiLCJnZW9Mb2NhdGlvbiIsImdlb0xvY2F0aW9uUGFyc2UiLCJwYXJzZSIsImNpdHlQYXJzZSIsImxvbiIsImxhdCIsInJlc3BvbnNlIiwiR2VvT2JqZWN0Q29sbGVjdGlvbiIsIm1ldGFEYXRhUHJvcGVydHkiLCJHZW9jb2RlclJlc3BvbnNlTWV0YURhdGEiLCJmb3VuZCIsImZlYXR1cmVNZW1iZXIiLCJHZW9PYmplY3QiLCJHZW9jb2Rlck1ldGFEYXRhIiwidGV4dCIsIlBvaW50IiwicG9zIiwic3BsaXQiLCJnZXRXZWF0aGVyIiwid2VhdGhlclVybCIsIndlYXRoZXJIZWFkZXIiLCJ3ZWF0aGVyIiwiZmFjdCIsInRlbXAiLCJmZWVsc19saWtlIiwid2luZF9zcGVlZCIsImJvdENvbW1hbmRzIiwiZGVzY3JpcGlvbiIsImhhbmRsZXIiLCJjaGF0SWQiLCJkYXRhIiwibWVzc2FnZSIsImZyb20iLCJmaXJzdF9uYW1lIiwiY2hhdF9pZCIsInRlbXBGZWVsIiwid2luZCIsInJlcVBhcnNlIiwiZGF0YVBhcnNlIiwiZW50aXRpZXMiLCJ0eXBlIiwidG9Mb3dlckNhc2UiLCJlbWl0IiwiY2hhdCIsImlkIiwiU2VydmVyIiwiaHR0cCIsInNlcnZlciIsImNyZWF0ZVNlcnZlciIsImxpc3RlbiIsInByb2Nlc3MiLCJlbnYiLCJQT1JUIiwicmVxdWVzdERhdGEiLCJzZXRXZWJIb29rVXJsIiwidGhlbiJdLCJtYXBwaW5ncyI6Ijs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7OztBQUVBLE1BQU1BLE9BQU8sR0FBRyxJQUFJQyxvQkFBSixFQUFoQjtBQUVBLE1BQU1DLEdBQUcsR0FBRztBQUNWQyxFQUFBQSxVQUFVLEVBQUUsWUFERjtBQUVWQyxFQUFBQSxVQUFVLEVBQUUsWUFGRjtBQUdWQyxFQUFBQSxXQUFXLEVBQUU7QUFISCxDQUFaO0FBTUEsTUFBTUMsS0FBSyxHQUFHLCtDQUFkO0FBQ0EsTUFBTUMsV0FBVyxHQUFHLElBQUlDLFFBQUosQ0FBUSwwQkFBUixDQUFwQjtBQUNBQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUgsV0FBWjtBQUNBQSxXQUFXLENBQUNJLFFBQVosR0FBd0IsTUFBS0wsS0FBTSxJQUFHSixHQUFHLENBQUNHLFdBQVksRUFBdEQ7O0FBRUEsZUFBZU8sZ0JBQWYsQ0FBZ0NDLE1BQWhDLEVBQXdDQyxPQUF4QyxFQUFpREMsT0FBakQsRUFBMERDLE1BQTFELEVBQWtFO0FBQ2hFLFNBQU8sSUFBSUMsT0FBSixDQUFZLENBQUNDLE9BQUQsRUFBVUMsTUFBVixLQUFxQjtBQUN0QyxVQUFNQyxPQUFPLEdBQUc7QUFDZEMsTUFBQUEsUUFBUSxFQUFFUixNQUFNLENBQUNRLFFBREg7QUFFZEMsTUFBQUEsSUFBSSxFQUFFLEdBRlE7QUFHZEMsTUFBQUEsSUFBSSxFQUFFVixNQUFNLENBQUNGLFFBQVAsR0FBa0JFLE1BQU0sQ0FBQ1c7QUFIakIsS0FBaEI7QUFLQUosSUFBQUEsT0FBTyxDQUFDSixNQUFSLEdBQWlCQSxNQUFqQjtBQUNBSSxJQUFBQSxPQUFPLENBQUNOLE9BQVIsR0FBa0JBLE9BQWxCOztBQUVBLFVBQU1XLEdBQUcsR0FBR0MsYUFBTUMsT0FBTixDQUFjUCxPQUFkLEVBQXdCUSxHQUFELElBQVM7QUFDMUMsVUFBSUMsTUFBTSxHQUFHLEVBQWI7QUFDQUQsTUFBQUEsR0FBRyxDQUFDRSxFQUFKLENBQU8sTUFBUCxFQUFnQkMsT0FBRCxJQUFhO0FBQzFCRixRQUFBQSxNQUFNLElBQUlFLE9BQVY7QUFDRCxPQUZEO0FBR0FILE1BQUFBLEdBQUcsQ0FBQ0UsRUFBSixDQUFPLEtBQVAsRUFBYyxNQUFNO0FBQ2xCWixRQUFBQSxPQUFPLENBQUNXLE1BQUQsQ0FBUDtBQUNELE9BRkQ7QUFHQUQsTUFBQUEsR0FBRyxDQUFDRSxFQUFKLENBQU8sT0FBUCxFQUFnQixNQUFNO0FBQ3BCWCxRQUFBQSxNQUFNLENBQUNVLE1BQUQsQ0FBTjtBQUNELE9BRkQ7QUFHRCxLQVhXLENBQVo7O0FBWUEsUUFBSVQsT0FBTyxDQUFDTixPQUFSLEtBQW9Ca0IsU0FBeEIsRUFBbUM7QUFDakMsVUFBSSxrQkFBa0JaLE9BQU8sQ0FBQ04sT0FBOUIsRUFBdUM7QUFDckMsWUFBSU0sT0FBTyxDQUFDTixPQUFSLENBQWdCLGNBQWhCLE1BQW9DLGtCQUF4QyxFQUE0RDtBQUMxRFcsVUFBQUEsR0FBRyxDQUFDUSxLQUFKLENBQVVDLElBQUksQ0FBQ0MsU0FBTCxDQUFlcEIsT0FBZixDQUFWO0FBQ0Q7QUFDRjtBQUNGOztBQUNEVSxJQUFBQSxHQUFHLENBQUNXLEdBQUo7QUFDRCxHQTdCTSxDQUFQO0FBOEJEOztBQUVELE1BQU1DLEtBQUssR0FBRztBQUNaQyxFQUFBQSxXQUFXLEVBQUUsTUFBT0MsSUFBUCxJQUFnQjtBQUMzQixVQUFNQyxNQUFNLEdBQUcsSUFBSUMsR0FBRyxDQUFDakMsR0FBUixDQUFZLGdDQUFaLENBQWY7QUFDQWdDLElBQUFBLE1BQU0sQ0FBQzdCLFFBQVAsR0FBa0IsT0FBbEI7QUFDQTZCLElBQUFBLE1BQU0sQ0FBQ0UsWUFBUCxDQUFvQkMsTUFBcEIsQ0FBMkIsUUFBM0IsRUFBcUMsTUFBckM7QUFDQUgsSUFBQUEsTUFBTSxDQUFDRSxZQUFQLENBQW9CQyxNQUFwQixDQUEyQixTQUEzQixFQUFzQyxHQUF0QztBQUNBSCxJQUFBQSxNQUFNLENBQUNFLFlBQVAsQ0FBb0JDLE1BQXBCLENBQTJCLFNBQTNCLEVBQXNDSixJQUF0QztBQUVBLFVBQU1LLFdBQVcsR0FBRyxNQUFNLDBCQUFnQkosTUFBaEIsRUFBd0IsRUFBeEIsRUFBNEIsSUFBNUIsRUFBa0MsS0FBbEMsQ0FBMUI7QUFDQSxVQUFNSyxnQkFBZ0IsR0FBR1gsSUFBSSxDQUFDWSxLQUFMLENBQVdGLFdBQVgsQ0FBekI7QUFDQSxRQUFJRyxTQUFKO0FBQ0EsUUFBSUMsR0FBSjtBQUNBLFFBQUlDLEdBQUo7O0FBQ0EsUUFDRUosZ0JBQWdCLENBQUNLLFFBQWpCLENBQTBCQyxtQkFBMUIsQ0FDR0MsZ0JBREgsQ0FDb0JDLHdCQURwQixDQUVHQyxLQUZILEtBRWEsR0FIZixFQUlFO0FBQ0FQLE1BQUFBLFNBQVMsR0FBR0YsZ0JBQWdCLENBQUNLLFFBQWpCLENBQTBCQyxtQkFBMUIsQ0FBOENJLGFBQTlDLENBQTRELENBQTVELEVBQ1RDLFNBRFMsQ0FDQ0osZ0JBREQsQ0FDa0JLLGdCQURsQixDQUNtQ0MsSUFEL0M7QUFFQSxPQUFDVixHQUFELEVBQU1DLEdBQU4sSUFBYUosZ0JBQWdCLENBQUNLLFFBQWpCLENBQTBCQyxtQkFBMUIsQ0FBOENJLGFBQTlDLENBQTRELENBQTVELEVBQStEQyxTQUEvRCxDQUF5RUcsS0FBekUsQ0FBK0VDLEdBQS9FLENBQW1GQyxLQUFuRixDQUF5RixHQUF6RixDQUFiO0FBQ0Q7O0FBQ0QsV0FBTyxDQUFDZCxTQUFTLElBQUlSLElBQWQsRUFBb0JTLEdBQUcsSUFBSSxDQUEzQixFQUE4QkMsR0FBRyxJQUFJLENBQXJDLENBQVA7QUFDRCxHQXZCVztBQXdCWmEsRUFBQUEsVUFBVSxFQUFFLE9BQU9kLEdBQVAsRUFBWUMsR0FBWixLQUFvQjtBQUM5QixVQUFNYyxVQUFVLEdBQUcsSUFBSXRCLEdBQUcsQ0FBQ2pDLEdBQVIsQ0FBWSwrQkFBWixDQUFuQjtBQUNBdUQsSUFBQUEsVUFBVSxDQUFDcEQsUUFBWCxHQUFzQixlQUF0QjtBQUNBb0QsSUFBQUEsVUFBVSxDQUFDckIsWUFBWCxDQUF3QkMsTUFBeEIsQ0FBK0IsTUFBL0IsRUFBdUMsT0FBdkM7QUFDQW9CLElBQUFBLFVBQVUsQ0FBQ3JCLFlBQVgsQ0FBd0JDLE1BQXhCLENBQStCLEtBQS9CLEVBQXNDTSxHQUF0QztBQUNBYyxJQUFBQSxVQUFVLENBQUNyQixZQUFYLENBQXdCQyxNQUF4QixDQUErQixLQUEvQixFQUFzQ0ssR0FBdEM7QUFDQSxVQUFNZ0IsYUFBYSxHQUFHO0FBQUUsMEJBQW9CO0FBQXRCLEtBQXRCO0FBRUEsUUFBSUMsT0FBTyxHQUFHLE1BQU0sMEJBQWdCRixVQUFoQixFQUE0QkMsYUFBNUIsRUFBMkMsSUFBM0MsRUFBaUQsS0FBakQsQ0FBcEI7QUFDQUMsSUFBQUEsT0FBTyxHQUFHL0IsSUFBSSxDQUFDWSxLQUFMLENBQVdtQixPQUFYLENBQVY7QUFDQSxXQUFPLENBQUNBLE9BQU8sQ0FBQ0MsSUFBUixDQUFhQyxJQUFkLEVBQW9CRixPQUFPLENBQUNDLElBQVIsQ0FBYUUsVUFBakMsRUFBNkNILE9BQU8sQ0FBQ0MsSUFBUixDQUFhRyxVQUExRCxDQUFQO0FBQ0Q7QUFuQ1csQ0FBZDtBQXNDQSxNQUFNQyxXQUFXLEdBQUc7QUFDbEIsWUFBVTtBQUNSQyxJQUFBQSxVQUFVLEVBQUUsdUJBREo7QUFFUkMsSUFBQUEsT0FBTyxFQUNQLE9BQU9DLE1BQVAsRUFBZUMsSUFBZixLQUF3QjtBQUN0QixZQUFNN0MsTUFBTSxHQUFJLFVBQVM2QyxJQUFJLENBQUNDLE9BQUwsQ0FBYUMsSUFBYixDQUFrQkMsVUFBVyxFQUF0RDtBQUNBLFlBQU0sMEJBQWdCdEUsV0FBaEIsRUFBNkI7QUFBRSx3QkFBZ0I7QUFBbEIsT0FBN0IsRUFBcUU7QUFBRVMsUUFBQUEsTUFBTSxFQUFFZCxHQUFHLENBQUNHLFdBQWQ7QUFBMkJ5RSxRQUFBQSxPQUFPLEVBQUVMLE1BQXBDO0FBQTRDZixRQUFBQSxJQUFJLEVBQUU3QjtBQUFsRCxPQUFyRSxFQUFpSSxNQUFqSSxDQUFOO0FBQ0Q7QUFOTyxHQURRO0FBU2xCLFdBQVM7QUFDUDBDLElBQUFBLFVBQVUsRUFBRSxRQURMO0FBRVBDLElBQUFBLE9BQU8sRUFDUCxNQUFPQyxNQUFQLElBQWtCO0FBQ2hCLFlBQU01QyxNQUFNLEdBQUcsd0VBQWY7QUFDQSxZQUFNLDBCQUFnQnRCLFdBQWhCLEVBQTZCO0FBQUUsd0JBQWdCO0FBQWxCLE9BQTdCLEVBQXFFO0FBQUVTLFFBQUFBLE1BQU0sRUFBRWQsR0FBRyxDQUFDRyxXQUFkO0FBQTJCeUUsUUFBQUEsT0FBTyxFQUFFTCxNQUFwQztBQUE0Q2YsUUFBQUEsSUFBSSxFQUFFN0I7QUFBbEQsT0FBckUsRUFBaUksTUFBakksQ0FBTjtBQUNEO0FBTk0sR0FUUztBQWlCbEIsY0FBWTtBQUNWMEMsSUFBQUEsVUFBVSxFQUFFLFFBREY7QUFFVkMsSUFBQUEsT0FBTyxFQUNQLE9BQU9DLE1BQVAsRUFBZUMsSUFBZixLQUF3QjtBQUN0QixVQUFJbkMsSUFBSSxHQUFHLFFBQVg7QUFDQSxVQUFJVSxHQUFHLEdBQUcsRUFBVjtBQUNBLFVBQUlELEdBQUcsR0FBRyxFQUFWO0FBQ0EsVUFBSW5CLE1BQU0sR0FBRyxFQUFiOztBQUNBLFVBQUk2QyxJQUFJLENBQUNDLE9BQUwsQ0FBYWpCLElBQWIsQ0FBa0JHLEtBQWxCLENBQXdCLEdBQXhCLEVBQTZCLENBQTdCLE1BQW9DN0IsU0FBeEMsRUFBbUQ7QUFDakQsU0FBQ08sSUFBRCxFQUFPUyxHQUFQLEVBQVlDLEdBQVosSUFBbUIsTUFBTVosS0FBSyxDQUFDQyxXQUFOLENBQWtCb0MsSUFBSSxDQUFDQyxPQUFMLENBQWFqQixJQUFiLENBQWtCRyxLQUFsQixDQUF3QixHQUF4QixFQUE2QixDQUE3QixDQUFsQixDQUF6QjtBQUNEOztBQUNELFVBQUliLEdBQUcsS0FBSyxDQUFSLElBQWFDLEdBQUcsS0FBSyxDQUF6QixFQUE0QjtBQUMxQixjQUFNLENBQUNrQixJQUFELEVBQU9ZLFFBQVAsRUFBaUJDLElBQWpCLElBQXlCLE1BQU0zQyxLQUFLLENBQUN5QixVQUFOLENBQWlCZCxHQUFqQixFQUFzQkMsR0FBdEIsQ0FBckM7QUFDQXBCLFFBQUFBLE1BQU0sR0FBSSxhQUFZVSxJQUFLLElBQWxCLEdBQ04sd0JBQXVCNEIsSUFBSyxJQUR0QixHQUVOLGtCQUFpQlksUUFBUyxJQUZwQixHQUdOLFVBQVNDLElBQUssRUFIakI7QUFJRCxPQU5ELE1BTU87QUFDTG5ELFFBQUFBLE1BQU0sR0FBRyx3QkFBVDtBQUNEOztBQUNELFlBQU0sMEJBQWdCdEIsV0FBaEIsRUFBNkI7QUFBRSx3QkFBZ0I7QUFBbEIsT0FBN0IsRUFBcUU7QUFBRVMsUUFBQUEsTUFBTSxFQUFFZCxHQUFHLENBQUNHLFdBQWQ7QUFBMkJ5RSxRQUFBQSxPQUFPLEVBQUVMLE1BQXBDO0FBQTRDZixRQUFBQSxJQUFJLEVBQUU3QjtBQUFsRCxPQUFyRSxFQUFpSSxNQUFqSSxDQUFOO0FBQ0Q7QUFyQlMsR0FqQk07QUF3Q2xCRyxFQUFBQSxTQUFTLEVBQUU7QUFDVHVDLElBQUFBLFVBQVUsRUFBRSxxQkFESDtBQUVUQyxJQUFBQSxPQUFPLEVBQ1AsTUFBT0MsTUFBUCxJQUFrQjtBQUNoQixZQUFNNUMsTUFBTSxHQUFHLG9EQUFmO0FBQ0EsWUFBTSwwQkFBZ0J0QixXQUFoQixFQUE2QjtBQUFFLHdCQUFnQjtBQUFsQixPQUE3QixFQUFxRTtBQUFFUyxRQUFBQSxNQUFNLEVBQUVkLEdBQUcsQ0FBQ0csV0FBZDtBQUEyQnlFLFFBQUFBLE9BQU8sRUFBRUwsTUFBcEM7QUFBNENmLFFBQUFBLElBQUksRUFBRTdCO0FBQWxELE9BQXJFLEVBQWlJLE1BQWpJLENBQU47QUFDRDtBQU5RO0FBeENPLENBQXBCOztBQWtEQSxTQUFTb0QsUUFBVCxDQUFrQlAsSUFBbEIsRUFBd0I7QUFDdEIsUUFBTVEsU0FBUyxHQUFHaEQsSUFBSSxDQUFDWSxLQUFMLENBQVc0QixJQUFYLENBQWxCO0FBQ0EsUUFBTVMsUUFBUSxHQUFHRCxTQUFTLENBQUNQLE9BQVYsQ0FBa0JRLFFBQWxCLENBQTJCLENBQTNCLEtBQWlDLEVBQWxEOztBQUNBLE1BQUlBLFFBQVEsQ0FBQ0MsSUFBVCxLQUFrQixhQUF0QixFQUFxQztBQUNuQyxZQUFRRixTQUFTLENBQUNQLE9BQVYsQ0FBa0JqQixJQUFsQixDQUF1QkcsS0FBdkIsQ0FBNkIsR0FBN0IsRUFBa0MsQ0FBbEMsRUFBcUN3QixXQUFyQyxFQUFSO0FBQ0UsV0FBSyxRQUFMO0FBQ0EsV0FBSyxPQUFMO0FBQ0EsV0FBSyxVQUFMO0FBQ0VyRixRQUFBQSxPQUFPLENBQUNzRixJQUFSLENBQWFKLFNBQVMsQ0FBQ1AsT0FBVixDQUFrQmpCLElBQWxCLENBQXVCRyxLQUF2QixDQUE2QixHQUE3QixFQUFrQyxDQUFsQyxFQUFxQ3dCLFdBQXJDLEVBQWIsRUFBaUVILFNBQVMsQ0FBQ1AsT0FBVixDQUFrQlksSUFBbEIsQ0FBdUJDLEVBQXhGLEVBQTRGTixTQUE1RjtBQUNBOztBQUNGO0FBQ0VsRixRQUFBQSxPQUFPLENBQUNzRixJQUFSLENBQWEsV0FBYixFQUEwQkosU0FBUyxDQUFDUCxPQUFWLENBQWtCWSxJQUFsQixDQUF1QkMsRUFBakQ7QUFDQTtBQVJKO0FBVUQ7O0FBQ0QsU0FBTyxDQUFQO0FBQ0Q7O0FBRUQsZUFBZUMsTUFBZixHQUF3QjtBQUN2QmhGLEVBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZZ0YsVUFBWjs7QUFDQyxRQUFNQyxNQUFNLEdBQUdELFdBQUtFLFlBQUwsRUFBZjs7QUFDQUQsRUFBQUEsTUFBTSxDQUFDRSxNQUFQLENBQWNDLE9BQU8sQ0FBQ0MsR0FBUixDQUFZQyxJQUExQjtBQUNBTCxFQUFBQSxNQUFNLENBQUM3RCxFQUFQLENBQVUsU0FBVixFQUFxQixDQUFDSCxPQUFELEVBQVV1QixRQUFWLEtBQXVCO0FBQzFDLFFBQUkrQyxXQUFXLEdBQUcsRUFBbEI7QUFDQXRFLElBQUFBLE9BQU8sQ0FBQ0csRUFBUixDQUFXLE1BQVgsRUFBb0I0QyxJQUFELElBQVU7QUFDM0J1QixNQUFBQSxXQUFXLElBQUl2QixJQUFmO0FBQ0QsS0FGRDtBQUdBL0MsSUFBQUEsT0FBTyxDQUFDRyxFQUFSLENBQVcsS0FBWCxFQUFrQixNQUFNO0FBQ3RCbUQsTUFBQUEsUUFBUSxDQUFDZ0IsV0FBRCxDQUFSO0FBQ0EvQyxNQUFBQSxRQUFRLENBQUNkLEdBQVQ7QUFDRCxLQUhEO0FBSUQsR0FURDtBQVVEOztBQUVEcEMsT0FBTyxDQUFDOEIsRUFBUixDQUFXLFVBQVgsRUFBdUJ3QyxXQUFXLENBQUMsVUFBRCxDQUFYLENBQXdCRSxPQUEvQztBQUNBeEUsT0FBTyxDQUFDOEIsRUFBUixDQUFXLFFBQVgsRUFBcUJ3QyxXQUFXLENBQUMsUUFBRCxDQUFYLENBQXNCRSxPQUEzQztBQUNBeEUsT0FBTyxDQUFDOEIsRUFBUixDQUFXLE9BQVgsRUFBb0J3QyxXQUFXLENBQUMsT0FBRCxDQUFYLENBQXFCRSxPQUF6QztBQUNBeEUsT0FBTyxDQUFDOEIsRUFBUixDQUFXLFdBQVgsRUFBd0J3QyxXQUFXLENBQUN0QyxTQUFaLENBQXNCd0MsT0FBOUM7QUFHQSxNQUFNMEIsYUFBYSxHQUFHLElBQUkxRixRQUFKLENBQVEsMkJBQVIsQ0FBdEI7QUFDQTBGLGFBQWEsQ0FBQ3ZGLFFBQWQsR0FBMEIsTUFBS0wsS0FBTSxHQUFFSixHQUFHLENBQUNDLFVBQVcsRUFBdEQ7QUFDQStGLGFBQWEsQ0FBQ3hELFlBQWQsQ0FBMkJDLE1BQTNCLENBQ0UsS0FERixFQUVFLG9DQUZGO0FBSUEsMEJBQWdCdUQsYUFBaEIsRUFBK0IsRUFBL0IsRUFBbUMsSUFBbkMsRUFBeUMsS0FBekMsRUFBZ0RDLElBQWhELENBQXFEVixNQUFyRCIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGh0dHAgfSBmcm9tICdodHRwJztcbmltcG9ydCB7IGh0dHBzIH0gZnJvbSAnaHR0cHMnO1xuaW1wb3J0IHsgVVJMIH0gZnJvbSAndXJsJztcbmltcG9ydCB7IEV2ZW50RW1pdHRlciB9IGZyb20gJ2V2ZW50cyc7XG5pbXBvcnQgc2VuZEh0dHBSZXF1ZXN0IGZyb20gJy4vaHR0cFJlcXVlc3QnO1xuXG5jb25zdCBldmVudGVyID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG5jb25zdCBDTUQgPSB7XG4gIHNldFdlYkhvb2s6ICdzZXRXZWJob29rJyxcbiAgZ2V0VXBkYXRlczogJ2dldFVwZGF0ZXMnLFxuICBzZW5kTWVzc2FnZTogJ3NlbmRNZXNzYWdlJyxcbn07XG5cbmNvbnN0IHRva2VuID0gJzY3NDA4MjMxODpBQUc0ZTVBWFF1X1NiSmtZU1ZqaTRjaHdhaWdndEdyTUxCYyc7XG5jb25zdCB0ZWxlZ3JhbVVybCA9IG5ldyBVUkwoJ2h0dHBzOi8vYXBpLnRlbGVncmFtLm9yZycpO1xuY29uc29sZS5sb2codGVsZWdyYW1VcmwpO1xudGVsZWdyYW1VcmwucGF0aG5hbWUgPSBgYm90JHt0b2tlbn0vJHtDTUQuc2VuZE1lc3NhZ2V9YDtcblxuYXN5bmMgZnVuY3Rpb24gc2VuZEh0dHBSZXF1ZXN0Xyh1cmxSZXEsIGhlYWRlcnMsIGRhdGFSZXEsIG1ldGhvZCkge1xuICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgIGNvbnN0IG9wdGlvbnMgPSB7XG4gICAgICBob3N0bmFtZTogdXJsUmVxLmhvc3RuYW1lLFxuICAgICAgcG9ydDogNDQzLFxuICAgICAgcGF0aDogdXJsUmVxLnBhdGhuYW1lICsgdXJsUmVxLnNlYXJjaCxcbiAgICB9O1xuICAgIG9wdGlvbnMubWV0aG9kID0gbWV0aG9kO1xuICAgIG9wdGlvbnMuaGVhZGVycyA9IGhlYWRlcnM7XG5cbiAgICBjb25zdCByZXEgPSBodHRwcy5yZXF1ZXN0KG9wdGlvbnMsIChyZXMpID0+IHtcbiAgICAgIGxldCBhbnN3ZXIgPSAnJztcbiAgICAgIHJlcy5vbignZGF0YScsIChkYXRhUmVzKSA9PiB7XG4gICAgICAgIGFuc3dlciArPSBkYXRhUmVzO1xuICAgICAgfSk7XG4gICAgICByZXMub24oJ2VuZCcsICgpID0+IHtcbiAgICAgICAgcmVzb2x2ZShhbnN3ZXIpO1xuICAgICAgfSk7XG4gICAgICByZXMub24oJ2Vycm9yJywgKCkgPT4ge1xuICAgICAgICByZWplY3QoYW5zd2VyKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIGlmIChvcHRpb25zLmhlYWRlcnMgIT09IHVuZGVmaW5lZCkge1xuICAgICAgaWYgKCdDb250ZW50LVR5cGUnIGluIG9wdGlvbnMuaGVhZGVycykge1xuICAgICAgICBpZiAob3B0aW9ucy5oZWFkZXJzWydDb250ZW50LVR5cGUnXSA9PT0gJ2FwcGxpY2F0aW9uL2pzb24nKSB7XG4gICAgICAgICAgcmVxLndyaXRlKEpTT04uc3RyaW5naWZ5KGRhdGFSZXEpKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXEuZW5kKCk7XG4gIH0pO1xufVxuXG5jb25zdCB5YUFwaSA9IHtcbiAgZ2V0TG9jYXRpb246IGFzeW5jIChjaXR5KSA9PiB7XG4gICAgY29uc3QgZ2VvVXJsID0gbmV3IHVybC5VUkwoJ2h0dHBzOi8vZ2VvY29kZS1tYXBzLnlhbmRleC5ydScpO1xuICAgIGdlb1VybC5wYXRobmFtZSA9ICcvMS54Lyc7XG4gICAgZ2VvVXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoJ2Zvcm1hdCcsICdqc29uJyk7XG4gICAgZ2VvVXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoJ3Jlc3VsdHMnLCAnMScpO1xuICAgIGdlb1VybC5zZWFyY2hQYXJhbXMuYXBwZW5kKCdnZW9jb2RlJywgY2l0eSk7XG5cbiAgICBjb25zdCBnZW9Mb2NhdGlvbiA9IGF3YWl0IHNlbmRIdHRwUmVxdWVzdChnZW9VcmwsIHt9LCBudWxsLCAnR0VUJyk7XG4gICAgY29uc3QgZ2VvTG9jYXRpb25QYXJzZSA9IEpTT04ucGFyc2UoZ2VvTG9jYXRpb24pO1xuICAgIGxldCBjaXR5UGFyc2U7XG4gICAgbGV0IGxvbjtcbiAgICBsZXQgbGF0O1xuICAgIGlmIChcbiAgICAgIGdlb0xvY2F0aW9uUGFyc2UucmVzcG9uc2UuR2VvT2JqZWN0Q29sbGVjdGlvblxuICAgICAgICAubWV0YURhdGFQcm9wZXJ0eS5HZW9jb2RlclJlc3BvbnNlTWV0YURhdGFcbiAgICAgICAgLmZvdW5kICE9PSAnMCdcbiAgICApIHtcbiAgICAgIGNpdHlQYXJzZSA9IGdlb0xvY2F0aW9uUGFyc2UucmVzcG9uc2UuR2VvT2JqZWN0Q29sbGVjdGlvbi5mZWF0dXJlTWVtYmVyWzBdXG4gICAgICAgIC5HZW9PYmplY3QubWV0YURhdGFQcm9wZXJ0eS5HZW9jb2Rlck1ldGFEYXRhLnRleHQ7XG4gICAgICBbbG9uLCBsYXRdID0gZ2VvTG9jYXRpb25QYXJzZS5yZXNwb25zZS5HZW9PYmplY3RDb2xsZWN0aW9uLmZlYXR1cmVNZW1iZXJbMF0uR2VvT2JqZWN0LlBvaW50LnBvcy5zcGxpdCgnICcpO1xuICAgIH1cbiAgICByZXR1cm4gW2NpdHlQYXJzZSB8fCBjaXR5LCBsb24gfHwgMCwgbGF0IHx8IDBdO1xuICB9LFxuICBnZXRXZWF0aGVyOiBhc3luYyAobG9uLCBsYXQpID0+IHtcbiAgICBjb25zdCB3ZWF0aGVyVXJsID0gbmV3IHVybC5VUkwoJ2h0dHBzOi8vYXBpLndlYXRoZXIueWFuZGV4LnJ1Jyk7XG4gICAgd2VhdGhlclVybC5wYXRobmFtZSA9ICcvdjEvaW5mb3JtZXJzJztcbiAgICB3ZWF0aGVyVXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoJ2xhbmcnLCAncnVfUlUnKTtcbiAgICB3ZWF0aGVyVXJsLnNlYXJjaFBhcmFtcy5hcHBlbmQoJ2xhdCcsIGxhdCk7XG4gICAgd2VhdGhlclVybC5zZWFyY2hQYXJhbXMuYXBwZW5kKCdsb24nLCBsb24pO1xuICAgIGNvbnN0IHdlYXRoZXJIZWFkZXIgPSB7ICdYLVlhbmRleC1BUEktS2V5JzogJzQwZjBlNTJiLTE2OGQtNDBhNC1iYTM4LTBjMmJmNGQ5ODcyNicgfTtcblxuICAgIGxldCB3ZWF0aGVyID0gYXdhaXQgc2VuZEh0dHBSZXF1ZXN0KHdlYXRoZXJVcmwsIHdlYXRoZXJIZWFkZXIsIG51bGwsICdHRVQnKTtcbiAgICB3ZWF0aGVyID0gSlNPTi5wYXJzZSh3ZWF0aGVyKTtcbiAgICByZXR1cm4gW3dlYXRoZXIuZmFjdC50ZW1wLCB3ZWF0aGVyLmZhY3QuZmVlbHNfbGlrZSwgd2VhdGhlci5mYWN0LndpbmRfc3BlZWRdO1xuICB9LFxufTtcblxuY29uc3QgYm90Q29tbWFuZHMgPSB7XG4gICcvc3RhcnQnOiB7XG4gICAgZGVzY3JpcGlvbjogJ9Cd0LDRh9Cw0YLRjCDRgNCw0LHQvtGC0YMg0YEg0LHQvtGC0L7QvCcsXG4gICAgaGFuZGxlcjpcbiAgICBhc3luYyAoY2hhdElkLCBkYXRhKSA9PiB7XG4gICAgICBjb25zdCBhbnN3ZXIgPSBgSGVsbG8sICR7ZGF0YS5tZXNzYWdlLmZyb20uZmlyc3RfbmFtZX1gO1xuICAgICAgYXdhaXQgc2VuZEh0dHBSZXF1ZXN0KHRlbGVncmFtVXJsLCB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSwgeyBtZXRob2Q6IENNRC5zZW5kTWVzc2FnZSwgY2hhdF9pZDogY2hhdElkLCB0ZXh0OiBhbnN3ZXIgfSwgJ1BPU1QnKTtcbiAgICB9LFxuICB9LFxuICAnL2hlbHAnOiB7XG4gICAgZGVzY3JpcGlvbjogJ9Cf0L7QvNC+0YnRjCcsXG4gICAgaGFuZGxlcjpcbiAgICBhc3luYyAoY2hhdElkKSA9PiB7XG4gICAgICBjb25zdCBhbnN3ZXIgPSAnL3N0YXJ0IC0g0L/QvtC30LTQvtGA0L7QstCw0YLRjNGB0Y9cXG4vd2VhdGhlciAtINGC0LXQutGD0YnQsNGPINC/0L7Qs9C+0LTQsFxcbi9oZWxwIC0g0Y3RgtCwINGB0L/RgNCw0LLQutCwJztcbiAgICAgIGF3YWl0IHNlbmRIdHRwUmVxdWVzdCh0ZWxlZ3JhbVVybCwgeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sIHsgbWV0aG9kOiBDTUQuc2VuZE1lc3NhZ2UsIGNoYXRfaWQ6IGNoYXRJZCwgdGV4dDogYW5zd2VyIH0sICdQT1NUJyk7XG4gICAgfSxcbiAgfSxcbiAgJy93ZWF0aGVyJzoge1xuICAgIGRlc2NyaXBpb246ICfQn9C+0LPQvtC00LAnLFxuICAgIGhhbmRsZXI6XG4gICAgYXN5bmMgKGNoYXRJZCwgZGF0YSkgPT4ge1xuICAgICAgbGV0IGNpdHkgPSAnVHl1bWVuJztcbiAgICAgIGxldCBsYXQgPSA1NztcbiAgICAgIGxldCBsb24gPSA2NTtcbiAgICAgIGxldCBhbnN3ZXIgPSAnJztcbiAgICAgIGlmIChkYXRhLm1lc3NhZ2UudGV4dC5zcGxpdCgnICcpWzFdICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgW2NpdHksIGxvbiwgbGF0XSA9IGF3YWl0IHlhQXBpLmdldExvY2F0aW9uKGRhdGEubWVzc2FnZS50ZXh0LnNwbGl0KCcgJylbMV0pO1xuICAgICAgfVxuICAgICAgaWYgKGxvbiAhPT0gMCB8fCBsYXQgIT09IDApIHtcbiAgICAgICAgY29uc3QgW3RlbXAsIHRlbXBGZWVsLCB3aW5kXSA9IGF3YWl0IHlhQXBpLmdldFdlYXRoZXIobG9uLCBsYXQpO1xuICAgICAgICBhbnN3ZXIgPSBg0J/QvtCz0L7QtNCwINCyOiAke2NpdHl9XFxuYFxuICAgICAgICArIGDQotC10LrRg9GJ0LDRjyDRgtC10LzQv9C10YDQsNGC0YPRgNCwOiAke3RlbXB9XFxuYFxuICAgICAgICArIGDQntGJ0YPRidCw0LXRgtGB0Y8g0LrQsNC6OiAke3RlbXBGZWVsfVxcbmBcbiAgICAgICAgKyBg0JLQtdGC0LXRgDogJHt3aW5kfWA7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBhbnN3ZXIgPSAn0J3QtSDRg9C00LDQu9C+0YHRjCDQvdCw0LnRgtC4INCz0L7RgNC+0LQnO1xuICAgICAgfVxuICAgICAgYXdhaXQgc2VuZEh0dHBSZXF1ZXN0KHRlbGVncmFtVXJsLCB7ICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicgfSwgeyBtZXRob2Q6IENNRC5zZW5kTWVzc2FnZSwgY2hhdF9pZDogY2hhdElkLCB0ZXh0OiBhbnN3ZXIgfSwgJ1BPU1QnKTtcbiAgICB9LFxuICB9LFxuICB1bmRlZmluZWQ6IHtcbiAgICBkZXNjcmlwaW9uOiAn0J3QtdC40LfQstC10YHRgtC90LDRjyDQutC+0LzQsNC90LTQsCcsXG4gICAgaGFuZGxlcjpcbiAgICBhc3luYyAoY2hhdElkKSA9PiB7XG4gICAgICBjb25zdCBhbnN3ZXIgPSAn0J3QtdC40LfQstC10YHRgtC90LDRjyDQutC+0LzQsNC90LTQsCwg0LLQvtGB0L/QvtC70YzQt9GD0LnRgtC10YHRjCDRgdC/0YDQsNCy0LrQvtC5IC9oZWxwJztcbiAgICAgIGF3YWl0IHNlbmRIdHRwUmVxdWVzdCh0ZWxlZ3JhbVVybCwgeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sIHsgbWV0aG9kOiBDTUQuc2VuZE1lc3NhZ2UsIGNoYXRfaWQ6IGNoYXRJZCwgdGV4dDogYW5zd2VyIH0sICdQT1NUJyk7XG4gICAgfSxcbiAgfSxcbn07XG5cbmZ1bmN0aW9uIHJlcVBhcnNlKGRhdGEpIHtcbiAgY29uc3QgZGF0YVBhcnNlID0gSlNPTi5wYXJzZShkYXRhKTtcbiAgY29uc3QgZW50aXRpZXMgPSBkYXRhUGFyc2UubWVzc2FnZS5lbnRpdGllc1swXSB8fCAnJztcbiAgaWYgKGVudGl0aWVzLnR5cGUgPT09ICdib3RfY29tbWFuZCcpIHtcbiAgICBzd2l0Y2ggKGRhdGFQYXJzZS5tZXNzYWdlLnRleHQuc3BsaXQoJyAnKVswXS50b0xvd2VyQ2FzZSgpKSB7XG4gICAgICBjYXNlICcvc3RhcnQnOlxuICAgICAgY2FzZSAnL2hlbHAnOlxuICAgICAgY2FzZSAnL3dlYXRoZXInOlxuICAgICAgICBldmVudGVyLmVtaXQoZGF0YVBhcnNlLm1lc3NhZ2UudGV4dC5zcGxpdCgnICcpWzBdLnRvTG93ZXJDYXNlKCksIGRhdGFQYXJzZS5tZXNzYWdlLmNoYXQuaWQsIGRhdGFQYXJzZSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgZXZlbnRlci5lbWl0KCd1bmRlZmluZWQnLCBkYXRhUGFyc2UubWVzc2FnZS5jaGF0LmlkKTtcbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG4gIHJldHVybiAwO1xufVxuXG5hc3luYyBmdW5jdGlvbiBTZXJ2ZXIoKSB7XG5cdGNvbnNvbGUubG9nKGh0dHApO1xuICBjb25zdCBzZXJ2ZXIgPSBodHRwLmNyZWF0ZVNlcnZlcigpO1xuICBzZXJ2ZXIubGlzdGVuKHByb2Nlc3MuZW52LlBPUlQpO1xuICBzZXJ2ZXIub24oJ3JlcXVlc3QnLCAocmVxdWVzdCwgcmVzcG9uc2UpID0+IHtcbiAgICBsZXQgcmVxdWVzdERhdGEgPSAnJztcbiAgICByZXF1ZXN0Lm9uKCdkYXRhJywgKGRhdGEpID0+IHtcbiAgICAgIHJlcXVlc3REYXRhICs9IGRhdGE7XG4gICAgfSk7XG4gICAgcmVxdWVzdC5vbignZW5kJywgKCkgPT4ge1xuICAgICAgcmVxUGFyc2UocmVxdWVzdERhdGEpO1xuICAgICAgcmVzcG9uc2UuZW5kKCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5ldmVudGVyLm9uKCcvd2VhdGhlcicsIGJvdENvbW1hbmRzWycvd2VhdGhlciddLmhhbmRsZXIpO1xuZXZlbnRlci5vbignL3N0YXJ0JywgYm90Q29tbWFuZHNbJy9zdGFydCddLmhhbmRsZXIpO1xuZXZlbnRlci5vbignL2hlbHAnLCBib3RDb21tYW5kc1snL2hlbHAnXS5oYW5kbGVyKTtcbmV2ZW50ZXIub24oJ3VuZGVmaW5lZCcsIGJvdENvbW1hbmRzLnVuZGVmaW5lZC5oYW5kbGVyKTtcblxuXG5jb25zdCBzZXRXZWJIb29rVXJsID0gbmV3IFVSTCgnaHR0cHM6Ly9hcGkudGVsZWdyYW0ub3JnLycpO1xuc2V0V2ViSG9va1VybC5wYXRobmFtZSA9IGBib3Qke3Rva2VufSR7Q01ELnNldFdlYkhvb2t9YDtcbnNldFdlYkhvb2tVcmwuc2VhcmNoUGFyYW1zLmFwcGVuZChcbiAgJ3VybCcsXG4gICdodHRwczovL3RlbGVib3RlZWVlLmhlcm9rdWFwcC5jb20vJyxcbik7XG5zZW5kSHR0cFJlcXVlc3Qoc2V0V2ViSG9va1VybCwge30sIG51bGwsICdHRVQnKS50aGVuKFNlcnZlcik7Il19