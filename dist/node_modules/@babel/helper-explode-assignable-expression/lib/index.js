"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = _default;

function t() {
  const data = _interopRequireWildcard(require("@babel/types"));

  t = function () {
    return data;
  };

  return data;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  } else {
    var newObj = {};

    if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};

          if (desc.get || desc.set) {
            Object.defineProperty(newObj, key, desc);
          } else {
            newObj[key] = obj[key];
          }
        }
      }
    }

    newObj.default = obj;
    return newObj;
  }
}

function getObjRef(node, nodes, file, scope) {
  let ref;

  if (t().isSuper(node)) {
    return node;
  } else if (t().isIdentifier(node)) {
    if (scope.hasBinding(node.name)) {
      return node;
    } else {
      ref = node;
    }
  } else if (t().isMemberExpression(node)) {
    ref = node.object;

    if (t().isSuper(ref) || t().isIdentifier(ref) && scope.hasBinding(ref.name)) {
      return ref;
    }
  } else {
    throw new Error(`We can't explode this node type ${node.type}`);
  }

  const temp = scope.generateUidIdentifierBasedOnNode(ref);
  scope.push({
    id: temp
  });
  nodes.push(t().assignmentExpression("=", t().cloneNode(temp), t().cloneNode(ref)));
  return temp;
}

function getPropRef(node, nodes, file, scope) {
  const prop = node.property;
  const key = t().toComputedKey(node, prop);
  if (t().isLiteral(key) && t().isPureish(key)) return key;
  const temp = scope.generateUidIdentifierBasedOnNode(prop);
  scope.push({
    id: temp
  });
  nodes.push(t().assignmentExpression("=", t().cloneNode(temp), t().cloneNode(prop)));
  return temp;
}

function _default(node, nodes, file, scope, allowedSingleIdent) {
  let obj;

  if (t().isIdentifier(node) && allowedSingleIdent) {
    obj = node;
  } else {
    obj = getObjRef(node, nodes, file, scope);
  }

  let ref, uid;

  if (t().isIdentifier(node)) {
    ref = t().cloneNode(node);
    uid = obj;
  } else {
    const prop = getPropRef(node, nodes, file, scope);
    const computed = node.computed || t().isLiteral(prop);
    uid = t().memberExpression(t().cloneNode(obj), t().cloneNode(prop), computed);
    ref = t().memberExpression(t().cloneNode(obj), t().cloneNode(prop), computed);
  }

  return {
    uid: uid,
    ref: ref
  };
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvaGVscGVyLWV4cGxvZGUtYXNzaWduYWJsZS1leHByZXNzaW9uL2xpYi9pbmRleC5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJfZGVmYXVsdCIsInQiLCJkYXRhIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwib2JqIiwiX19lc01vZHVsZSIsIm5ld09iaiIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlc2MiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXQiLCJzZXQiLCJnZXRPYmpSZWYiLCJub2RlIiwibm9kZXMiLCJmaWxlIiwic2NvcGUiLCJyZWYiLCJpc1N1cGVyIiwiaXNJZGVudGlmaWVyIiwiaGFzQmluZGluZyIsIm5hbWUiLCJpc01lbWJlckV4cHJlc3Npb24iLCJvYmplY3QiLCJFcnJvciIsInR5cGUiLCJ0ZW1wIiwiZ2VuZXJhdGVVaWRJZGVudGlmaWVyQmFzZWRPbk5vZGUiLCJwdXNoIiwiaWQiLCJhc3NpZ25tZW50RXhwcmVzc2lvbiIsImNsb25lTm9kZSIsImdldFByb3BSZWYiLCJwcm9wIiwicHJvcGVydHkiLCJ0b0NvbXB1dGVkS2V5IiwiaXNMaXRlcmFsIiwiaXNQdXJlaXNoIiwiYWxsb3dlZFNpbmdsZUlkZW50IiwidWlkIiwiY29tcHV0ZWQiLCJtZW1iZXJFeHByZXNzaW9uIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQkMsUUFBbEI7O0FBRUEsU0FBU0MsQ0FBVCxHQUFhO0FBQ1gsUUFBTUMsSUFBSSxHQUFHQyx1QkFBdUIsQ0FB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QWNDLElBQWQsRUFBb0JDLEtBQXBCLENBQWY7QUFDRDs7QUFFRCxNQUFJQyxHQUFKLEVBQVNzQixHQUFUOztBQUVBLE1BQUkxQyxDQUFDLEdBQUdzQixZQUFKLENBQWlCTixJQUFqQixDQUFKLEVBQTRCO0FBQzFCSSxJQUFBQSxHQUFHLEdBQUdwQixDQUFDLEdBQUdrQyxTQUFKLENBQWNsQixJQUFkLENBQU47QUFDQTBCLElBQUFBLEdBQUcsR0FBR3RDLEdBQU47QUFDRCxHQUhELE1BR087QUFDTCxVQUFNZ0MsSUFBSSxHQUFHRCxVQUFVLENBQUNuQixJQUFELEVBQU9DLEtBQVAsRUFBY0MsSUFBZCxFQUFvQkMsS0FBcEIsQ0FBdkI7QUFDQSxVQUFNd0IsUUFBUSxHQUFHM0IsSUFBSSxDQUFDMkIsUUFBTCxJQUFpQjNDLENBQUMsR0FBR3VDLFNBQUosQ0FBY0gsSUFBZCxDQUFsQztBQUNBTSxJQUFBQSxHQUFHLEdBQUcxQyxDQUFDLEdBQUc0QyxnQkFBSixDQUFxQjVDLENBQUMsR0FBR2tDLFNBQUosQ0FBYzlCLEdBQWQsQ0FBckIsRUFBeUNKLENBQUMsR0FBR2tDLFNBQUosQ0FBY0UsSUFBZCxDQUF6QyxFQUE4RE8sUUFBOUQsQ0FBTjtBQUNBdkIsSUFBQUEsR0FBRyxHQUFHcEIsQ0FBQyxHQUFHNEMsZ0JBQUosQ0FBcUI1QyxDQUFDLEdBQUdrQyxTQUFKLENBQWM5QixHQUFkLENBQXJCLEVBQXlDSixDQUFDLEdBQUdrQyxTQUFKLENBQWNFLElBQWQsQ0FBekMsRUFBOERPLFFBQTlELENBQU47QUFDRDs7QUFFRCxTQUFPO0FBQ0xELElBQUFBLEdBQUcsRUFBRUEsR0FEQTtBQUVMdEIsSUFBQUEsR0FBRyxFQUFFQTtBQUZBLEdBQVA7QUFJRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gX2RlZmF1bHQ7XG5cbmZ1bmN0aW9uIHQoKSB7XG4gIGNvbnN0IGRhdGEgPSBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChyZXF1aXJlKFwiQGJhYmVsL3R5cGVzXCIpKTtcblxuICB0ID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9XG5cbmZ1bmN0aW9uIGdldE9ialJlZihub2RlLCBub2RlcywgZmlsZSwgc2NvcGUpIHtcbiAgbGV0IHJlZjtcblxuICBpZiAodCgpLmlzU3VwZXIobm9kZSkpIHtcbiAgICByZXR1cm4gbm9kZTtcbiAgfSBlbHNlIGlmICh0KCkuaXNJZGVudGlmaWVyKG5vZGUpKSB7XG4gICAgaWYgKHNjb3BlLmhhc0JpbmRpbmcobm9kZS5uYW1lKSkge1xuICAgICAgcmV0dXJuIG5vZGU7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlZiA9IG5vZGU7XG4gICAgfVxuICB9IGVsc2UgaWYgKHQoKS5pc01lbWJlckV4cHJlc3Npb24obm9kZSkpIHtcbiAgICByZWYgPSBub2RlLm9iamVjdDtcblxuICAgIGlmICh0KCkuaXNTdXBlcihyZWYpIHx8IHQoKS5pc0lkZW50aWZpZXIocmVmKSAmJiBzY29wZS5oYXNCaW5kaW5nKHJlZi5uYW1lKSkge1xuICAgICAgcmV0dXJuIHJlZjtcbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBXZSBjYW4ndCBleHBsb2RlIHRoaXMgbm9kZSB0eXBlICR7bm9kZS50eXBlfWApO1xuICB9XG5cbiAgY29uc3QgdGVtcCA9IHNjb3BlLmdlbmVyYXRlVWlkSWRlbnRpZmllckJhc2VkT25Ob2RlKHJlZik7XG4gIHNjb3BlLnB1c2goe1xuICAgIGlkOiB0ZW1wXG4gIH0pO1xuICBub2Rlcy5wdXNoKHQoKS5hc3NpZ25tZW50RXhwcmVzc2lvbihcIj1cIiwgdCgpLmNsb25lTm9kZSh0ZW1wKSwgdCgpLmNsb25lTm9kZShyZWYpKSk7XG4gIHJldHVybiB0ZW1wO1xufVxuXG5mdW5jdGlvbiBnZXRQcm9wUmVmKG5vZGUsIG5vZGVzLCBmaWxlLCBzY29wZSkge1xuICBjb25zdCBwcm9wID0gbm9kZS5wcm9wZXJ0eTtcbiAgY29uc3Qga2V5ID0gdCgpLnRvQ29tcHV0ZWRLZXkobm9kZSwgcHJvcCk7XG4gIGlmICh0KCkuaXNMaXRlcmFsKGtleSkgJiYgdCgpLmlzUHVyZWlzaChrZXkpKSByZXR1cm4ga2V5O1xuICBjb25zdCB0ZW1wID0gc2NvcGUuZ2VuZXJhdGVVaWRJZGVudGlmaWVyQmFzZWRPbk5vZGUocHJvcCk7XG4gIHNjb3BlLnB1c2goe1xuICAgIGlkOiB0ZW1wXG4gIH0pO1xuICBub2Rlcy5wdXNoKHQoKS5hc3NpZ25tZW50RXhwcmVzc2lvbihcIj1cIiwgdCgpLmNsb25lTm9kZSh0ZW1wKSwgdCgpLmNsb25lTm9kZShwcm9wKSkpO1xuICByZXR1cm4gdGVtcDtcbn1cblxuZnVuY3Rpb24gX2RlZmF1bHQobm9kZSwgbm9kZXMsIGZpbGUsIHNjb3BlLCBhbGxvd2VkU2luZ2xlSWRlbnQpIHtcbiAgbGV0IG9iajtcblxuICBpZiAodCgpLmlzSWRlbnRpZmllcihub2RlKSAmJiBhbGxvd2VkU2luZ2xlSWRlbnQpIHtcbiAgICBvYmogPSBub2RlO1xuICB9IGVsc2Uge1xuICAgIG9iaiA9IGdldE9ialJlZihub2RlLCBub2RlcywgZmlsZSwgc2NvcGUpO1xuICB9XG5cbiAgbGV0IHJlZiwgdWlkO1xuXG4gIGlmICh0KCkuaXNJZGVudGlmaWVyKG5vZGUpKSB7XG4gICAgcmVmID0gdCgpLmNsb25lTm9kZShub2RlKTtcbiAgICB1aWQgPSBvYmo7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgcHJvcCA9IGdldFByb3BSZWYobm9kZSwgbm9kZXMsIGZpbGUsIHNjb3BlKTtcbiAgICBjb25zdCBjb21wdXRlZCA9IG5vZGUuY29tcHV0ZWQgfHwgdCgpLmlzTGl0ZXJhbChwcm9wKTtcbiAgICB1aWQgPSB0KCkubWVtYmVyRXhwcmVzc2lvbih0KCkuY2xvbmVOb2RlKG9iaiksIHQoKS5jbG9uZU5vZGUocHJvcCksIGNvbXB1dGVkKTtcbiAgICByZWYgPSB0KCkubWVtYmVyRXhwcmVzc2lvbih0KCkuY2xvbmVOb2RlKG9iaiksIHQoKS5jbG9uZU5vZGUocHJvcCksIGNvbXB1dGVkKTtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgdWlkOiB1aWQsXG4gICAgcmVmOiByZWZcbiAgfTtcbn0iXX0=