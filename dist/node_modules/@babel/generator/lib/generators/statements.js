"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.WithStatement = WithStatement;
exports.IfStatement = IfStatement;
exports.ForStatement = ForStatement;
exports.WhileStatement = WhileStatement;
exports.DoWhileStatement = DoWhileStatement;
exports.LabeledStatement = LabeledStatement;
exports.TryStatement = TryStatement;
exports.CatchClause = CatchClause;
exports.SwitchStatement = SwitchStatement;
exports.SwitchCase = SwitchCase;
exports.DebuggerStatement = DebuggerStatement;
exports.VariableDeclaration = VariableDeclaration;
exports.VariableDeclarator = VariableDeclarator;
exports.ThrowStatement = exports.BreakStatement = exports.ReturnStatement = exports.ContinueStatement = exports.ForOfStatement = exports.ForInStatement = void 0;

function t() {
  const data = _interopRequireWildcard(require("@babel/types"));

  t = function () {
    return data;
  };

  return data;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  } else {
    var newObj = {};

    if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};

          if (desc.get || desc.set) {
            Object.defineProperty(newObj, key, desc);
          } else {
            newObj[key] = obj[key];
          }
        }
      }
    }

    newObj.default = obj;
    return newObj;
  }
}

function WithStatement(node) {
  this.word("with");
  this.space();
  this.token("(");
  this.print(node.object, node);
  this.token(")");
  this.printBlock(node);
}

function IfStatement(node) {
  this.word("if");
  this.space();
  this.token("(");
  this.print(node.test, node);
  this.token(")");
  this.space();
  const needsBlock = node.alternate && t().isIfStatement(getLastStatement(node.consequent));

  if (needsBlock) {
    this.token("{");
    this.newline();
    this.indent();
  }

  this.printAndIndentOnComments(node.consequent, node);

  if (needsBlock) {
    this.dedent();
    this.newline();
    this.token("}");
  }

  if (node.alternate) {
    if (this.endsWith("}")) this.space();
    this.word("else");
    this.space();
    this.printAndIndentOnComments(node.alternate, node);
  }
}

function getLastStatement(statement) {
  if (!t().isStatement(statement.body)) return statement;
  return getLastStatement(statement.body);
}

function ForStatement(node) {
  this.word("for");
  this.space();
  this.token("(");
  this.inForStatementInitCounter++;
  this.print(node.init, node);
  this.inForStatementInitCounter--;
  this.token(";");

  if (node.test) {
    this.space();
    this.print(node.test, node);
  }

  this.token(";");

  if (node.update) {
    this.space();
    this.print(node.update, node);
  }

  this.token(")");
  this.printBlock(node);
}

function WhileStatement(node) {
  this.word("while");
  this.space();
  this.token("(");
  this.print(node.test, node);
  this.token(")");
  this.printBlock(node);
}

const buildForXStatement = function (op) {
  return function (node) {
    this.word("for");
    this.space();

    if (op === "of" && node.await) {
      this.word("await");
      this.space();
    }

    this.token("(");
    this.print(node.left, node);
    this.space();
    this.word(op);
    this.space();
    this.print(node.right, node);
    this.token(")");
    this.printBlock(node);
  };
};

const ForInStatement = buildForXStatement("in");
exports.ForInStatement = ForInStatement;
const ForOfStatement = buildForXStatement("of");
exports.ForOfStatement = ForOfStatement;

function DoWhileStatement(node) {
  this.word("do");
  this.space();
  this.print(node.body, node);
  this.space();
  this.word("while");
  this.space();
  this.token("(");
  this.print(node.test, node);
  this.token(")");
  this.semicolon();
}

function buildLabelStatement(prefix, key = "label") {
  return function (node) {
    this.word(prefix);
    const label = node[key];

    if (label) {
      this.space();
      const isLabel = key == "label";
      const terminatorState = this.startTerminatorless(isLabel);
      this.print(label, node);
      this.endTerminatorless(terminatorState);
    }

    this.semicolon();
  };
}

const ContinueStatement = buildLabelStatement("continue");
exports.ContinueStatement = ContinueStatement;
const ReturnStatement = buildLabelStatement("return", "argument");
exports.ReturnStatement = ReturnStatement;
const BreakStatement = buildLabelStatement("break");
exports.BreakStatement = BreakStatement;
const ThrowStatement = buildLabelStatement("throw", "argument");
exports.ThrowStatement = ThrowStatement;

function LabeledStatement(node) {
  this.print(node.label, node);
  this.token(":");
  this.space();
  this.print(node.body, node);
}

function TryStatement(node) {
  this.word("try");
  this.space();
  this.print(node.block, node);
  this.space();

  if (node.handlers) {
    this.print(node.handlers[0], node);
  } else {
    this.print(node.handler, node);
  }

  if (node.finalizer) {
    this.space();
    this.word("finally");
    this.space();
    this.print(node.finalizer, node);
  }
}

function CatchClause(node) {
  this.word("catch");
  this.space();

  if (node.param) {
    this.token("(");
    this.print(node.param, node);
    this.token(")");
    this.space();
  }

  this.print(node.body, node);
}

function SwitchStatement(node) {
  this.word("switch");
  this.space();
  this.token("(");
  this.print(node.discriminant, node);
  this.token(")");
  this.space();
  this.token("{");
  this.printSequence(node.cases, node, {
    indent: true,

    addNewlines(leading, cas) {
      if (!leading && node.cases[node.cases.length - 1] === cas) return -1;
    }

  });
  this.token("}");
}

function SwitchCase(node) {
  if (node.test) {
    this.word("case");
    this.space();
    this.print(node.test, node);
    this.token(":");
  } else {
    this.word("default");
    this.token(":");
  }

  if (node.consequent.length) {
    this.newline();
    this.printSequence(node.consequent, node, {
      indent: true
    });
  }
}

function DebuggerStatement() {
  this.word("debugger");
  this.semicolon();
}

function variableDeclarationIndent() {
  this.token(",");
  this.newline();
  if (this.endsWith("\n")) for (let i = 0; i < 4; i++) this.space(true);
}

function constDeclarationIndent() {
  this.token(",");
  this.newline();
  if (this.endsWith("\n")) for (let i = 0; i < 6; i++) this.space(true);
}

function VariableDeclaration(node, parent) {
  if (node.declare) {
    this.word("declare");
    this.space();
  }

  this.word(node.kind);
  this.space();
  let hasInits = false;

  if (!t().isFor(parent)) {
    for (const declar of node.declarations) {
      if (declar.init) {
        hasInits = true;
      }
    }
  }

  let separator;

  if (hasInits) {
    separator = node.kind === "const" ? constDeclarationIndent : variableDeclarationIndent;
  }

  this.printList(node.declarations, node, {
    separator
  });

  if (t().isFor(parent)) {
    if (parent.left === node || parent.init === node) return;
  }

  this.semicolon();
}

function VariableDeclarator(node) {
  this.print(node.id, node);
  if (node.definite) this.token("!");
  this.print(node.id.typeAnnotation, node);

  if (node.init) {
    this.space();
    this.token("=");
    this.space();
    this.print(node.init, node);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvZ2VuZXJhdG9yL2xpYi9nZW5lcmF0b3JzL3N0YXRlbWVudHMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJXaXRoU3RhdGVtZW50IiwiSWZTdGF0ZW1lbnQiLCJGb3JTdGF0ZW1lbnQiLCJXaGlsZVN0YXRlbWVudCIsIkRvV2hpbGVTdGF0ZW1lbnQiLCJMYWJlbGVkU3RhdGVtZW50IiwiVHJ5U3RhdGVtZW50IiwiQ2F0Y2hDbGF1c2UiLCJTd2l0Y2hTdGF0ZW1lbnQiLCJTd2l0Y2hDYXNlIiwiRGVidWdnZXJTdGF0ZW1lbnQiLCJWYXJpYWJsZURlY2xhcmF0aW9uIiwiVmFyaWFibGVEZWNsYXJhdG9yIiwiVGhyb3dTdGF0ZW1lbnQiLCJCcmVha1N0YXRlbWVudCIsIlJldHVyblN0YXRlbWVudCIsIkNvbnRpbnVlU3RhdGVtZW50IiwiRm9yT2ZTdGF0ZW1lbnQiLCJGb3JJblN0YXRlbWVudCIsInQiLCJkYXRhIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJyZXF1aXJlIiwib2JqIiwiX19lc01vZHVsZSIsIm5ld09iaiIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlc2MiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXQiLCJzZXQiLCJkZWZhdWx0Iiwibm9kZSIsIndvcmQiLCJzcGFjZSIsInRva2VuIiwicHJpbnQiLCJvYmplY3QiLCJwcmludEJsb2NrIiwidGVzdCIsIm5lZWRzQmxvY2siLCJhbHRlcm5hdGUiLCJpc0lmU3RhdGVtZW50IiwiZ2V0TGFzdFN0YXRlbWVudCIsImNvbnNlcXVlbnQiLCJuZXdsaW5lIiwiaW5kZW50IiwicHJpbnRBbmRJbmRlbnRPbkNvbW1lbnRzIiwiZGVkZW50IiwiZW5kc1dpdGgiLCJzdGF0ZW1lbnQiLCJpc1N0YXRlbWVudCIsImJvZHkiLCJpbkZvclN0YXRlbWVudEluaXRDb3VudGVyIiwiaW5pdCIsInVwZGF0ZSIsImJ1aWxkRm9yWFN0YXRlbWVudCIsIm9wIiwiYXdhaXQiLCJsZWZ0IiwicmlnaHQiLCJzZW1pY29sb24iLCJidWlsZExhYmVsU3RhdGVtZW50IiwicHJlZml4IiwibGFiZWwiLCJpc0xhYmVsIiwidGVybWluYXRvclN0YXRlIiwic3RhcnRUZXJtaW5hdG9ybGVzcyIsImVuZFRlcm1pbmF0b3JsZXNzIiwiYmxvY2siLCJoYW5kbGVycyIsImhhbmRsZXIiLCJmaW5hbGl6ZXIiLCJwYXJhbSIsImRpc2NyaW1pbmFudCIsInByaW50U2VxdWVuY2UiLCJjYXNlcyIsImFkZE5ld2xpbmVzIiwibGVhZGluZyIsImNhcyIsImxlbmd0aCIsInZhcmlhYmxlRGVjbGFyYXRpb25JbmRlbnQiLCJpIiwiY29uc3REZWNsYXJhdGlvbkluZGVudCIsInBhcmVudCIsImRlY2xhcmUiLCJraW5kIiwiaGFzSW5pdHMiLCJpc0ZvciIsImRlY2xhciIsImRlY2xhcmF0aW9ucyIsInNlcGFyYXRvciIsInByaW50TGlzdCIsImlkIiwiZGVmaW5pdGUiLCJ0eXBlQW5ub3RhdGlvbiJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLGFBQVIsR0FBd0JBLGFBQXhCO0FBQ0FGLE9BQU8sQ0FBQ0csV0FBUixHQUFzQkEsV0FBdEI7QUFDQUgsT0FBTyxDQUFDSSxZQUFSLEdBQXVCQSxZQUF2QjtBQUNBSixPQUFPLENBQUNLLGNBQVIsR0FBeUJBLGNBQXpCO0FBQ0FMLE9BQU8sQ0FBQ00sZ0JBQVIsR0FBMkJBLGdCQUEzQjtBQUNBTixPQUFPLENBQUNPLGdCQUFSLEdBQTJCQSxnQkFBM0I7QUFDQVAsT0FBTyxDQUFDUSxZQUFSLEdBQXVCQSxZQUF2QjtBQUNBUixPQUFPLENBQUNTLFdBQVIs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RUFBa0Q7QUFDbkQ7O0FBRUQsT0FBSzZCLFNBQUw7QUFDRDs7QUFFRCxTQUFTcEQsa0JBQVQsQ0FBNEJ1QixJQUE1QixFQUFrQztBQUNoQyxPQUFLSSxLQUFMLENBQVdKLElBQUksQ0FBQzZELEVBQWhCLEVBQW9CN0QsSUFBcEI7QUFDQSxNQUFJQSxJQUFJLENBQUM4RCxRQUFULEVBQW1CLEtBQUszRCxLQUFMLENBQVcsR0FBWDtBQUNuQixPQUFLQyxLQUFMLENBQVdKLElBQUksQ0FBQzZELEVBQUwsQ0FBUUUsY0FBbkIsRUFBbUMvRCxJQUFuQzs7QUFFQSxNQUFJQSxJQUFJLENBQUNzQixJQUFULEVBQWU7QUFDYixTQUFLcEIsS0FBTDtBQUNBLFNBQUtDLEtBQUwsQ0FBVyxHQUFYO0FBQ0EsU0FBS0QsS0FBTDtBQUNBLFNBQUtFLEtBQUwsQ0FBV0osSUFBSSxDQUFDc0IsSUFBaEIsRUFBc0J0QixJQUF0QjtBQUNEO0FBQ0YiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuV2l0aFN0YXRlbWVudCA9IFdpdGhTdGF0ZW1lbnQ7XG5leHBvcnRzLklmU3RhdGVtZW50ID0gSWZTdGF0ZW1lbnQ7XG5leHBvcnRzLkZvclN0YXRlbWVudCA9IEZvclN0YXRlbWVudDtcbmV4cG9ydHMuV2hpbGVTdGF0ZW1lbnQgPSBXaGlsZVN0YXRlbWVudDtcbmV4cG9ydHMuRG9XaGlsZVN0YXRlbWVudCA9IERvV2hpbGVTdGF0ZW1lbnQ7XG5leHBvcnRzLkxhYmVsZWRTdGF0ZW1lbnQgPSBMYWJlbGVkU3RhdGVtZW50O1xuZXhwb3J0cy5UcnlTdGF0ZW1lbnQgPSBUcnlTdGF0ZW1lbnQ7XG5leHBvcnRzLkNhdGNoQ2xhdXNlID0gQ2F0Y2hDbGF1c2U7XG5leHBvcnRzLlN3aXRjaFN0YXRlbWVudCA9IFN3aXRjaFN0YXRlbWVudDtcbmV4cG9ydHMuU3dpdGNoQ2FzZSA9IFN3aXRjaENhc2U7XG5leHBvcnRzLkRlYnVnZ2VyU3RhdGVtZW50ID0gRGVidWdnZXJTdGF0ZW1lbnQ7XG5leHBvcnRzLlZhcmlhYmxlRGVjbGFyYXRpb24gPSBWYXJpYWJsZURlY2xhcmF0aW9uO1xuZXhwb3J0cy5WYXJpYWJsZURlY2xhcmF0b3IgPSBWYXJpYWJsZURlY2xhcmF0b3I7XG5leHBvcnRzLlRocm93U3RhdGVtZW50ID0gZXhwb3J0cy5CcmVha1N0YXRlbWVudCA9IGV4cG9ydHMuUmV0dXJuU3RhdGVtZW50ID0gZXhwb3J0cy5Db250aW51ZVN0YXRlbWVudCA9IGV4cG9ydHMuRm9yT2ZTdGF0ZW1lbnQgPSBleHBvcnRzLkZvckluU3RhdGVtZW50ID0gdm9pZCAwO1xuXG5mdW5jdGlvbiB0KCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcIkBiYWJlbC90eXBlc1wiKSk7XG5cbiAgdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQob2JqKSB7IGlmIChvYmogJiYgb2JqLl9fZXNNb2R1bGUpIHsgcmV0dXJuIG9iajsgfSBlbHNlIHsgdmFyIG5ld09iaiA9IHt9OyBpZiAob2JqICE9IG51bGwpIHsgZm9yICh2YXIga2V5IGluIG9iaikgeyBpZiAoT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKG9iaiwga2V5KSkgeyB2YXIgZGVzYyA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eSAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID8gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihvYmosIGtleSkgOiB7fTsgaWYgKGRlc2MuZ2V0IHx8IGRlc2Muc2V0KSB7IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShuZXdPYmosIGtleSwgZGVzYyk7IH0gZWxzZSB7IG5ld09ialtrZXldID0gb2JqW2tleV07IH0gfSB9IH0gbmV3T2JqLmRlZmF1bHQgPSBvYmo7IHJldHVybiBuZXdPYmo7IH0gfVxuXG5mdW5jdGlvbiBXaXRoU3RhdGVtZW50KG5vZGUpIHtcbiAgdGhpcy53b3JkKFwid2l0aFwiKTtcbiAgdGhpcy5zcGFjZSgpO1xuICB0aGlzLnRva2VuKFwiKFwiKTtcbiAgdGhpcy5wcmludChub2RlLm9iamVjdCwgbm9kZSk7XG4gIHRoaXMudG9rZW4oXCIpXCIpO1xuICB0aGlzLnByaW50QmxvY2sobm9kZSk7XG59XG5cbmZ1bmN0aW9uIElmU3RhdGVtZW50KG5vZGUpIHtcbiAgdGhpcy53b3JkKFwiaWZcIik7XG4gIHRoaXMuc3BhY2UoKTtcbiAgdGhpcy50b2tlbihcIihcIik7XG4gIHRoaXMucHJpbnQobm9kZS50ZXN0LCBub2RlKTtcbiAgdGhpcy50b2tlbihcIilcIik7XG4gIHRoaXMuc3BhY2UoKTtcbiAgY29uc3QgbmVlZHNCbG9jayA9IG5vZGUuYWx0ZXJuYXRlICYmIHQoKS5pc0lmU3RhdGVtZW50KGdldExhc3RTdGF0ZW1lbnQobm9kZS5jb25zZXF1ZW50KSk7XG5cbiAgaWYgKG5lZWRzQmxvY2spIHtcbiAgICB0aGlzLnRva2VuKFwie1wiKTtcbiAgICB0aGlzLm5ld2xpbmUoKTtcbiAgICB0aGlzLmluZGVudCgpO1xuICB9XG5cbiAgdGhpcy5wcmludEFuZEluZGVudE9uQ29tbWVudHMobm9kZS5jb25zZXF1ZW50LCBub2RlKTtcblxuICBpZiAobmVlZHNCbG9jaykge1xuICAgIHRoaXMuZGVkZW50KCk7XG4gICAgdGhpcy5uZXdsaW5lKCk7XG4gICAgdGhpcy50b2tlbihcIn1cIik7XG4gIH1cblxuICBpZiAobm9kZS5hbHRlcm5hdGUpIHtcbiAgICBpZiAodGhpcy5lbmRzV2l0aChcIn1cIikpIHRoaXMuc3BhY2UoKTtcbiAgICB0aGlzLndvcmQoXCJlbHNlXCIpO1xuICAgIHRoaXMuc3BhY2UoKTtcbiAgICB0aGlzLnByaW50QW5kSW5kZW50T25Db21tZW50cyhub2RlLmFsdGVybmF0ZSwgbm9kZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZ2V0TGFzdFN0YXRlbWVudChzdGF0ZW1lbnQpIHtcbiAgaWYgKCF0KCkuaXNTdGF0ZW1lbnQoc3RhdGVtZW50LmJvZHkpKSByZXR1cm4gc3RhdGVtZW50O1xuICByZXR1cm4gZ2V0TGFzdFN0YXRlbWVudChzdGF0ZW1lbnQuYm9keSk7XG59XG5cbmZ1bmN0aW9uIEZvclN0YXRlbWVudChub2RlKSB7XG4gIHRoaXMud29yZChcImZvclwiKTtcbiAgdGhpcy5zcGFjZSgpO1xuICB0aGlzLnRva2VuKFwiKFwiKTtcbiAgdGhpcy5pbkZvclN0YXRlbWVudEluaXRDb3VudGVyKys7XG4gIHRoaXMucHJpbnQobm9kZS5pbml0LCBub2RlKTtcbiAgdGhpcy5pbkZvclN0YXRlbWVudEluaXRDb3VudGVyLS07XG4gIHRoaXMudG9rZW4oXCI7XCIpO1xuXG4gIGlmIChub2RlLnRlc3QpIHtcbiAgICB0aGlzLnNwYWNlKCk7XG4gICAgdGhpcy5wcmludChub2RlLnRlc3QsIG5vZGUpO1xuICB9XG5cbiAgdGhpcy50b2tlbihcIjtcIik7XG5cbiAgaWYgKG5vZGUudXBkYXRlKSB7XG4gICAgdGhpcy5zcGFjZSgpO1xuICAgIHRoaXMucHJpbnQobm9kZS51cGRhdGUsIG5vZGUpO1xuICB9XG5cbiAgdGhpcy50b2tlbihcIilcIik7XG4gIHRoaXMucHJpbnRCbG9jayhub2RlKTtcbn1cblxuZnVuY3Rpb24gV2hpbGVTdGF0ZW1lbnQobm9kZSkge1xuICB0aGlzLndvcmQoXCJ3aGlsZVwiKTtcbiAgdGhpcy5zcGFjZSgpO1xuICB0aGlzLnRva2VuKFwiKFwiKTtcbiAgdGhpcy5wcmludChub2RlLnRlc3QsIG5vZGUpO1xuICB0aGlzLnRva2VuKFwiKVwiKTtcbiAgdGhpcy5wcmludEJsb2NrKG5vZGUpO1xufVxuXG5jb25zdCBidWlsZEZvclhTdGF0ZW1lbnQgPSBmdW5jdGlvbiAob3ApIHtcbiAgcmV0dXJuIGZ1bmN0aW9uIChub2RlKSB7XG4gICAgdGhpcy53b3JkKFwiZm9yXCIpO1xuICAgIHRoaXMuc3BhY2UoKTtcblxuICAgIGlmIChvcCA9PT0gXCJvZlwiICYmIG5vZGUuYXdhaXQpIHtcbiAgICAgIHRoaXMud29yZChcImF3YWl0XCIpO1xuICAgICAgdGhpcy5zcGFjZSgpO1xuICAgIH1cblxuICAgIHRoaXMudG9rZW4oXCIoXCIpO1xuICAgIHRoaXMucHJpbnQobm9kZS5sZWZ0LCBub2RlKTtcbiAgICB0aGlzLnNwYWNlKCk7XG4gICAgdGhpcy53b3JkKG9wKTtcbiAgICB0aGlzLnNwYWNlKCk7XG4gICAgdGhpcy5wcmludChub2RlLnJpZ2h0LCBub2RlKTtcbiAgICB0aGlzLnRva2VuKFwiKVwiKTtcbiAgICB0aGlzLnByaW50QmxvY2sobm9kZSk7XG4gIH07XG59O1xuXG5jb25zdCBGb3JJblN0YXRlbWVudCA9IGJ1aWxkRm9yWFN0YXRlbWVudChcImluXCIpO1xuZXhwb3J0cy5Gb3JJblN0YXRlbWVudCA9IEZvckluU3RhdGVtZW50O1xuY29uc3QgRm9yT2ZTdGF0ZW1lbnQgPSBidWlsZEZvclhTdGF0ZW1lbnQoXCJvZlwiKTtcbmV4cG9ydHMuRm9yT2ZTdGF0ZW1lbnQgPSBGb3JPZlN0YXRlbWVudDtcblxuZnVuY3Rpb24gRG9XaGlsZVN0YXRlbWVudChub2RlKSB7XG4gIHRoaXMud29yZChcImRvXCIpO1xuICB0aGlzLnNwYWNlKCk7XG4gIHRoaXMucHJpbnQobm9kZS5ib2R5LCBub2RlKTtcbiAgdGhpcy5zcGFjZSgpO1xuICB0aGlzLndvcmQoXCJ3aGlsZVwiKTtcbiAgdGhpcy5zcGFjZSgpO1xuICB0aGlzLnRva2VuKFwiKFwiKTtcbiAgdGhpcy5wcmludChub2RlLnRlc3QsIG5vZGUpO1xuICB0aGlzLnRva2VuKFwiKVwiKTtcbiAgdGhpcy5zZW1pY29sb24oKTtcbn1cblxuZnVuY3Rpb24gYnVpbGRMYWJlbFN0YXRlbWVudChwcmVmaXgsIGtleSA9IFwibGFiZWxcIikge1xuICByZXR1cm4gZnVuY3Rpb24gKG5vZGUpIHtcbiAgICB0aGlzLndvcmQocHJlZml4KTtcbiAgICBjb25zdCBsYWJlbCA9IG5vZGVba2V5XTtcblxuICAgIGlmIChsYWJlbCkge1xuICAgICAgdGhpcy5zcGFjZSgpO1xuICAgICAgY29uc3QgaXNMYWJlbCA9IGtleSA9PSBcImxhYmVsXCI7XG4gICAgICBjb25zdCB0ZXJtaW5hdG9yU3RhdGUgPSB0aGlzLnN0YXJ0VGVybWluYXRvcmxlc3MoaXNMYWJlbCk7XG4gICAgICB0aGlzLnByaW50KGxhYmVsLCBub2RlKTtcbiAgICAgIHRoaXMuZW5kVGVybWluYXRvcmxlc3ModGVybWluYXRvclN0YXRlKTtcbiAgICB9XG5cbiAgICB0aGlzLnNlbWljb2xvbigpO1xuICB9O1xufVxuXG5jb25zdCBDb250aW51ZVN0YXRlbWVudCA9IGJ1aWxkTGFiZWxTdGF0ZW1lbnQoXCJjb250aW51ZVwiKTtcbmV4cG9ydHMuQ29udGludWVTdGF0ZW1lbnQgPSBDb250aW51ZVN0YXRlbWVudDtcbmNvbnN0IFJldHVyblN0YXRlbWVudCA9IGJ1aWxkTGFiZWxTdGF0ZW1lbnQoXCJyZXR1cm5cIiwgXCJhcmd1bWVudFwiKTtcbmV4cG9ydHMuUmV0dXJuU3RhdGVtZW50ID0gUmV0dXJuU3RhdGVtZW50O1xuY29uc3QgQnJlYWtTdGF0ZW1lbnQgPSBidWlsZExhYmVsU3RhdGVtZW50KFwiYnJlYWtcIik7XG5leHBvcnRzLkJyZWFrU3RhdGVtZW50ID0gQnJlYWtTdGF0ZW1lbnQ7XG5jb25zdCBUaHJvd1N0YXRlbWVudCA9IGJ1aWxkTGFiZWxTdGF0ZW1lbnQoXCJ0aHJvd1wiLCBcImFyZ3VtZW50XCIpO1xuZXhwb3J0cy5UaHJvd1N0YXRlbWVudCA9IFRocm93U3RhdGVtZW50O1xuXG5mdW5jdGlvbiBMYWJlbGVkU3RhdGVtZW50KG5vZGUpIHtcbiAgdGhpcy5wcmludChub2RlLmxhYmVsLCBub2RlKTtcbiAgdGhpcy50b2tlbihcIjpcIik7XG4gIHRoaXMuc3BhY2UoKTtcbiAgdGhpcy5wcmludChub2RlLmJvZHksIG5vZGUpO1xufVxuXG5mdW5jdGlvbiBUcnlTdGF0ZW1lbnQobm9kZSkge1xuICB0aGlzLndvcmQoXCJ0cnlcIik7XG4gIHRoaXMuc3BhY2UoKTtcbiAgdGhpcy5wcmludChub2RlLmJsb2NrLCBub2RlKTtcbiAgdGhpcy5zcGFjZSgpO1xuXG4gIGlmIChub2RlLmhhbmRsZXJzKSB7XG4gICAgdGhpcy5wcmludChub2RlLmhhbmRsZXJzWzBdLCBub2RlKTtcbiAgfSBlbHNlIHtcbiAgICB0aGlzLnByaW50KG5vZGUuaGFuZGxlciwgbm9kZSk7XG4gIH1cblxuICBpZiAobm9kZS5maW5hbGl6ZXIpIHtcbiAgICB0aGlzLnNwYWNlKCk7XG4gICAgdGhpcy53b3JkKFwiZmluYWxseVwiKTtcbiAgICB0aGlzLnNwYWNlKCk7XG4gICAgdGhpcy5wcmludChub2RlLmZpbmFsaXplciwgbm9kZSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gQ2F0Y2hDbGF1c2Uobm9kZSkge1xuICB0aGlzLndvcmQoXCJjYXRjaFwiKTtcbiAgdGhpcy5zcGFjZSgpO1xuXG4gIGlmIChub2RlLnBhcmFtKSB7XG4gICAgdGhpcy50b2tlbihcIihcIik7XG4gICAgdGhpcy5wcmludChub2RlLnBhcmFtLCBub2RlKTtcbiAgICB0aGlzLnRva2VuKFwiKVwiKTtcbiAgICB0aGlzLnNwYWNlKCk7XG4gIH1cblxuICB0aGlzLnByaW50KG5vZGUuYm9keSwgbm9kZSk7XG59XG5cbmZ1bmN0aW9uIFN3aXRjaFN0YXRlbWVudChub2RlKSB7XG4gIHRoaXMud29yZChcInN3aXRjaFwiKTtcbiAgdGhpcy5zcGFjZSgpO1xuICB0aGlzLnRva2VuKFwiKFwiKTtcbiAgdGhpcy5wcmludChub2RlLmRpc2NyaW1pbmFudCwgbm9kZSk7XG4gIHRoaXMudG9rZW4oXCIpXCIpO1xuICB0aGlzLnNwYWNlKCk7XG4gIHRoaXMudG9rZW4oXCJ7XCIpO1xuICB0aGlzLnByaW50U2VxdWVuY2Uobm9kZS5jYXNlcywgbm9kZSwge1xuICAgIGluZGVudDogdHJ1ZSxcblxuICAgIGFkZE5ld2xpbmVzKGxlYWRpbmcsIGNhcykge1xuICAgICAgaWYgKCFsZWFkaW5nICYmIG5vZGUuY2FzZXNbbm9kZS5jYXNlcy5sZW5ndGggLSAxXSA9PT0gY2FzKSByZXR1cm4gLTE7XG4gICAgfVxuXG4gIH0pO1xuICB0aGlzLnRva2VuKFwifVwiKTtcbn1cblxuZnVuY3Rpb24gU3dpdGNoQ2FzZShub2RlKSB7XG4gIGlmIChub2RlLnRlc3QpIHtcbiAgICB0aGlzLndvcmQoXCJjYXNlXCIpO1xuICAgIHRoaXMuc3BhY2UoKTtcbiAgICB0aGlzLnByaW50KG5vZGUudGVzdCwgbm9kZSk7XG4gICAgdGhpcy50b2tlbihcIjpcIik7XG4gIH0gZWxzZSB7XG4gICAgdGhpcy53b3JkKFwiZGVmYXVsdFwiKTtcbiAgICB0aGlzLnRva2VuKFwiOlwiKTtcbiAgfVxuXG4gIGlmIChub2RlLmNvbnNlcXVlbnQubGVuZ3RoKSB7XG4gICAgdGhpcy5uZXdsaW5lKCk7XG4gICAgdGhpcy5wcmludFNlcXVlbmNlKG5vZGUuY29uc2VxdWVudCwgbm9kZSwge1xuICAgICAgaW5kZW50OiB0cnVlXG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gRGVidWdnZXJTdGF0ZW1lbnQoKSB7XG4gIHRoaXMud29yZChcImRlYnVnZ2VyXCIpO1xuICB0aGlzLnNlbWljb2xvbigpO1xufVxuXG5mdW5jdGlvbiB2YXJpYWJsZURlY2xhcmF0aW9uSW5kZW50KCkge1xuICB0aGlzLnRva2VuKFwiLFwiKTtcbiAgdGhpcy5uZXdsaW5lKCk7XG4gIGlmICh0aGlzLmVuZHNXaXRoKFwiXFxuXCIpKSBmb3IgKGxldCBpID0gMDsgaSA8IDQ7IGkrKykgdGhpcy5zcGFjZSh0cnVlKTtcbn1cblxuZnVuY3Rpb24gY29uc3REZWNsYXJhdGlvbkluZGVudCgpIHtcbiAgdGhpcy50b2tlbihcIixcIik7XG4gIHRoaXMubmV3bGluZSgpO1xuICBpZiAodGhpcy5lbmRzV2l0aChcIlxcblwiKSkgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHRoaXMuc3BhY2UodHJ1ZSk7XG59XG5cbmZ1bmN0aW9uIFZhcmlhYmxlRGVjbGFyYXRpb24obm9kZSwgcGFyZW50KSB7XG4gIGlmIChub2RlLmRlY2xhcmUpIHtcbiAgICB0aGlzLndvcmQoXCJkZWNsYXJlXCIpO1xuICAgIHRoaXMuc3BhY2UoKTtcbiAgfVxuXG4gIHRoaXMud29yZChub2RlLmtpbmQpO1xuICB0aGlzLnNwYWNlKCk7XG4gIGxldCBoYXNJbml0cyA9IGZhbHNlO1xuXG4gIGlmICghdCgpLmlzRm9yKHBhcmVudCkpIHtcbiAgICBmb3IgKGNvbnN0IGRlY2xhciBvZiBub2RlLmRlY2xhcmF0aW9ucykge1xuICAgICAgaWYgKGRlY2xhci5pbml0KSB7XG4gICAgICAgIGhhc0luaXRzID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBsZXQgc2VwYXJhdG9yO1xuXG4gIGlmIChoYXNJbml0cykge1xuICAgIHNlcGFyYXRvciA9IG5vZGUua2luZCA9PT0gXCJjb25zdFwiID8gY29uc3REZWNsYXJhdGlvbkluZGVudCA6IHZhcmlhYmxlRGVjbGFyYXRpb25JbmRlbnQ7XG4gIH1cblxuICB0aGlzLnByaW50TGlzdChub2RlLmRlY2xhcmF0aW9ucywgbm9kZSwge1xuICAgIHNlcGFyYXRvclxuICB9KTtcblxuICBpZiAodCgpLmlzRm9yKHBhcmVudCkpIHtcbiAgICBpZiAocGFyZW50LmxlZnQgPT09IG5vZGUgfHwgcGFyZW50LmluaXQgPT09IG5vZGUpIHJldHVybjtcbiAgfVxuXG4gIHRoaXMuc2VtaWNvbG9uKCk7XG59XG5cbmZ1bmN0aW9uIFZhcmlhYmxlRGVjbGFyYXRvcihub2RlKSB7XG4gIHRoaXMucHJpbnQobm9kZS5pZCwgbm9kZSk7XG4gIGlmIChub2RlLmRlZmluaXRlKSB0aGlzLnRva2VuKFwiIVwiKTtcbiAgdGhpcy5wcmludChub2RlLmlkLnR5cGVBbm5vdGF0aW9uLCBub2RlKTtcblxuICBpZiAobm9kZS5pbml0KSB7XG4gICAgdGhpcy5zcGFjZSgpO1xuICAgIHRoaXMudG9rZW4oXCI9XCIpO1xuICAgIHRoaXMuc3BhY2UoKTtcbiAgICB0aGlzLnByaW50KG5vZGUuaW5pdCwgbm9kZSk7XG4gIH1cbn0iXX0=