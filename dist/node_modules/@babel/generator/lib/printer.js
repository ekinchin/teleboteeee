"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

function _isInteger() {
  const data = _interopRequireDefault(require("lodash/isInteger"));

  _isInteger = function () {
    return data;
  };

  return data;
}

function _repeat() {
  const data = _interopRequireDefault(require("lodash/repeat"));

  _repeat = function () {
    return data;
  };

  return data;
}

var _buffer = _interopRequireDefault(require("./buffer"));

var n = _interopRequireWildcard(require("./node"));

function t() {
  const data = _interopRequireWildcard(require("@babel/types"));

  t = function () {
    return data;
  };

  return data;
}

var generatorFunctions = _interopRequireWildcard(require("./generators"));

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  } else {
    var newObj = {};

    if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};

          if (desc.get || desc.set) {
            Object.defineProperty(newObj, key, desc);
          } else {
            newObj[key] = obj[key];
          }
        }
      }
    }

    newObj.default = obj;
    return newObj;
  }
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

const SCIENTIFIC_NOTATION = /e/i;
const ZERO_DECIMAL_INTEGER = /\.0+$/;
const NON_DECIMAL_LITERAL = /^0[box]/;

class Printer {
  constructor(format, map) {
    this.inForStatementInitCounter = 0;
    this._printStack = [];
    this._indent = 0;
    this._insideAux = false;
    this._printedCommentStarts = {};
    this._parenPushNewlineState = null;
    this._noLineTerminator = false;
    this._printAuxAfterOnNextUserNode = false;
    this._printedComments = new WeakSet();
    this._endsWithInteger = false;
    this._endsWithWord = false;
    this.format = format || {};
    this._buf = new _buffer.default(map);
  }

  generate(ast) {
    this.print(ast);

    this._maybeAddAuxComment();

    return this._buf.get();
  }

  indent() {
    if (this.format.compact || this.format.concise) return;
    this._indent++;
  }

  dedent() {
    if (this.format.compact || this.format.concise) return;
    this._indent--;
  }

  semicolon(force = false) {
    this._maybeAddAuxComment();

    this._append(";", !force);
  }

  rightBrace() {
    if (this.format.minified) {
      this._buf.removeLastSemicolon();
    }

    this.token("}");
  }

  space(force = false) {
    if (this.format.compact) return;

    if (this._buf.hasContent() && !this.endsWith(" ") && !this.endsWith("\n") || force) {
      this._space();
    }
  }

  word(str) {
    if (this._endsWithWord || this.endsWith("/") && str.indexOf("/") === 0) {
      this._space();
    }

    this._maybeAddAuxComment();

    this._append(str);

    this._endsWithWord = true;
  }

  number(str) {
    this.word(str);
    this._endsWithInteger = (0, _isInteger().default)(+str) && !NON_DECIMAL_LITERAL.test(str) && !SCIENTIFIC_NOTATION.test(str) && !ZERO_DECIMAL_INTEGER.test(str) && str[str.length - 1] !== ".";
  }

  token(str) {
    if (str === "--" && this.endsWith("!") || str[0] === "+" && this.endsWith("+") || str[0] === "-" && this.endsWith("-") || str[0] === "." && this._endsWithInteger) {
      this._space();
    }

    this._maybeAddAuxComment();

    this._append(str);
  }

  newline(i) {
    if (this.format.retainLines || this.format.compact) return;

    if (this.format.concise) {
      this.space();
      return;
    }

    if (this.endsWith("\n\n")) return;
    if (typeof i !== "number") i = 1;
    i = Math.min(2, i);
    if (this.endsWith("{\n") || this.endsWith(":\n")) i--;
    if (i <= 0) return;

    for (let j = 0; j < i; j++) {
      this._newline();
    }
  }

  endsWith(str) {
    return this._buf.endsWith(str);
  }

  removeTrailingNewline() {
    this._buf.removeTrailingNewline();
  }

  exactSource(loc, cb) {
    this._catchUp("start", loc);

    this._buf.exactSource(loc, cb);
  }

  source(prop, loc) {
    this._catchUp(prop, loc);

    this._buf.source(prop, loc);
  }

  withSource(prop, loc, cb) {
    this._catchUp(prop, loc);

    this._buf.withSource(prop, loc, cb);
  }

  _space() {
    this._append(" ", true);
  }

  _newline() {
    this._append("\n", true);
  }

  _append(str, queue = false) {
    this._maybeAddParen(str);

    this._maybeIndent(str);

    if (queue) this._buf.queue(str);else this._buf.append(str);
    this._endsWithWord = false;
    this._endsWithInteger = false;
  }

  _maybeIndent(str) {
    if (this._indent && this.endsWith("\n") && str[0] !== "\n") {
      this._buf.queue(this._getIndent());
    }
  }

  _maybeAddParen(str) {
    const parenPushNewlineState = this._parenPushNewlineState;
    if (!parenPushNewlineState) return;
    this._parenPushNewlineState = null;
    let i;

    for (i = 0; i < str.length && str[i] === " "; i++) continue;

    if (i === str.length) return;
    const cha = str[i];

    if (cha !== "\n") {
      if (cha !== "/") return;
      if (i + 1 === str.length) return;
      const chaPost = str[i + 1];
      if (chaPost !== "/" && chaPost !== "*") return;
    }

    this.token("(");
    this.indent();
    parenPushNewlineState.printed = true;
  }

  _catchUp(prop, loc) {
    if (!this.format.retainLines) return;
    const pos = loc ? loc[prop] : null;

    if (pos && pos.line !== null) {
      const count = pos.line - this._buf.getCurrentLine();

      for (let i = 0; i < count; i++) {
        this._newline();
      }
    }
  }

  _getIndent() {
    return (0, _repeat().default)(this.format.indent.style, this._indent);
  }

  startTerminatorless(isLabel = false) {
    if (isLabel) {
      this._noLineTerminator = true;
      return null;
    } else {
      return this._parenPushNewlineState = {
        printed: false
      };
    }
  }

  endTerminatorless(state) {
    this._noLineTerminator = false;

    if (state && state.printed) {
      this.dedent();
      this.newline();
      this.token(")");
    }
  }

  print(node, parent) {
    if (!node) return;
    const oldConcise = this.format.concise;

    if (node._compact) {
      this.format.concise = true;
    }

    const printMethod = this[node.type];

    if (!printMethod) {
      throw new ReferenceError(`unknown node of type ${JSON.stringify(node.type)} with constructor ${JSON.stringify(node && node.constructor.name)}`);
    }

    this._printStack.push(node);

    const oldInAux = this._insideAux;
    this._insideAux = !node.loc;

    this._maybeAddAuxComment(this._insideAux && !oldInAux);

    let needsParens = n.needsParens(node, parent, this._printStack);

    if (this.format.retainFunctionParens && node.type === "FunctionExpression" && node.extra && node.extra.parenthesized) {
      needsParens = true;
    }

    if (needsParens) this.token("(");

    this._printLeadingComments(node, parent);

    const loc = t().isProgram(node) || t().isFile(node) ? null : node.loc;
    this.withSource("start", loc, () => {
      this[node.type](node, parent);
    });

    this._printTrailingComments(node, parent);

    if (needsParens) this.token(")");

    this._printStack.pop();

    this.format.concise = oldConcise;
    this._insideAux = oldInAux;
  }

  _maybeAddAuxComment(enteredPositionlessNode) {
    if (enteredPositionlessNode) this._printAuxBeforeComment();
    if (!this._insideAux) this._printAuxAfterComment();
  }

  _printAuxBeforeComment() {
    if (this._printAuxAfterOnNextUserNode) return;
    this._printAuxAfterOnNextUserNode = true;
    const comment = this.format.auxiliaryCommentBefore;

    if (comment) {
      this._printComment({
        type: "CommentBlock",
        value: comment
      });
    }
  }

  _printAuxAfterComment() {
    if (!this._printAuxAfterOnNextUserNode) return;
    this._printAuxAfterOnNextUserNode = false;
    const comment = this.format.auxiliaryCommentAfter;

    if (comment) {
      this._printComment({
        type: "CommentBlock",
        value: comment
      });
    }
  }

  getPossibleRaw(node) {
    const extra = node.extra;

    if (extra && extra.raw != null && extra.rawValue != null && node.value === extra.rawValue) {
      return extra.raw;
    }
  }

  printJoin(nodes, parent, opts = {}) {
    if (!nodes || !nodes.length) return;
    if (opts.indent) this.indent();
    const newlineOpts = {
      addNewlines: opts.addNewlines
    };

    for (let i = 0; i < nodes.length; i++) {
      const node = nodes[i];
      if (!node) continue;
      if (opts.statement) this._printNewline(true, node, parent, newlineOpts);
      this.print(node, parent);

      if (opts.iterator) {
        opts.iterator(node, i);
      }

      if (opts.separator && i < nodes.length - 1) {
        opts.separator.call(this);
      }

      if (opts.statement) this._printNewline(false, node, parent, newlineOpts);
    }

    if (opts.indent) this.dedent();
  }

  printAndIndentOnComments(node, parent) {
    const indent = node.leadingComments && node.leadingComments.length > 0;
    if (indent) this.indent();
    this.print(node, parent);
    if (indent) this.dedent();
  }

  printBlock(parent) {
    const node = parent.body;

    if (!t().isEmptyStatement(node)) {
      this.space();
    }

    this.print(node, parent);
  }

  _printTrailingComments(node, parent) {
    this._printComments(this._getComments(false, node, parent));
  }

  _printLeadingComments(node, parent) {
    this._printComments(this._getComments(true, node, parent));
  }

  printInnerComments(node, indent = true) {
    if (!node.innerComments || !node.innerComments.length) return;
    if (indent) this.indent();

    this._printComments(node.innerComments);

    if (indent) this.dedent();
  }

  printSequence(nodes, parent, opts = {}) {
    opts.statement = true;
    return this.printJoin(nodes, parent, opts);
  }

  printList(items, parent, opts = {}) {
    if (opts.separator == null) {
      opts.separator = commaSeparator;
    }

    return this.printJoin(items, parent, opts);
  }

  _printNewline(leading, node, parent, opts) {
    if (this.format.retainLines || this.format.compact) return;

    if (this.format.concise) {
      this.space();
      return;
    }

    let lines = 0;

    if (this._buf.hasContent()) {
      if (!leading) lines++;
      if (opts.addNewlines) lines += opts.addNewlines(leading, node) || 0;
      const needs = leading ? n.needsWhitespaceBefore : n.needsWhitespaceAfter;
      if (needs(node, parent)) lines++;
    }

    this.newline(lines);
  }

  _getComments(leading, node) {
    return node && (leading ? node.leadingComments : node.trailingComments) || [];
  }

  _printComment(comment) {
    if (!this.format.shouldPrintComment(comment.value)) return;
    if (comment.ignore) return;
    if (this._printedComments.has(comment)) return;

    this._printedComments.add(comment);

    if (comment.start != null) {
      if (this._printedCommentStarts[comment.start]) return;
      this._printedCommentStarts[comment.start] = true;
    }

    const isBlockComment = comment.type === "CommentBlock";
    this.newline(this._buf.hasContent() && !this._noLineTerminator && isBlockComment ? 1 : 0);
    if (!this.endsWith("[") && !this.endsWith("{")) this.space();
    let val = !isBlockComment && !this._noLineTerminator ? `//${comment.value}\n` : `/*${comment.value}*/`;

    if (isBlockComment && this.format.indent.adjustMultilineComment) {
      const offset = comment.loc && comment.loc.start.column;

      if (offset) {
        const newlineRegex = new RegExp("\\n\\s{1," + offset + "}", "g");
        val = val.replace(newlineRegex, "\n");
      }

      const indentSize = Math.max(this._getIndent().length, this._buf.getCurrentColumn());
      val = val.replace(/\n(?!$)/g, `\n${(0, _repeat().default)(" ", indentSize)}`);
    }

    if (this.endsWith("/")) this._space();
    this.withSource("start", comment.loc, () => {
      this._append(val);
    });
    this.newline(isBlockComment && !this._noLineTerminator ? 1 : 0);
  }

  _printComments(comments) {
    if (!comments || !comments.length) return;

    for (const comment of comments) {
      this._printComment(comment);
    }
  }

}

exports.default = Printer;
Object.assign(Printer.prototype, generatorFunctions);

function commaSeparator() {
  this.token(",");
  this.space();
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvZ2VuZXJhdG9yL2xpYi9wcmludGVyLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiZGVmYXVsdCIsIl9pc0ludGVnZXIiLCJkYXRhIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfcmVwZWF0IiwiX2J1ZmZlciIsIm4iLCJfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZCIsInQiLCJnZW5lcmF0b3JGdW5jdGlvbnMiLCJvYmoiLCJfX2VzTW9kdWxlIiwibmV3T2JqIiwia2V5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJjYWxsIiwiZGVzYyIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsImdldCIsInNldCIsIlNDSUVOVElGSUNfTk9UQVRJT04iLCJaRVJPX0RFQ0lNQUxfSU5URUdFUiIsIk5PTl9ERUNJTUFMX0xJVEVSQUwiLCJQcmludGVyIiwiY29uc3RydWN0b3IiLCJmb3JtYXQiLCJtYXAiLCJpbkZvclN0YXRlbWVudEluaXRDb3VudGVyIiwiX3ByaW50U3RhY2siLCJfaW5kZW50IiwiX2luc2lkZUF1eCIsIl9wcmludGVkQ29tbWVudFN0YXJ0cyIsIl9wYXJlblB1c2hOZXdsaW5lU3RhdGUiLCJfbm9MaW5lVGVybWluYXRvciIsIl9wcmludEF1eEFmdGVyT25OZXh0VXNlck5vZGUiLCJfcHJpbnRlZENvbW1lbnRzIiwiV2Vha1NldCIsIl9lbmRzV2l0aEludGVnZXIiLCJfZW5kc1dpdGhXb3JkIiwiX2J1ZiIsImdlbmVyYXRlIiwiYXN0IiwicHJpbnQiLCJfbWF5YmVBZGRBdXhDb21tZW50IiwiaW5kZW50IiwiY29tcGFjdCIsImNvbmNpc2UiLCJkZWRlbnQiLCJzZW1pY29sb24iLCJmb3JjZSIsIl9hcHBlbmQiLCJyaWdodEJyYWNlIiwibWluaWZpZWQiLCJyZW1vdmVMYXN0U2VtaWNvbG9uIiwidG9rZW4iLCJzcGFjZSIsImhhc0NvbnRlbnQiLCJlbmRzV2l0aCIsIl9zcGFjZSIsIndvcmQiLCJzdHIiLCJpbmRleE9mIiwibnVtYmVyIiwidGVzdCIsImxlbmd0aCIsIm5ld2xpbmUiLCJpIiwicmV0YWluTGluZXMiLCJNYXRoIiwibWluIiwiaiIsIl9uZXdsaW5lIiwicmVtb3ZlVHJhaWxpbmdOZXdsaW5lIiwiZXhhY3RTb3VyY2UiLCJsb2MiLCJjYiIsIl9jYXRjaFVwIiwic291cmNlIiwicHJvcCIsIndpdGhTb3VyY2UiLCJxdWV1ZSIsIl9tYXliZUFkZFBhcmVuIiwiX21heWJlSW5kZW50IiwiYXBwZW5kIiwiX2dldEluZGVudCIsInBhcmVuUHVzaE5ld2xpbmVTdGF0ZSIsImNoYSIsImNoYVBvc3QiLCJwcmludGVkIiwicG9zIiwibGluZSIsImNvdW50IiwiZ2V0Q3VycmVudExpbmUiLCJzdHlsZSIsInN0YXJ0VGVybWluYXRvcmxlc3MiLCJpc0xhYmVsIiwiZW5kVGVybWluYXRvcmxlc3MiLCJzdGF0ZSIsIm5vZGUiLCJwYXJlbnQiLCJvbGRDb25jaXNlIiwiX2NvbXBhY3QiLCJwcmludE1ldGhvZCIsInR5cGUiLCJSZWZlcmVuY2VFcnJvciIsIkpTT04iLCJzdHJpbmdpZnkiLCJuYW1lIiwicHVzaCIsIm9sZEluQXV4IiwibmVlZHNQYXJlbnMiLCJyZXRhaW5GdW5jdGlvblBhcmVucyIsImV4dHJhIiwicGFyZW50aGVzaXplZCIsIl9wcmludExlYWRpbmdDb21tZW50cyIsImlzUHJvZ3JhbSIsImlzRmlsZSIsIl9wcmludFRyYWlsaW5nQ29tbWVudHMiLCJwb3AiLCJlbnRlcmVkUG9zaXRpb25sZXNzTm9kZSIsIl9wcmludEF1eEJlZm9yZUNvbW1lbnQiLCJfcHJpbnRBdXhBZnRlckNvbW1lbnQiLCJjb21tZW50IiwiYXV4aWxpYXJ5Q29tbWVudEJlZm9yZSIsIl9wcmludENvbW1lbnQiLCJhdXhpbGlhcnlDb21tZW50QWZ0ZXIiLCJnZXRQb3NzaWJsZVJhdyIsInJhdyIsInJhd1ZhbHVlIiwicHJpbnRKb2luIiwibm9kZXMiLCJvcHRzIiwibmV3bGluZU9wdHMiLCJhZGROZXdsaW5lcyIsInN0YXRlbWVudCIsIl9wcmludE5ld2xpbmUiLCJpdGVyYXRvciIsInNlcGFyYXRvciIsInByaW50QW5kSW5kZW50T25Db21tZW50cyIsImxlYWRpbmdDb21tZW50cyIsInByaW50QmxvY2siLCJib2R5IiwiaXNFbXB0eVN0YXRlbWVudCIsIl9wcmludENvbW1lbnRzIiwiX2dldENvbW1lbnRzIiwicHJpbnRJbm5lckNvbW1lbnRzIiwiaW5uZXJDb21tZW50cyIsInByaW50U2VxdWVuY2UiLCJwcmludExpc3QiLCJpdGVtcyIsImNvbW1hU2VwYXJhdG9yIiwibGVhZGluZyIsImxpbmVzIiwibmVlZHMiLCJuZWVkc1doaXRlc3BhY2VCZWZvcmUiLCJuZWVkc1doaXRlc3BhY2VBZnRlciIsInRyYWlsaW5nQ29tbWVudHMiLCJzaG91bGRQcmludENvbW1lbnQiLCJpZ25vcmUiLCJoYXMiLCJhZGQiLCJzdGFydCIsImlzQmxvY2tDb21tZW50IiwidmFsIiwiYWRqdXN0TXVsdGlsaW5lQ29tbWVudCIsIm9mZnNldCIsImNvbHVtbiIsIm5ld2xpbmVSZWdleCIsIlJlZ0V4cCIsInJlcGxhY2UiLCJpbmRlbnRTaXplIiwibWF4IiwiZ2V0Q3VycmVudENvbHVtbiIsImNvbW1lbnRzIiwiYXNzaWduIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQixLQUFLLENBQXZCOztBQUVBLFNBQVNDLFVBQVQsR0FBc0I7QUFDcEIsUUFBTUMsSUFBSSxHQUFHQyxzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLGtCQUFELENBQVIsQ0FBbkM7O0FBRUFILEVBQUFBLFVBQVUsR0FBRyxZQUFZO0FBQ3ZCLFdBQU9DLElBQVA7QUFDRCxHQUZE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Q0EsUUFBUSxDQUFDN0csTUFBM0IsRUFBbUM7O0FBRW5DLFNBQUssTUFBTTBELE9BQVgsSUFBc0JtRCxRQUF0QixFQUFnQztBQUM5QixXQUFLakQsYUFBTCxDQUFtQkYsT0FBbkI7QUFDRDtBQUNGOztBQXZiVzs7QUEyYmQ5SCxPQUFPLENBQUNFLE9BQVIsR0FBa0J5QixPQUFsQjtBQUNBN0IsTUFBTSxDQUFDb0wsTUFBUCxDQUFjdkosT0FBTyxDQUFDVixTQUF0QixFQUFpQ0wsa0JBQWpDOztBQUVBLFNBQVM4SSxjQUFULEdBQTBCO0FBQ3hCLE9BQUtoRyxLQUFMLENBQVcsR0FBWDtBQUNBLE9BQUtDLEtBQUw7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5kZWZhdWx0ID0gdm9pZCAwO1xuXG5mdW5jdGlvbiBfaXNJbnRlZ2VyKCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwibG9kYXNoL2lzSW50ZWdlclwiKSk7XG5cbiAgX2lzSW50ZWdlciA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gX3JlcGVhdCgpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImxvZGFzaC9yZXBlYXRcIikpO1xuXG4gIF9yZXBlYXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbnZhciBfYnVmZmVyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9idWZmZXJcIikpO1xuXG52YXIgbiA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCIuL25vZGVcIikpO1xuXG5mdW5jdGlvbiB0KCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQocmVxdWlyZShcIkBiYWJlbC90eXBlc1wiKSk7XG5cbiAgdCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxudmFyIGdlbmVyYXRvckZ1bmN0aW9ucyA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCIuL2dlbmVyYXRvcnNcIikpO1xuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmNvbnN0IFNDSUVOVElGSUNfTk9UQVRJT04gPSAvZS9pO1xuY29uc3QgWkVST19ERUNJTUFMX0lOVEVHRVIgPSAvXFwuMCskLztcbmNvbnN0IE5PTl9ERUNJTUFMX0xJVEVSQUwgPSAvXjBbYm94XS87XG5cbmNsYXNzIFByaW50ZXIge1xuICBjb25zdHJ1Y3Rvcihmb3JtYXQsIG1hcCkge1xuICAgIHRoaXMuaW5Gb3JTdGF0ZW1lbnRJbml0Q291bnRlciA9IDA7XG4gICAgdGhpcy5fcHJpbnRTdGFjayA9IFtdO1xuICAgIHRoaXMuX2luZGVudCA9IDA7XG4gICAgdGhpcy5faW5zaWRlQXV4ID0gZmFsc2U7XG4gICAgdGhpcy5fcHJpbnRlZENvbW1lbnRTdGFydHMgPSB7fTtcbiAgICB0aGlzLl9wYXJlblB1c2hOZXdsaW5lU3RhdGUgPSBudWxsO1xuICAgIHRoaXMuX25vTGluZVRlcm1pbmF0b3IgPSBmYWxzZTtcbiAgICB0aGlzLl9wcmludEF1eEFmdGVyT25OZXh0VXNlck5vZGUgPSBmYWxzZTtcbiAgICB0aGlzLl9wcmludGVkQ29tbWVudHMgPSBuZXcgV2Vha1NldCgpO1xuICAgIHRoaXMuX2VuZHNXaXRoSW50ZWdlciA9IGZhbHNlO1xuICAgIHRoaXMuX2VuZHNXaXRoV29yZCA9IGZhbHNlO1xuICAgIHRoaXMuZm9ybWF0ID0gZm9ybWF0IHx8IHt9O1xuICAgIHRoaXMuX2J1ZiA9IG5ldyBfYnVmZmVyLmRlZmF1bHQobWFwKTtcbiAgfVxuXG4gIGdlbmVyYXRlKGFzdCkge1xuICAgIHRoaXMucHJpbnQoYXN0KTtcblxuICAgIHRoaXMuX21heWJlQWRkQXV4Q29tbWVudCgpO1xuXG4gICAgcmV0dXJuIHRoaXMuX2J1Zi5nZXQoKTtcbiAgfVxuXG4gIGluZGVudCgpIHtcbiAgICBpZiAodGhpcy5mb3JtYXQuY29tcGFjdCB8fCB0aGlzLmZvcm1hdC5jb25jaXNlKSByZXR1cm47XG4gICAgdGhpcy5faW5kZW50Kys7XG4gIH1cblxuICBkZWRlbnQoKSB7XG4gICAgaWYgKHRoaXMuZm9ybWF0LmNvbXBhY3QgfHwgdGhpcy5mb3JtYXQuY29uY2lzZSkgcmV0dXJuO1xuICAgIHRoaXMuX2luZGVudC0tO1xuICB9XG5cbiAgc2VtaWNvbG9uKGZvcmNlID0gZmFsc2UpIHtcbiAgICB0aGlzLl9tYXliZUFkZEF1eENvbW1lbnQoKTtcblxuICAgIHRoaXMuX2FwcGVuZChcIjtcIiwgIWZvcmNlKTtcbiAgfVxuXG4gIHJpZ2h0QnJhY2UoKSB7XG4gICAgaWYgKHRoaXMuZm9ybWF0Lm1pbmlmaWVkKSB7XG4gICAgICB0aGlzLl9idWYucmVtb3ZlTGFzdFNlbWljb2xvbigpO1xuICAgIH1cblxuICAgIHRoaXMudG9rZW4oXCJ9XCIpO1xuICB9XG5cbiAgc3BhY2UoZm9yY2UgPSBmYWxzZSkge1xuICAgIGlmICh0aGlzLmZvcm1hdC5jb21wYWN0KSByZXR1cm47XG5cbiAgICBpZiAodGhpcy5fYnVmLmhhc0NvbnRlbnQoKSAmJiAhdGhpcy5lbmRzV2l0aChcIiBcIikgJiYgIXRoaXMuZW5kc1dpdGgoXCJcXG5cIikgfHwgZm9yY2UpIHtcbiAgICAgIHRoaXMuX3NwYWNlKCk7XG4gICAgfVxuICB9XG5cbiAgd29yZChzdHIpIHtcbiAgICBpZiAodGhpcy5fZW5kc1dpdGhXb3JkIHx8IHRoaXMuZW5kc1dpdGgoXCIvXCIpICYmIHN0ci5pbmRleE9mKFwiL1wiKSA9PT0gMCkge1xuICAgICAgdGhpcy5fc3BhY2UoKTtcbiAgICB9XG5cbiAgICB0aGlzLl9tYXliZUFkZEF1eENvbW1lbnQoKTtcblxuICAgIHRoaXMuX2FwcGVuZChzdHIpO1xuXG4gICAgdGhpcy5fZW5kc1dpdGhXb3JkID0gdHJ1ZTtcbiAgfVxuXG4gIG51bWJlcihzdHIpIHtcbiAgICB0aGlzLndvcmQoc3RyKTtcbiAgICB0aGlzLl9lbmRzV2l0aEludGVnZXIgPSAoMCwgX2lzSW50ZWdlcigpLmRlZmF1bHQpKCtzdHIpICYmICFOT05fREVDSU1BTF9MSVRFUkFMLnRlc3Qoc3RyKSAmJiAhU0NJRU5USUZJQ19OT1RBVElPTi50ZXN0KHN0cikgJiYgIVpFUk9fREVDSU1BTF9JTlRFR0VSLnRlc3Qoc3RyKSAmJiBzdHJbc3RyLmxlbmd0aCAtIDFdICE9PSBcIi5cIjtcbiAgfVxuXG4gIHRva2VuKHN0cikge1xuICAgIGlmIChzdHIgPT09IFwiLS1cIiAmJiB0aGlzLmVuZHNXaXRoKFwiIVwiKSB8fCBzdHJbMF0gPT09IFwiK1wiICYmIHRoaXMuZW5kc1dpdGgoXCIrXCIpIHx8IHN0clswXSA9PT0gXCItXCIgJiYgdGhpcy5lbmRzV2l0aChcIi1cIikgfHwgc3RyWzBdID09PSBcIi5cIiAmJiB0aGlzLl9lbmRzV2l0aEludGVnZXIpIHtcbiAgICAgIHRoaXMuX3NwYWNlKCk7XG4gICAgfVxuXG4gICAgdGhpcy5fbWF5YmVBZGRBdXhDb21tZW50KCk7XG5cbiAgICB0aGlzLl9hcHBlbmQoc3RyKTtcbiAgfVxuXG4gIG5ld2xpbmUoaSkge1xuICAgIGlmICh0aGlzLmZvcm1hdC5yZXRhaW5MaW5lcyB8fCB0aGlzLmZvcm1hdC5jb21wYWN0KSByZXR1cm47XG5cbiAgICBpZiAodGhpcy5mb3JtYXQuY29uY2lzZSkge1xuICAgICAgdGhpcy5zcGFjZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICh0aGlzLmVuZHNXaXRoKFwiXFxuXFxuXCIpKSByZXR1cm47XG4gICAgaWYgKHR5cGVvZiBpICE9PSBcIm51bWJlclwiKSBpID0gMTtcbiAgICBpID0gTWF0aC5taW4oMiwgaSk7XG4gICAgaWYgKHRoaXMuZW5kc1dpdGgoXCJ7XFxuXCIpIHx8IHRoaXMuZW5kc1dpdGgoXCI6XFxuXCIpKSBpLS07XG4gICAgaWYgKGkgPD0gMCkgcmV0dXJuO1xuXG4gICAgZm9yIChsZXQgaiA9IDA7IGogPCBpOyBqKyspIHtcbiAgICAgIHRoaXMuX25ld2xpbmUoKTtcbiAgICB9XG4gIH1cblxuICBlbmRzV2l0aChzdHIpIHtcbiAgICByZXR1cm4gdGhpcy5fYnVmLmVuZHNXaXRoKHN0cik7XG4gIH1cblxuICByZW1vdmVUcmFpbGluZ05ld2xpbmUoKSB7XG4gICAgdGhpcy5fYnVmLnJlbW92ZVRyYWlsaW5nTmV3bGluZSgpO1xuICB9XG5cbiAgZXhhY3RTb3VyY2UobG9jLCBjYikge1xuICAgIHRoaXMuX2NhdGNoVXAoXCJzdGFydFwiLCBsb2MpO1xuXG4gICAgdGhpcy5fYnVmLmV4YWN0U291cmNlKGxvYywgY2IpO1xuICB9XG5cbiAgc291cmNlKHByb3AsIGxvYykge1xuICAgIHRoaXMuX2NhdGNoVXAocHJvcCwgbG9jKTtcblxuICAgIHRoaXMuX2J1Zi5zb3VyY2UocHJvcCwgbG9jKTtcbiAgfVxuXG4gIHdpdGhTb3VyY2UocHJvcCwgbG9jLCBjYikge1xuICAgIHRoaXMuX2NhdGNoVXAocHJvcCwgbG9jKTtcblxuICAgIHRoaXMuX2J1Zi53aXRoU291cmNlKHByb3AsIGxvYywgY2IpO1xuICB9XG5cbiAgX3NwYWNlKCkge1xuICAgIHRoaXMuX2FwcGVuZChcIiBcIiwgdHJ1ZSk7XG4gIH1cblxuICBfbmV3bGluZSgpIHtcbiAgICB0aGlzLl9hcHBlbmQoXCJcXG5cIiwgdHJ1ZSk7XG4gIH1cblxuICBfYXBwZW5kKHN0ciwgcXVldWUgPSBmYWxzZSkge1xuICAgIHRoaXMuX21heWJlQWRkUGFyZW4oc3RyKTtcblxuICAgIHRoaXMuX21heWJlSW5kZW50KHN0cik7XG5cbiAgICBpZiAocXVldWUpIHRoaXMuX2J1Zi5xdWV1ZShzdHIpO2Vsc2UgdGhpcy5fYnVmLmFwcGVuZChzdHIpO1xuICAgIHRoaXMuX2VuZHNXaXRoV29yZCA9IGZhbHNlO1xuICAgIHRoaXMuX2VuZHNXaXRoSW50ZWdlciA9IGZhbHNlO1xuICB9XG5cbiAgX21heWJlSW5kZW50KHN0cikge1xuICAgIGlmICh0aGlzLl9pbmRlbnQgJiYgdGhpcy5lbmRzV2l0aChcIlxcblwiKSAmJiBzdHJbMF0gIT09IFwiXFxuXCIpIHtcbiAgICAgIHRoaXMuX2J1Zi5xdWV1ZSh0aGlzLl9nZXRJbmRlbnQoKSk7XG4gICAgfVxuICB9XG5cbiAgX21heWJlQWRkUGFyZW4oc3RyKSB7XG4gICAgY29uc3QgcGFyZW5QdXNoTmV3bGluZVN0YXRlID0gdGhpcy5fcGFyZW5QdXNoTmV3bGluZVN0YXRlO1xuICAgIGlmICghcGFyZW5QdXNoTmV3bGluZVN0YXRlKSByZXR1cm47XG4gICAgdGhpcy5fcGFyZW5QdXNoTmV3bGluZVN0YXRlID0gbnVsbDtcbiAgICBsZXQgaTtcblxuICAgIGZvciAoaSA9IDA7IGkgPCBzdHIubGVuZ3RoICYmIHN0cltpXSA9PT0gXCIgXCI7IGkrKykgY29udGludWU7XG5cbiAgICBpZiAoaSA9PT0gc3RyLmxlbmd0aCkgcmV0dXJuO1xuICAgIGNvbnN0IGNoYSA9IHN0cltpXTtcblxuICAgIGlmIChjaGEgIT09IFwiXFxuXCIpIHtcbiAgICAgIGlmIChjaGEgIT09IFwiL1wiKSByZXR1cm47XG4gICAgICBpZiAoaSArIDEgPT09IHN0ci5sZW5ndGgpIHJldHVybjtcbiAgICAgIGNvbnN0IGNoYVBvc3QgPSBzdHJbaSArIDFdO1xuICAgICAgaWYgKGNoYVBvc3QgIT09IFwiL1wiICYmIGNoYVBvc3QgIT09IFwiKlwiKSByZXR1cm47XG4gICAgfVxuXG4gICAgdGhpcy50b2tlbihcIihcIik7XG4gICAgdGhpcy5pbmRlbnQoKTtcbiAgICBwYXJlblB1c2hOZXdsaW5lU3RhdGUucHJpbnRlZCA9IHRydWU7XG4gIH1cblxuICBfY2F0Y2hVcChwcm9wLCBsb2MpIHtcbiAgICBpZiAoIXRoaXMuZm9ybWF0LnJldGFpbkxpbmVzKSByZXR1cm47XG4gICAgY29uc3QgcG9zID0gbG9jID8gbG9jW3Byb3BdIDogbnVsbDtcblxuICAgIGlmIChwb3MgJiYgcG9zLmxpbmUgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGNvdW50ID0gcG9zLmxpbmUgLSB0aGlzLl9idWYuZ2V0Q3VycmVudExpbmUoKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSsrKSB7XG4gICAgICAgIHRoaXMuX25ld2xpbmUoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfZ2V0SW5kZW50KCkge1xuICAgIHJldHVybiAoMCwgX3JlcGVhdCgpLmRlZmF1bHQpKHRoaXMuZm9ybWF0LmluZGVudC5zdHlsZSwgdGhpcy5faW5kZW50KTtcbiAgfVxuXG4gIHN0YXJ0VGVybWluYXRvcmxlc3MoaXNMYWJlbCA9IGZhbHNlKSB7XG4gICAgaWYgKGlzTGFiZWwpIHtcbiAgICAgIHRoaXMuX25vTGluZVRlcm1pbmF0b3IgPSB0cnVlO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLl9wYXJlblB1c2hOZXdsaW5lU3RhdGUgPSB7XG4gICAgICAgIHByaW50ZWQ6IGZhbHNlXG4gICAgICB9O1xuICAgIH1cbiAgfVxuXG4gIGVuZFRlcm1pbmF0b3JsZXNzKHN0YXRlKSB7XG4gICAgdGhpcy5fbm9MaW5lVGVybWluYXRvciA9IGZhbHNlO1xuXG4gICAgaWYgKHN0YXRlICYmIHN0YXRlLnByaW50ZWQpIHtcbiAgICAgIHRoaXMuZGVkZW50KCk7XG4gICAgICB0aGlzLm5ld2xpbmUoKTtcbiAgICAgIHRoaXMudG9rZW4oXCIpXCIpO1xuICAgIH1cbiAgfVxuXG4gIHByaW50KG5vZGUsIHBhcmVudCkge1xuICAgIGlmICghbm9kZSkgcmV0dXJuO1xuICAgIGNvbnN0IG9sZENvbmNpc2UgPSB0aGlzLmZvcm1hdC5jb25jaXNlO1xuXG4gICAgaWYgKG5vZGUuX2NvbXBhY3QpIHtcbiAgICAgIHRoaXMuZm9ybWF0LmNvbmNpc2UgPSB0cnVlO1xuICAgIH1cblxuICAgIGNvbnN0IHByaW50TWV0aG9kID0gdGhpc1tub2RlLnR5cGVdO1xuXG4gICAgaWYgKCFwcmludE1ldGhvZCkge1xuICAgICAgdGhyb3cgbmV3IFJlZmVyZW5jZUVycm9yKGB1bmtub3duIG5vZGUgb2YgdHlwZSAke0pTT04uc3RyaW5naWZ5KG5vZGUudHlwZSl9IHdpdGggY29uc3RydWN0b3IgJHtKU09OLnN0cmluZ2lmeShub2RlICYmIG5vZGUuY29uc3RydWN0b3IubmFtZSl9YCk7XG4gICAgfVxuXG4gICAgdGhpcy5fcHJpbnRTdGFjay5wdXNoKG5vZGUpO1xuXG4gICAgY29uc3Qgb2xkSW5BdXggPSB0aGlzLl9pbnNpZGVBdXg7XG4gICAgdGhpcy5faW5zaWRlQXV4ID0gIW5vZGUubG9jO1xuXG4gICAgdGhpcy5fbWF5YmVBZGRBdXhDb21tZW50KHRoaXMuX2luc2lkZUF1eCAmJiAhb2xkSW5BdXgpO1xuXG4gICAgbGV0IG5lZWRzUGFyZW5zID0gbi5uZWVkc1BhcmVucyhub2RlLCBwYXJlbnQsIHRoaXMuX3ByaW50U3RhY2spO1xuXG4gICAgaWYgKHRoaXMuZm9ybWF0LnJldGFpbkZ1bmN0aW9uUGFyZW5zICYmIG5vZGUudHlwZSA9PT0gXCJGdW5jdGlvbkV4cHJlc3Npb25cIiAmJiBub2RlLmV4dHJhICYmIG5vZGUuZXh0cmEucGFyZW50aGVzaXplZCkge1xuICAgICAgbmVlZHNQYXJlbnMgPSB0cnVlO1xuICAgIH1cblxuICAgIGlmIChuZWVkc1BhcmVucykgdGhpcy50b2tlbihcIihcIik7XG5cbiAgICB0aGlzLl9wcmludExlYWRpbmdDb21tZW50cyhub2RlLCBwYXJlbnQpO1xuXG4gICAgY29uc3QgbG9jID0gdCgpLmlzUHJvZ3JhbShub2RlKSB8fCB0KCkuaXNGaWxlKG5vZGUpID8gbnVsbCA6IG5vZGUubG9jO1xuICAgIHRoaXMud2l0aFNvdXJjZShcInN0YXJ0XCIsIGxvYywgKCkgPT4ge1xuICAgICAgdGhpc1tub2RlLnR5cGVdKG5vZGUsIHBhcmVudCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9wcmludFRyYWlsaW5nQ29tbWVudHMobm9kZSwgcGFyZW50KTtcblxuICAgIGlmIChuZWVkc1BhcmVucykgdGhpcy50b2tlbihcIilcIik7XG5cbiAgICB0aGlzLl9wcmludFN0YWNrLnBvcCgpO1xuXG4gICAgdGhpcy5mb3JtYXQuY29uY2lzZSA9IG9sZENvbmNpc2U7XG4gICAgdGhpcy5faW5zaWRlQXV4ID0gb2xkSW5BdXg7XG4gIH1cblxuICBfbWF5YmVBZGRBdXhDb21tZW50KGVudGVyZWRQb3NpdGlvbmxlc3NOb2RlKSB7XG4gICAgaWYgKGVudGVyZWRQb3NpdGlvbmxlc3NOb2RlKSB0aGlzLl9wcmludEF1eEJlZm9yZUNvbW1lbnQoKTtcbiAgICBpZiAoIXRoaXMuX2luc2lkZUF1eCkgdGhpcy5fcHJpbnRBdXhBZnRlckNvbW1lbnQoKTtcbiAgfVxuXG4gIF9wcmludEF1eEJlZm9yZUNvbW1lbnQoKSB7XG4gICAgaWYgKHRoaXMuX3ByaW50QXV4QWZ0ZXJPbk5leHRVc2VyTm9kZSkgcmV0dXJuO1xuICAgIHRoaXMuX3ByaW50QXV4QWZ0ZXJPbk5leHRVc2VyTm9kZSA9IHRydWU7XG4gICAgY29uc3QgY29tbWVudCA9IHRoaXMuZm9ybWF0LmF1eGlsaWFyeUNvbW1lbnRCZWZvcmU7XG5cbiAgICBpZiAoY29tbWVudCkge1xuICAgICAgdGhpcy5fcHJpbnRDb21tZW50KHtcbiAgICAgICAgdHlwZTogXCJDb21tZW50QmxvY2tcIixcbiAgICAgICAgdmFsdWU6IGNvbW1lbnRcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIF9wcmludEF1eEFmdGVyQ29tbWVudCgpIHtcbiAgICBpZiAoIXRoaXMuX3ByaW50QXV4QWZ0ZXJPbk5leHRVc2VyTm9kZSkgcmV0dXJuO1xuICAgIHRoaXMuX3ByaW50QXV4QWZ0ZXJPbk5leHRVc2VyTm9kZSA9IGZhbHNlO1xuICAgIGNvbnN0IGNvbW1lbnQgPSB0aGlzLmZvcm1hdC5hdXhpbGlhcnlDb21tZW50QWZ0ZXI7XG5cbiAgICBpZiAoY29tbWVudCkge1xuICAgICAgdGhpcy5fcHJpbnRDb21tZW50KHtcbiAgICAgICAgdHlwZTogXCJDb21tZW50QmxvY2tcIixcbiAgICAgICAgdmFsdWU6IGNvbW1lbnRcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGdldFBvc3NpYmxlUmF3KG5vZGUpIHtcbiAgICBjb25zdCBleHRyYSA9IG5vZGUuZXh0cmE7XG5cbiAgICBpZiAoZXh0cmEgJiYgZXh0cmEucmF3ICE9IG51bGwgJiYgZXh0cmEucmF3VmFsdWUgIT0gbnVsbCAmJiBub2RlLnZhbHVlID09PSBleHRyYS5yYXdWYWx1ZSkge1xuICAgICAgcmV0dXJuIGV4dHJhLnJhdztcbiAgICB9XG4gIH1cblxuICBwcmludEpvaW4obm9kZXMsIHBhcmVudCwgb3B0cyA9IHt9KSB7XG4gICAgaWYgKCFub2RlcyB8fCAhbm9kZXMubGVuZ3RoKSByZXR1cm47XG4gICAgaWYgKG9wdHMuaW5kZW50KSB0aGlzLmluZGVudCgpO1xuICAgIGNvbnN0IG5ld2xpbmVPcHRzID0ge1xuICAgICAgYWRkTmV3bGluZXM6IG9wdHMuYWRkTmV3bGluZXNcbiAgICB9O1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBub2Rlcy5sZW5ndGg7IGkrKykge1xuICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldO1xuICAgICAgaWYgKCFub2RlKSBjb250aW51ZTtcbiAgICAgIGlmIChvcHRzLnN0YXRlbWVudCkgdGhpcy5fcHJpbnROZXdsaW5lKHRydWUsIG5vZGUsIHBhcmVudCwgbmV3bGluZU9wdHMpO1xuICAgICAgdGhpcy5wcmludChub2RlLCBwYXJlbnQpO1xuXG4gICAgICBpZiAob3B0cy5pdGVyYXRvcikge1xuICAgICAgICBvcHRzLml0ZXJhdG9yKG5vZGUsIGkpO1xuICAgICAgfVxuXG4gICAgICBpZiAob3B0cy5zZXBhcmF0b3IgJiYgaSA8IG5vZGVzLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgb3B0cy5zZXBhcmF0b3IuY2FsbCh0aGlzKTtcbiAgICAgIH1cblxuICAgICAgaWYgKG9wdHMuc3RhdGVtZW50KSB0aGlzLl9wcmludE5ld2xpbmUoZmFsc2UsIG5vZGUsIHBhcmVudCwgbmV3bGluZU9wdHMpO1xuICAgIH1cblxuICAgIGlmIChvcHRzLmluZGVudCkgdGhpcy5kZWRlbnQoKTtcbiAgfVxuXG4gIHByaW50QW5kSW5kZW50T25Db21tZW50cyhub2RlLCBwYXJlbnQpIHtcbiAgICBjb25zdCBpbmRlbnQgPSBub2RlLmxlYWRpbmdDb21tZW50cyAmJiBub2RlLmxlYWRpbmdDb21tZW50cy5sZW5ndGggPiAwO1xuICAgIGlmIChpbmRlbnQpIHRoaXMuaW5kZW50KCk7XG4gICAgdGhpcy5wcmludChub2RlLCBwYXJlbnQpO1xuICAgIGlmIChpbmRlbnQpIHRoaXMuZGVkZW50KCk7XG4gIH1cblxuICBwcmludEJsb2NrKHBhcmVudCkge1xuICAgIGNvbnN0IG5vZGUgPSBwYXJlbnQuYm9keTtcblxuICAgIGlmICghdCgpLmlzRW1wdHlTdGF0ZW1lbnQobm9kZSkpIHtcbiAgICAgIHRoaXMuc3BhY2UoKTtcbiAgICB9XG5cbiAgICB0aGlzLnByaW50KG5vZGUsIHBhcmVudCk7XG4gIH1cblxuICBfcHJpbnRUcmFpbGluZ0NvbW1lbnRzKG5vZGUsIHBhcmVudCkge1xuICAgIHRoaXMuX3ByaW50Q29tbWVudHModGhpcy5fZ2V0Q29tbWVudHMoZmFsc2UsIG5vZGUsIHBhcmVudCkpO1xuICB9XG5cbiAgX3ByaW50TGVhZGluZ0NvbW1lbnRzKG5vZGUsIHBhcmVudCkge1xuICAgIHRoaXMuX3ByaW50Q29tbWVudHModGhpcy5fZ2V0Q29tbWVudHModHJ1ZSwgbm9kZSwgcGFyZW50KSk7XG4gIH1cblxuICBwcmludElubmVyQ29tbWVudHMobm9kZSwgaW5kZW50ID0gdHJ1ZSkge1xuICAgIGlmICghbm9kZS5pbm5lckNvbW1lbnRzIHx8ICFub2RlLmlubmVyQ29tbWVudHMubGVuZ3RoKSByZXR1cm47XG4gICAgaWYgKGluZGVudCkgdGhpcy5pbmRlbnQoKTtcblxuICAgIHRoaXMuX3ByaW50Q29tbWVudHMobm9kZS5pbm5lckNvbW1lbnRzKTtcblxuICAgIGlmIChpbmRlbnQpIHRoaXMuZGVkZW50KCk7XG4gIH1cblxuICBwcmludFNlcXVlbmNlKG5vZGVzLCBwYXJlbnQsIG9wdHMgPSB7fSkge1xuICAgIG9wdHMuc3RhdGVtZW50ID0gdHJ1ZTtcbiAgICByZXR1cm4gdGhpcy5wcmludEpvaW4obm9kZXMsIHBhcmVudCwgb3B0cyk7XG4gIH1cblxuICBwcmludExpc3QoaXRlbXMsIHBhcmVudCwgb3B0cyA9IHt9KSB7XG4gICAgaWYgKG9wdHMuc2VwYXJhdG9yID09IG51bGwpIHtcbiAgICAgIG9wdHMuc2VwYXJhdG9yID0gY29tbWFTZXBhcmF0b3I7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucHJpbnRKb2luKGl0ZW1zLCBwYXJlbnQsIG9wdHMpO1xuICB9XG5cbiAgX3ByaW50TmV3bGluZShsZWFkaW5nLCBub2RlLCBwYXJlbnQsIG9wdHMpIHtcbiAgICBpZiAodGhpcy5mb3JtYXQucmV0YWluTGluZXMgfHwgdGhpcy5mb3JtYXQuY29tcGFjdCkgcmV0dXJuO1xuXG4gICAgaWYgKHRoaXMuZm9ybWF0LmNvbmNpc2UpIHtcbiAgICAgIHRoaXMuc3BhY2UoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBsZXQgbGluZXMgPSAwO1xuXG4gICAgaWYgKHRoaXMuX2J1Zi5oYXNDb250ZW50KCkpIHtcbiAgICAgIGlmICghbGVhZGluZykgbGluZXMrKztcbiAgICAgIGlmIChvcHRzLmFkZE5ld2xpbmVzKSBsaW5lcyArPSBvcHRzLmFkZE5ld2xpbmVzKGxlYWRpbmcsIG5vZGUpIHx8IDA7XG4gICAgICBjb25zdCBuZWVkcyA9IGxlYWRpbmcgPyBuLm5lZWRzV2hpdGVzcGFjZUJlZm9yZSA6IG4ubmVlZHNXaGl0ZXNwYWNlQWZ0ZXI7XG4gICAgICBpZiAobmVlZHMobm9kZSwgcGFyZW50KSkgbGluZXMrKztcbiAgICB9XG5cbiAgICB0aGlzLm5ld2xpbmUobGluZXMpO1xuICB9XG5cbiAgX2dldENvbW1lbnRzKGxlYWRpbmcsIG5vZGUpIHtcbiAgICByZXR1cm4gbm9kZSAmJiAobGVhZGluZyA/IG5vZGUubGVhZGluZ0NvbW1lbnRzIDogbm9kZS50cmFpbGluZ0NvbW1lbnRzKSB8fCBbXTtcbiAgfVxuXG4gIF9wcmludENvbW1lbnQoY29tbWVudCkge1xuICAgIGlmICghdGhpcy5mb3JtYXQuc2hvdWxkUHJpbnRDb21tZW50KGNvbW1lbnQudmFsdWUpKSByZXR1cm47XG4gICAgaWYgKGNvbW1lbnQuaWdub3JlKSByZXR1cm47XG4gICAgaWYgKHRoaXMuX3ByaW50ZWRDb21tZW50cy5oYXMoY29tbWVudCkpIHJldHVybjtcblxuICAgIHRoaXMuX3ByaW50ZWRDb21tZW50cy5hZGQoY29tbWVudCk7XG5cbiAgICBpZiAoY29tbWVudC5zdGFydCAhPSBudWxsKSB7XG4gICAgICBpZiAodGhpcy5fcHJpbnRlZENvbW1lbnRTdGFydHNbY29tbWVudC5zdGFydF0pIHJldHVybjtcbiAgICAgIHRoaXMuX3ByaW50ZWRDb21tZW50U3RhcnRzW2NvbW1lbnQuc3RhcnRdID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBjb25zdCBpc0Jsb2NrQ29tbWVudCA9IGNvbW1lbnQudHlwZSA9PT0gXCJDb21tZW50QmxvY2tcIjtcbiAgICB0aGlzLm5ld2xpbmUodGhpcy5fYnVmLmhhc0NvbnRlbnQoKSAmJiAhdGhpcy5fbm9MaW5lVGVybWluYXRvciAmJiBpc0Jsb2NrQ29tbWVudCA/IDEgOiAwKTtcbiAgICBpZiAoIXRoaXMuZW5kc1dpdGgoXCJbXCIpICYmICF0aGlzLmVuZHNXaXRoKFwie1wiKSkgdGhpcy5zcGFjZSgpO1xuICAgIGxldCB2YWwgPSAhaXNCbG9ja0NvbW1lbnQgJiYgIXRoaXMuX25vTGluZVRlcm1pbmF0b3IgPyBgLy8ke2NvbW1lbnQudmFsdWV9XFxuYCA6IGAvKiR7Y29tbWVudC52YWx1ZX0qL2A7XG5cbiAgICBpZiAoaXNCbG9ja0NvbW1lbnQgJiYgdGhpcy5mb3JtYXQuaW5kZW50LmFkanVzdE11bHRpbGluZUNvbW1lbnQpIHtcbiAgICAgIGNvbnN0IG9mZnNldCA9IGNvbW1lbnQubG9jICYmIGNvbW1lbnQubG9jLnN0YXJ0LmNvbHVtbjtcblxuICAgICAgaWYgKG9mZnNldCkge1xuICAgICAgICBjb25zdCBuZXdsaW5lUmVnZXggPSBuZXcgUmVnRXhwKFwiXFxcXG5cXFxcc3sxLFwiICsgb2Zmc2V0ICsgXCJ9XCIsIFwiZ1wiKTtcbiAgICAgICAgdmFsID0gdmFsLnJlcGxhY2UobmV3bGluZVJlZ2V4LCBcIlxcblwiKTtcbiAgICAgIH1cblxuICAgICAgY29uc3QgaW5kZW50U2l6ZSA9IE1hdGgubWF4KHRoaXMuX2dldEluZGVudCgpLmxlbmd0aCwgdGhpcy5fYnVmLmdldEN1cnJlbnRDb2x1bW4oKSk7XG4gICAgICB2YWwgPSB2YWwucmVwbGFjZSgvXFxuKD8hJCkvZywgYFxcbiR7KDAsIF9yZXBlYXQoKS5kZWZhdWx0KShcIiBcIiwgaW5kZW50U2l6ZSl9YCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuZW5kc1dpdGgoXCIvXCIpKSB0aGlzLl9zcGFjZSgpO1xuICAgIHRoaXMud2l0aFNvdXJjZShcInN0YXJ0XCIsIGNvbW1lbnQubG9jLCAoKSA9PiB7XG4gICAgICB0aGlzLl9hcHBlbmQodmFsKTtcbiAgICB9KTtcbiAgICB0aGlzLm5ld2xpbmUoaXNCbG9ja0NvbW1lbnQgJiYgIXRoaXMuX25vTGluZVRlcm1pbmF0b3IgPyAxIDogMCk7XG4gIH1cblxuICBfcHJpbnRDb21tZW50cyhjb21tZW50cykge1xuICAgIGlmICghY29tbWVudHMgfHwgIWNvbW1lbnRzLmxlbmd0aCkgcmV0dXJuO1xuXG4gICAgZm9yIChjb25zdCBjb21tZW50IG9mIGNvbW1lbnRzKSB7XG4gICAgICB0aGlzLl9wcmludENvbW1lbnQoY29tbWVudCk7XG4gICAgfVxuICB9XG5cbn1cblxuZXhwb3J0cy5kZWZhdWx0ID0gUHJpbnRlcjtcbk9iamVjdC5hc3NpZ24oUHJpbnRlci5wcm90b3R5cGUsIGdlbmVyYXRvckZ1bmN0aW9ucyk7XG5cbmZ1bmN0aW9uIGNvbW1hU2VwYXJhdG9yKCkge1xuICB0aGlzLnRva2VuKFwiLFwiKTtcbiAgdGhpcy5zcGFjZSgpO1xufSJdfQ==