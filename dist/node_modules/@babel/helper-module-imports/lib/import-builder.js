"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

function _assert() {
  const data = _interopRequireDefault(require("assert"));

  _assert = function () {
    return data;
  };

  return data;
}

function t() {
  const data = _interopRequireWildcard(require("@babel/types"));

  t = function () {
    return data;
  };

  return data;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  } else {
    var newObj = {};

    if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};

          if (desc.get || desc.set) {
            Object.defineProperty(newObj, key, desc);
          } else {
            newObj[key] = obj[key];
          }
        }
      }
    }

    newObj.default = obj;
    return newObj;
  }
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

class ImportBuilder {
  constructor(importedSource, scope, hub) {
    this._statements = [];
    this._resultName = null;
    this._scope = null;
    this._hub = null;
    this._scope = scope;
    this._hub = hub;
    this._importedSource = importedSource;
  }

  done() {
    return {
      statements: this._statements,
      resultName: this._resultName
    };
  }

  import() {
    this._statements.push(t().importDeclaration([], t().stringLiteral(this._importedSource)));

    return this;
  }

  require() {
    this._statements.push(t().expressionStatement(t().callExpression(t().identifier("require"), [t().stringLiteral(this._importedSource)])));

    return this;
  }

  namespace(name = "namespace") {
    name = this._scope.generateUidIdentifier(name);
    const statement = this._statements[this._statements.length - 1];
    (0, _assert().default)(statement.type === "ImportDeclaration");
    (0, _assert().default)(statement.specifiers.length === 0);
    statement.specifiers = [t().importNamespaceSpecifier(name)];
    this._resultName = t().cloneNode(name);
    return this;
  }

  default(name) {
    name = this._scope.generateUidIdentifier(name);
    const statement = this._statements[this._statements.length - 1];
    (0, _assert().default)(statement.type === "ImportDeclaration");
    (0, _assert().default)(statement.specifiers.length === 0);
    statement.specifiers = [t().importDefaultSpecifier(name)];
    this._resultName = t().cloneNode(name);
    return this;
  }

  named(name, importName) {
    if (importName === "default") return this.default(name);
    name = this._scope.generateUidIdentifier(name);
    const statement = this._statements[this._statements.length - 1];
    (0, _assert().default)(statement.type === "ImportDeclaration");
    (0, _assert().default)(statement.specifiers.length === 0);
    statement.specifiers = [t().importSpecifier(name, t().identifier(importName))];
    this._resultName = t().cloneNode(name);
    return this;
  }

  var(name) {
    name = this._scope.generateUidIdentifier(name);
    let statement = this._statements[this._statements.length - 1];

    if (statement.type !== "ExpressionStatement") {
      (0, _assert().default)(this._resultName);
      statement = t().expressionStatement(this._resultName);

      this._statements.push(statement);
    }

    this._statements[this._statements.length - 1] = t().variableDeclaration("var", [t().variableDeclarator(name, statement.expression)]);
    this._resultName = t().cloneNode(name);
    return this;
  }

  defaultInterop() {
    return this._interop(this._hub.addHelper("interopRequireDefault"));
  }

  wildcardInterop() {
    return this._interop(this._hub.addHelper("interopRequireWildcard"));
  }

  _interop(callee) {
    const statement = this._statements[this._statements.length - 1];

    if (statement.type === "ExpressionStatement") {
      statement.expression = t().callExpression(callee, [statement.expression]);
    } else if (statement.type === "VariableDeclaration") {
      (0, _assert().default)(statement.declarations.length === 1);
      statement.declarations[0].init = t().callExpression(callee, [statement.declarations[0].init]);
    } else {
      _assert().default.fail("Unexpected type.");
    }

    return this;
  }

  prop(name) {
    const statement = this._statements[this._statements.length - 1];

    if (statement.type === "ExpressionStatement") {
      statement.expression = t().memberExpression(statement.expression, t().identifier(name));
    } else if (statement.type === "VariableDeclaration") {
      (0, _assert().default)(statement.declarations.length === 1);
      statement.declarations[0].init = t().memberExpression(statement.declarations[0].init, t().identifier(name));
    } else {
      _assert().default.fail("Unexpected type:" + statement.type);
    }

    return this;
  }

  read(name) {
    this._resultName = t().memberExpression(this._resultName, t().identifier(name));
  }

}

exports.default = ImportBuilder;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvaGVscGVyLW1vZHVsZS1pbXBvcnRzL2xpYi9pbXBvcnQtYnVpbGRlci5qcyJdLCJuYW1lcyI6WyJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImV4cG9ydHMiLCJ2YWx1ZSIsImRlZmF1bHQiLCJfYXNzZXJ0IiwiZGF0YSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwidCIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwib2JqIiwiX19lc01vZHVsZSIsIm5ld09iaiIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlc2MiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXQiLCJzZXQiLCJJbXBvcnRCdWlsZGVyIiwiY29uc3RydWN0b3IiLCJpbXBvcnRlZFNvdXJjZSIsInNjb3BlIiwiaHViIiwiX3N0YXRlbWVudHMiLCJfcmVzdWx0TmFtZSIsIl9zY29wZSIsIl9odWIiLCJfaW1wb3J0ZWRTb3VyY2UiLCJkb25lIiwic3RhdGVtZW50cyIsInJlc3VsdE5hbWUiLCJpbXBvcnQiLCJwdXNoIiwiaW1wb3J0RGVjbGFyYXRpb24iLCJzdHJpbmdMaXRlcmFsIiwiZXhwcmVzc2lvblN0YXRlbWVudCIsImNhbGxFeHByZXNzaW9uIiwiaWRlbnRpZmllciIsIm5hbWVzcGFjZSIsIm5hbWUiLCJnZW5lcmF0ZVVpZElkZW50aWZpZXIiLCJzdGF0ZW1lbnQiLCJsZW5ndGgiLCJ0eXBlIiwic3BlY2lmaWVycyIsImltcG9ydE5hbWVzcGFjZVNwZWNpZmllciIsImNsb25lTm9kZSIsImltcG9ydERlZmF1bHRTcGVjaWZpZXIiLCJuYW1lZCIsImltcG9ydE5hbWUiLCJpbXBvcnRTcGVjaWZpZXIiLCJ2YXIiLCJ2YXJpYWJsZURlY2xhcmF0aW9uIiwidmFyaWFibGVEZWNsYXJhdG9yIiwiZXhwcmVzc2lvbiIsImRlZmF1bHRJbnRlcm9wIiwiX2ludGVyb3AiLCJhZGRIZWxwZXIiLCJ3aWxkY2FyZEludGVyb3AiLCJjYWxsZWUiLCJkZWNsYXJhdGlvbnMiLCJpbml0IiwiZmFpbCIsInByb3AiLCJtZW1iZXJFeHByZXNzaW9uIiwicmVhZCJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLE9BQVIsR0FBa0IsS0FBSyxDQUF2Qjs7QUFFQSxTQUFTQyxPQUFULEdBQW1CO0FBQ2pCLFFBQU1DLElBQUksR0FBR0Msc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxRQUFELENBQVIsQ0FBbkM7O0FBRUFILEVBQUFBLE9BQU8sR0FBRyxZQUFZO0FBQ3BCLFdBQU9DLElBQVA7QUFDRCxHQUZEOztBQUlBLFNBQU9BLElBQVA7QUFDRDs7QUFFRCxTQUFTRyxDQUFULEdBQWE7QUFDWCxRQUFNSCxJQUFJLEdBQUdJLHVCQUF1QixDQUFDRixPQUFPLENBQUMsY0FBRCxDQUFSLENBQXBDOztBQUVBQyxFQUFBQSxDQUFDLEdBQUcsWUFBWTtBQUNkLFdBQU9ILElBQVA7QUFDRCxHQUZEOztBQUlBLFNBQU9BLElBQVA7QUFDRDs7QUFFRCxTQUFTSSx1QkFBVCxDQUFpQ0MsR0FBakMsRUFBc0M7QUFBRSxNQUFJQSxHQUFHLElBQUlBLEdBQUcsQ0FBQ0MsVUFBZixFQUEyQjtBQUFFLFdBQU9ELEdBQVA7QUFBYSxHQUExQyxNQUFnRDtBQUFFLFFBQUlFLE1BQU0sR0FBRyxFQUFiOztBQUFpQixRQUFJRixHQUFHLElBQUksSUFBWCxFQUFpQjtBQUFFLFdBQUssSUFBSUcsR0FBVCxJQUFnQkgsR0FBaEIsRUFBcUI7QUFBRSxZQUFJWCxNQUFNLENBQUNlLFNBQVAsQ0FBaUJDLGNBQWpCLENBQWdDQyxJQUFoQyxDQUFxQ04sR0FBckMsRUFBMENHLEdBQTFDLENBQUosRUFBb0Q7QUFBRSxjQUFJSSxJQUFJLEdBQUdsQixN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YUFBbEIiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHZvaWQgMDtcblxuZnVuY3Rpb24gX2Fzc2VydCgpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImFzc2VydFwiKSk7XG5cbiAgX2Fzc2VydCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gdCgpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCJAYmFiZWwvdHlwZXNcIikpO1xuXG4gIHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuY2xhc3MgSW1wb3J0QnVpbGRlciB7XG4gIGNvbnN0cnVjdG9yKGltcG9ydGVkU291cmNlLCBzY29wZSwgaHViKSB7XG4gICAgdGhpcy5fc3RhdGVtZW50cyA9IFtdO1xuICAgIHRoaXMuX3Jlc3VsdE5hbWUgPSBudWxsO1xuICAgIHRoaXMuX3Njb3BlID0gbnVsbDtcbiAgICB0aGlzLl9odWIgPSBudWxsO1xuICAgIHRoaXMuX3Njb3BlID0gc2NvcGU7XG4gICAgdGhpcy5faHViID0gaHViO1xuICAgIHRoaXMuX2ltcG9ydGVkU291cmNlID0gaW1wb3J0ZWRTb3VyY2U7XG4gIH1cblxuICBkb25lKCkge1xuICAgIHJldHVybiB7XG4gICAgICBzdGF0ZW1lbnRzOiB0aGlzLl9zdGF0ZW1lbnRzLFxuICAgICAgcmVzdWx0TmFtZTogdGhpcy5fcmVzdWx0TmFtZVxuICAgIH07XG4gIH1cblxuICBpbXBvcnQoKSB7XG4gICAgdGhpcy5fc3RhdGVtZW50cy5wdXNoKHQoKS5pbXBvcnREZWNsYXJhdGlvbihbXSwgdCgpLnN0cmluZ0xpdGVyYWwodGhpcy5faW1wb3J0ZWRTb3VyY2UpKSk7XG5cbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHJlcXVpcmUoKSB7XG4gICAgdGhpcy5fc3RhdGVtZW50cy5wdXNoKHQoKS5leHByZXNzaW9uU3RhdGVtZW50KHQoKS5jYWxsRXhwcmVzc2lvbih0KCkuaWRlbnRpZmllcihcInJlcXVpcmVcIiksIFt0KCkuc3RyaW5nTGl0ZXJhbCh0aGlzLl9pbXBvcnRlZFNvdXJjZSldKSkpO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBuYW1lc3BhY2UobmFtZSA9IFwibmFtZXNwYWNlXCIpIHtcbiAgICBuYW1lID0gdGhpcy5fc2NvcGUuZ2VuZXJhdGVVaWRJZGVudGlmaWVyKG5hbWUpO1xuICAgIGNvbnN0IHN0YXRlbWVudCA9IHRoaXMuX3N0YXRlbWVudHNbdGhpcy5fc3RhdGVtZW50cy5sZW5ndGggLSAxXTtcbiAgICAoMCwgX2Fzc2VydCgpLmRlZmF1bHQpKHN0YXRlbWVudC50eXBlID09PSBcIkltcG9ydERlY2xhcmF0aW9uXCIpO1xuICAgICgwLCBfYXNzZXJ0KCkuZGVmYXVsdCkoc3RhdGVtZW50LnNwZWNpZmllcnMubGVuZ3RoID09PSAwKTtcbiAgICBzdGF0ZW1lbnQuc3BlY2lmaWVycyA9IFt0KCkuaW1wb3J0TmFtZXNwYWNlU3BlY2lmaWVyKG5hbWUpXTtcbiAgICB0aGlzLl9yZXN1bHROYW1lID0gdCgpLmNsb25lTm9kZShuYW1lKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIGRlZmF1bHQobmFtZSkge1xuICAgIG5hbWUgPSB0aGlzLl9zY29wZS5nZW5lcmF0ZVVpZElkZW50aWZpZXIobmFtZSk7XG4gICAgY29uc3Qgc3RhdGVtZW50ID0gdGhpcy5fc3RhdGVtZW50c1t0aGlzLl9zdGF0ZW1lbnRzLmxlbmd0aCAtIDFdO1xuICAgICgwLCBfYXNzZXJ0KCkuZGVmYXVsdCkoc3RhdGVtZW50LnR5cGUgPT09IFwiSW1wb3J0RGVjbGFyYXRpb25cIik7XG4gICAgKDAsIF9hc3NlcnQoKS5kZWZhdWx0KShzdGF0ZW1lbnQuc3BlY2lmaWVycy5sZW5ndGggPT09IDApO1xuICAgIHN0YXRlbWVudC5zcGVjaWZpZXJzID0gW3QoKS5pbXBvcnREZWZhdWx0U3BlY2lmaWVyKG5hbWUpXTtcbiAgICB0aGlzLl9yZXN1bHROYW1lID0gdCgpLmNsb25lTm9kZShuYW1lKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIG5hbWVkKG5hbWUsIGltcG9ydE5hbWUpIHtcbiAgICBpZiAoaW1wb3J0TmFtZSA9PT0gXCJkZWZhdWx0XCIpIHJldHVybiB0aGlzLmRlZmF1bHQobmFtZSk7XG4gICAgbmFtZSA9IHRoaXMuX3Njb3BlLmdlbmVyYXRlVWlkSWRlbnRpZmllcihuYW1lKTtcbiAgICBjb25zdCBzdGF0ZW1lbnQgPSB0aGlzLl9zdGF0ZW1lbnRzW3RoaXMuX3N0YXRlbWVudHMubGVuZ3RoIC0gMV07XG4gICAgKDAsIF9hc3NlcnQoKS5kZWZhdWx0KShzdGF0ZW1lbnQudHlwZSA9PT0gXCJJbXBvcnREZWNsYXJhdGlvblwiKTtcbiAgICAoMCwgX2Fzc2VydCgpLmRlZmF1bHQpKHN0YXRlbWVudC5zcGVjaWZpZXJzLmxlbmd0aCA9PT0gMCk7XG4gICAgc3RhdGVtZW50LnNwZWNpZmllcnMgPSBbdCgpLmltcG9ydFNwZWNpZmllcihuYW1lLCB0KCkuaWRlbnRpZmllcihpbXBvcnROYW1lKSldO1xuICAgIHRoaXMuX3Jlc3VsdE5hbWUgPSB0KCkuY2xvbmVOb2RlKG5hbWUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgdmFyKG5hbWUpIHtcbiAgICBuYW1lID0gdGhpcy5fc2NvcGUuZ2VuZXJhdGVVaWRJZGVudGlmaWVyKG5hbWUpO1xuICAgIGxldCBzdGF0ZW1lbnQgPSB0aGlzLl9zdGF0ZW1lbnRzW3RoaXMuX3N0YXRlbWVudHMubGVuZ3RoIC0gMV07XG5cbiAgICBpZiAoc3RhdGVtZW50LnR5cGUgIT09IFwiRXhwcmVzc2lvblN0YXRlbWVudFwiKSB7XG4gICAgICAoMCwgX2Fzc2VydCgpLmRlZmF1bHQpKHRoaXMuX3Jlc3VsdE5hbWUpO1xuICAgICAgc3RhdGVtZW50ID0gdCgpLmV4cHJlc3Npb25TdGF0ZW1lbnQodGhpcy5fcmVzdWx0TmFtZSk7XG5cbiAgICAgIHRoaXMuX3N0YXRlbWVudHMucHVzaChzdGF0ZW1lbnQpO1xuICAgIH1cblxuICAgIHRoaXMuX3N0YXRlbWVudHNbdGhpcy5fc3RhdGVtZW50cy5sZW5ndGggLSAxXSA9IHQoKS52YXJpYWJsZURlY2xhcmF0aW9uKFwidmFyXCIsIFt0KCkudmFyaWFibGVEZWNsYXJhdG9yKG5hbWUsIHN0YXRlbWVudC5leHByZXNzaW9uKV0pO1xuICAgIHRoaXMuX3Jlc3VsdE5hbWUgPSB0KCkuY2xvbmVOb2RlKG5hbWUpO1xuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgZGVmYXVsdEludGVyb3AoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ludGVyb3AodGhpcy5faHViLmFkZEhlbHBlcihcImludGVyb3BSZXF1aXJlRGVmYXVsdFwiKSk7XG4gIH1cblxuICB3aWxkY2FyZEludGVyb3AoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2ludGVyb3AodGhpcy5faHViLmFkZEhlbHBlcihcImludGVyb3BSZXF1aXJlV2lsZGNhcmRcIikpO1xuICB9XG5cbiAgX2ludGVyb3AoY2FsbGVlKSB7XG4gICAgY29uc3Qgc3RhdGVtZW50ID0gdGhpcy5fc3RhdGVtZW50c1t0aGlzLl9zdGF0ZW1lbnRzLmxlbmd0aCAtIDFdO1xuXG4gICAgaWYgKHN0YXRlbWVudC50eXBlID09PSBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIikge1xuICAgICAgc3RhdGVtZW50LmV4cHJlc3Npb24gPSB0KCkuY2FsbEV4cHJlc3Npb24oY2FsbGVlLCBbc3RhdGVtZW50LmV4cHJlc3Npb25dKTtcbiAgICB9IGVsc2UgaWYgKHN0YXRlbWVudC50eXBlID09PSBcIlZhcmlhYmxlRGVjbGFyYXRpb25cIikge1xuICAgICAgKDAsIF9hc3NlcnQoKS5kZWZhdWx0KShzdGF0ZW1lbnQuZGVjbGFyYXRpb25zLmxlbmd0aCA9PT0gMSk7XG4gICAgICBzdGF0ZW1lbnQuZGVjbGFyYXRpb25zWzBdLmluaXQgPSB0KCkuY2FsbEV4cHJlc3Npb24oY2FsbGVlLCBbc3RhdGVtZW50LmRlY2xhcmF0aW9uc1swXS5pbml0XSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIF9hc3NlcnQoKS5kZWZhdWx0LmZhaWwoXCJVbmV4cGVjdGVkIHR5cGUuXCIpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcHJvcChuYW1lKSB7XG4gICAgY29uc3Qgc3RhdGVtZW50ID0gdGhpcy5fc3RhdGVtZW50c1t0aGlzLl9zdGF0ZW1lbnRzLmxlbmd0aCAtIDFdO1xuXG4gICAgaWYgKHN0YXRlbWVudC50eXBlID09PSBcIkV4cHJlc3Npb25TdGF0ZW1lbnRcIikge1xuICAgICAgc3RhdGVtZW50LmV4cHJlc3Npb24gPSB0KCkubWVtYmVyRXhwcmVzc2lvbihzdGF0ZW1lbnQuZXhwcmVzc2lvbiwgdCgpLmlkZW50aWZpZXIobmFtZSkpO1xuICAgIH0gZWxzZSBpZiAoc3RhdGVtZW50LnR5cGUgPT09IFwiVmFyaWFibGVEZWNsYXJhdGlvblwiKSB7XG4gICAgICAoMCwgX2Fzc2VydCgpLmRlZmF1bHQpKHN0YXRlbWVudC5kZWNsYXJhdGlvbnMubGVuZ3RoID09PSAxKTtcbiAgICAgIHN0YXRlbWVudC5kZWNsYXJhdGlvbnNbMF0uaW5pdCA9IHQoKS5tZW1iZXJFeHByZXNzaW9uKHN0YXRlbWVudC5kZWNsYXJhdGlvbnNbMF0uaW5pdCwgdCgpLmlkZW50aWZpZXIobmFtZSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBfYXNzZXJ0KCkuZGVmYXVsdC5mYWlsKFwiVW5leHBlY3RlZCB0eXBlOlwiICsgc3RhdGVtZW50LnR5cGUpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzO1xuICB9XG5cbiAgcmVhZChuYW1lKSB7XG4gICAgdGhpcy5fcmVzdWx0TmFtZSA9IHQoKS5tZW1iZXJFeHByZXNzaW9uKHRoaXMuX3Jlc3VsdE5hbWUsIHQoKS5pZGVudGlmaWVyKG5hbWUpKTtcbiAgfVxuXG59XG5cbmV4cG9ydHMuZGVmYXVsdCA9IEltcG9ydEJ1aWxkZXI7Il19