"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.msg = msg;
exports.access = access;
exports.assertRootMode = assertRootMode;
exports.assertSourceMaps = assertSourceMaps;
exports.assertCompact = assertCompact;
exports.assertSourceType = assertSourceType;
exports.assertCallerMetadata = assertCallerMetadata;
exports.assertInputSourceMap = assertInputSourceMap;
exports.assertString = assertString;
exports.assertFunction = assertFunction;
exports.assertBoolean = assertBoolean;
exports.assertObject = assertObject;
exports.assertArray = assertArray;
exports.assertIgnoreList = assertIgnoreList;
exports.assertConfigApplicableTest = assertConfigApplicableTest;
exports.assertConfigFileSearch = assertConfigFileSearch;
exports.assertBabelrcSearch = assertBabelrcSearch;
exports.assertPluginList = assertPluginList;

function msg(loc) {
  switch (loc.type) {
    case "root":
      return ``;

    case "env":
      return `${msg(loc.parent)}.env["${loc.name}"]`;

    case "overrides":
      return `${msg(loc.parent)}.overrides[${loc.index}]`;

    case "option":
      return `${msg(loc.parent)}.${loc.name}`;

    case "access":
      return `${msg(loc.parent)}[${JSON.stringify(loc.name)}]`;

    default:
      throw new Error(`Assertion failure: Unknown type ${loc.type}`);
  }
}

function access(loc, name) {
  return {
    type: "access",
    name,
    parent: loc
  };
}

function assertRootMode(loc, value) {
  if (value !== undefined && value !== "root" && value !== "upward" && value !== "upward-optional") {
    throw new Error(`${msg(loc)} must be a "root", "upward", "upward-optional" or undefined`);
  }

  return value;
}

function assertSourceMaps(loc, value) {
  if (value !== undefined && typeof value !== "boolean" && value !== "inline" && value !== "both") {
    throw new Error(`${msg(loc)} must be a boolean, "inline", "both", or undefined`);
  }

  return value;
}

function assertCompact(loc, value) {
  if (value !== undefined && typeof value !== "boolean" && value !== "auto") {
    throw new Error(`${msg(loc)} must be a boolean, "auto", or undefined`);
  }

  return value;
}

function assertSourceType(loc, value) {
  if (value !== undefined && value !== "module" && value !== "script" && value !== "unambiguous") {
    throw new Error(`${msg(loc)} must be "module", "script", "unambiguous", or undefined`);
  }

  return value;
}

function assertCallerMetadata(loc, value) {
  const obj = assertObject(loc, value);

  if (obj) {
    if (typeof obj["name"] !== "string") {
      throw new Error(`${msg(loc)} set but does not contain "name" property string`);
    }

    for (const prop of Object.keys(obj)) {
      const propLoc = access(loc, prop);
      const value = obj[prop];

      if (value != null && typeof value !== "boolean" && typeof value !== "string" && typeof value !== "number") {
        throw new Error(`${msg(propLoc)} must be null, undefined, a boolean, a string, or a number.`);
      }
    }
  }

  return value;
}

function assertInputSourceMap(loc, value) {
  if (value !== undefined && typeof value !== "boolean" && (typeof value !== "object" || !value)) {
    throw new Error(`${msg(loc)} must be a boolean, object, or undefined`);
  }

  return value;
}

function assertString(loc, value) {
  if (value !== undefined && typeof value !== "string") {
    throw new Error(`${msg(loc)} must be a string, or undefined`);
  }

  return value;
}

function assertFunction(loc, value) {
  if (value !== undefined && typeof value !== "function") {
    throw new Error(`${msg(loc)} must be a function, or undefined`);
  }

  return value;
}

function assertBoolean(loc, value) {
  if (value !== undefined && typeof value !== "boolean") {
    throw new Error(`${msg(loc)} must be a boolean, or undefined`);
  }

  return value;
}

function assertObject(loc, value) {
  if (value !== undefined && (typeof value !== "object" || Array.isArray(value) || !value)) {
    throw new Error(`${msg(loc)} must be an object, or undefined`);
  }

  return value;
}

function assertArray(loc, value) {
  if (value != null && !Array.isArray(value)) {
    throw new Error(`${msg(loc)} must be an array, or undefined`);
  }

  return value;
}

function assertIgnoreList(loc, value) {
  const arr = assertArray(loc, value);

  if (arr) {
    arr.forEach((item, i) => assertIgnoreItem(access(loc, i), item));
  }

  return arr;
}

function assertIgnoreItem(loc, value) {
  if (typeof value !== "string" && typeof value !== "function" && !(value instanceof RegExp)) {
    throw new Error(`${msg(loc)} must be an array of string/Funtion/RegExp values, or undefined`);
  }

  return value;
}

function assertConfigApplicableTest(loc, value) {
  if (value === undefined) return value;

  if (Array.isArray(value)) {
    value.forEach((item, i) => {
      if (!checkValidTest(item)) {
        throw new Error(`${msg(access(loc, i))} must be a string/Function/RegExp.`);
      }
    });
  } else if (!checkValidTest(value)) {
    throw new Error(`${msg(loc)} must be a string/Function/RegExp, or an array of those`);
  }

  return value;
}

function checkValidTest(value) {
  return typeof value === "string" || typeof value === "function" || value instanceof RegExp;
}

function assertConfigFileSearch(loc, value) {
  if (value !== undefined && typeof value !== "boolean" && typeof value !== "string") {
    throw new Error(`${msg(loc)} must be a undefined, a boolean, a string, ` + `got ${JSON.stringify(value)}`);
  }

  return value;
}

function assertBabelrcSearch(loc, value) {
  if (value === undefined || typeof value === "boolean") return value;

  if (Array.isArray(value)) {
    value.forEach((item, i) => {
      if (!checkValidTest(item)) {
        throw new Error(`${msg(access(loc, i))} must be a string/Function/RegExp.`);
      }
    });
  } else if (!checkValidTest(value)) {
    throw new Error(`${msg(loc)} must be a undefined, a boolean, a string/Function/RegExp ` + `or an array of those, got ${JSON.stringify(value)}`);
  }

  return value;
}

function assertPluginList(loc, value) {
  const arr = assertArray(loc, value);

  if (arr) {
    arr.forEach((item, i) => assertPluginItem(access(loc, i), item));
  }

  return arr;
}

function assertPluginItem(loc, value) {
  if (Array.isArray(value)) {
    if (value.length === 0) {
      throw new Error(`${msg(loc)} must include an object`);
    }

    if (value.length > 3) {
      throw new Error(`${msg(loc)} may only be a two-tuple or three-tuple`);
    }

    assertPluginTarget(access(loc, 0), value[0]);

    if (value.length > 1) {
      const opts = value[1];

      if (opts !== undefined && opts !== false && (typeof opts !== "object" || Array.isArray(opts))) {
        throw new Error(`${msg(access(loc, 1))} must be an object, false, or undefined`);
      }
    }

    if (value.length === 3) {
      const name = value[2];

      if (name !== undefined && typeof name !== "string") {
        throw new Error(`${msg(access(loc, 2))} must be a string, or undefined`);
      }
    }
  } else {
    assertPluginTarget(loc, value);
  }

  return value;
}

function assertPluginTarget(loc, value) {
  if ((typeof value !== "object" || !value) && typeof value !== "string" && typeof value !== "function") {
    throw new Error(`${msg(loc)} must be a string, object, function`);
  }

  return value;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvY29yZS9saWIvY29uZmlnL3ZhbGlkYXRpb24vb3B0aW9uLWFzc2VydGlvbnMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJtc2ciLCJhY2Nlc3MiLCJhc3NlcnRSb290TW9kZSIsImFzc2VydFNvdXJjZU1hcHMiLCJhc3NlcnRDb21wYWN0IiwiYXNzZXJ0U291cmNlVHlwZSIsImFzc2VydENhbGxlck1ldGFkYXRhIiwiYXNzZXJ0SW5wdXRTb3VyY2VNYXAiLCJhc3NlcnRTdHJpbmciLCJhc3NlcnRGdW5jdGlvbiIsImFzc2VydEJvb2xlYW4iLCJhc3NlcnRPYmplY3QiLCJhc3NlcnRBcnJheSIsImFzc2VydElnbm9yZUxpc3QiLCJhc3NlcnRDb25maWdBcHBsaWNhYmxlVGVzdCIsImFzc2VydENvbmZpZ0ZpbGVTZWFyY2giLCJhc3NlcnRCYWJlbHJjU2VhcmNoIiwiYXNzZXJ0UGx1Z2luTGlzdCIsImxvYyIsInR5cGUiLCJwYXJlbnQiLCJuYW1lIiwiaW5kZXgiLCJKU09OIiwic3RyaW5naWZ5IiwiRXJyb3IiLCJ1bmRlZmluZWQiLCJvYmoiLCJwcm9wIiwia2V5cyIsInByb3BMb2MiLCJBcnJheSIsImlzQXJyYXkiLCJhcnIiLCJmb3JFYWNoIiwiaXRlbSIsImkiLCJhc3NlcnRJZ25vcmVJdGVtIiwiUmVnRXhwIiwiY2hlY2tWYWxpZFRlc3QiLCJhc3NlcnRQbHVnaW5JdGVtIiwibGVuZ3RoIiwiYXNzZXJ0UGx1Z2luVGFyZ2V0Iiwib3B0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLEdBQVIsR0FBY0EsR0FBZDtBQUNBRixPQUFPLENBQUNH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LENBQVcsR0FBRXpCLEdBQUcsQ0FBQ2tCLEdBQUQsQ0FBTSxxQ0FBdEIsQ0FBTjtBQUNEOztBQUVELFNBQU9uQixLQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMubXNnID0gbXNnO1xuZXhwb3J0cy5hY2Nlc3MgPSBhY2Nlc3M7XG5leHBvcnRzLmFzc2VydFJvb3RNb2RlID0gYXNzZXJ0Um9vdE1vZGU7XG5leHBvcnRzLmFzc2VydFNvdXJjZU1hcHMgPSBhc3NlcnRTb3VyY2VNYXBzO1xuZXhwb3J0cy5hc3NlcnRDb21wYWN0ID0gYXNzZXJ0Q29tcGFjdDtcbmV4cG9ydHMuYXNzZXJ0U291cmNlVHlwZSA9IGFzc2VydFNvdXJjZVR5cGU7XG5leHBvcnRzLmFzc2VydENhbGxlck1ldGFkYXRhID0gYXNzZXJ0Q2FsbGVyTWV0YWRhdGE7XG5leHBvcnRzLmFzc2VydElucHV0U291cmNlTWFwID0gYXNzZXJ0SW5wdXRTb3VyY2VNYXA7XG5leHBvcnRzLmFzc2VydFN0cmluZyA9IGFzc2VydFN0cmluZztcbmV4cG9ydHMuYXNzZXJ0RnVuY3Rpb24gPSBhc3NlcnRGdW5jdGlvbjtcbmV4cG9ydHMuYXNzZXJ0Qm9vbGVhbiA9IGFzc2VydEJvb2xlYW47XG5leHBvcnRzLmFzc2VydE9iamVjdCA9IGFzc2VydE9iamVjdDtcbmV4cG9ydHMuYXNzZXJ0QXJyYXkgPSBhc3NlcnRBcnJheTtcbmV4cG9ydHMuYXNzZXJ0SWdub3JlTGlzdCA9IGFzc2VydElnbm9yZUxpc3Q7XG5leHBvcnRzLmFzc2VydENvbmZpZ0FwcGxpY2FibGVUZXN0ID0gYXNzZXJ0Q29uZmlnQXBwbGljYWJsZVRlc3Q7XG5leHBvcnRzLmFzc2VydENvbmZpZ0ZpbGVTZWFyY2ggPSBhc3NlcnRDb25maWdGaWxlU2VhcmNoO1xuZXhwb3J0cy5hc3NlcnRCYWJlbHJjU2VhcmNoID0gYXNzZXJ0QmFiZWxyY1NlYXJjaDtcbmV4cG9ydHMuYXNzZXJ0UGx1Z2luTGlzdCA9IGFzc2VydFBsdWdpbkxpc3Q7XG5cbmZ1bmN0aW9uIG1zZyhsb2MpIHtcbiAgc3dpdGNoIChsb2MudHlwZSkge1xuICAgIGNhc2UgXCJyb290XCI6XG4gICAgICByZXR1cm4gYGA7XG5cbiAgICBjYXNlIFwiZW52XCI6XG4gICAgICByZXR1cm4gYCR7bXNnKGxvYy5wYXJlbnQpfS5lbnZbXCIke2xvYy5uYW1lfVwiXWA7XG5cbiAgICBjYXNlIFwib3ZlcnJpZGVzXCI6XG4gICAgICByZXR1cm4gYCR7bXNnKGxvYy5wYXJlbnQpfS5vdmVycmlkZXNbJHtsb2MuaW5kZXh9XWA7XG5cbiAgICBjYXNlIFwib3B0aW9uXCI6XG4gICAgICByZXR1cm4gYCR7bXNnKGxvYy5wYXJlbnQpfS4ke2xvYy5uYW1lfWA7XG5cbiAgICBjYXNlIFwiYWNjZXNzXCI6XG4gICAgICByZXR1cm4gYCR7bXNnKGxvYy5wYXJlbnQpfVske0pTT04uc3RyaW5naWZ5KGxvYy5uYW1lKX1dYDtcblxuICAgIGRlZmF1bHQ6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFzc2VydGlvbiBmYWlsdXJlOiBVbmtub3duIHR5cGUgJHtsb2MudHlwZX1gKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBhY2Nlc3MobG9jLCBuYW1lKSB7XG4gIHJldHVybiB7XG4gICAgdHlwZTogXCJhY2Nlc3NcIixcbiAgICBuYW1lLFxuICAgIHBhcmVudDogbG9jXG4gIH07XG59XG5cbmZ1bmN0aW9uIGFzc2VydFJvb3RNb2RlKGxvYywgdmFsdWUpIHtcbiAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IFwicm9vdFwiICYmIHZhbHVlICE9PSBcInVwd2FyZFwiICYmIHZhbHVlICE9PSBcInVwd2FyZC1vcHRpb25hbFwiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGEgXCJyb290XCIsIFwidXB3YXJkXCIsIFwidXB3YXJkLW9wdGlvbmFsXCIgb3IgdW5kZWZpbmVkYCk7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGFzc2VydFNvdXJjZU1hcHMobG9jLCB2YWx1ZSkge1xuICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgdmFsdWUgIT09IFwiYm9vbGVhblwiICYmIHZhbHVlICE9PSBcImlubGluZVwiICYmIHZhbHVlICE9PSBcImJvdGhcIikge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHttc2cobG9jKX0gbXVzdCBiZSBhIGJvb2xlYW4sIFwiaW5saW5lXCIsIFwiYm90aFwiLCBvciB1bmRlZmluZWRgKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0Q29tcGFjdChsb2MsIHZhbHVlKSB7XG4gIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJib29sZWFuXCIgJiYgdmFsdWUgIT09IFwiYXV0b1wiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGEgYm9vbGVhbiwgXCJhdXRvXCIsIG9yIHVuZGVmaW5lZGApO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRTb3VyY2VUeXBlKGxvYywgdmFsdWUpIHtcbiAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IFwibW9kdWxlXCIgJiYgdmFsdWUgIT09IFwic2NyaXB0XCIgJiYgdmFsdWUgIT09IFwidW5hbWJpZ3VvdXNcIikge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHttc2cobG9jKX0gbXVzdCBiZSBcIm1vZHVsZVwiLCBcInNjcmlwdFwiLCBcInVuYW1iaWd1b3VzXCIsIG9yIHVuZGVmaW5lZGApO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRDYWxsZXJNZXRhZGF0YShsb2MsIHZhbHVlKSB7XG4gIGNvbnN0IG9iaiA9IGFzc2VydE9iamVjdChsb2MsIHZhbHVlKTtcblxuICBpZiAob2JqKSB7XG4gICAgaWYgKHR5cGVvZiBvYmpbXCJuYW1lXCJdICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bXNnKGxvYyl9IHNldCBidXQgZG9lcyBub3QgY29udGFpbiBcIm5hbWVcIiBwcm9wZXJ0eSBzdHJpbmdgKTtcbiAgICB9XG5cbiAgICBmb3IgKGNvbnN0IHByb3Agb2YgT2JqZWN0LmtleXMob2JqKSkge1xuICAgICAgY29uc3QgcHJvcExvYyA9IGFjY2Vzcyhsb2MsIHByb3ApO1xuICAgICAgY29uc3QgdmFsdWUgPSBvYmpbcHJvcF07XG5cbiAgICAgIGlmICh2YWx1ZSAhPSBudWxsICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJib29sZWFuXCIgJiYgdHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJudW1iZXJcIikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bXNnKHByb3BMb2MpfSBtdXN0IGJlIG51bGwsIHVuZGVmaW5lZCwgYSBib29sZWFuLCBhIHN0cmluZywgb3IgYSBudW1iZXIuYCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRJbnB1dFNvdXJjZU1hcChsb2MsIHZhbHVlKSB7XG4gIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJib29sZWFuXCIgJiYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJvYmplY3RcIiB8fCAhdmFsdWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGEgYm9vbGVhbiwgb2JqZWN0LCBvciB1bmRlZmluZWRgKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0U3RyaW5nKGxvYywgdmFsdWUpIHtcbiAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGEgc3RyaW5nLCBvciB1bmRlZmluZWRgKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0RnVuY3Rpb24obG9jLCB2YWx1ZSkge1xuICBpZiAodmFsdWUgIT09IHVuZGVmaW5lZCAmJiB0eXBlb2YgdmFsdWUgIT09IFwiZnVuY3Rpb25cIikge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHttc2cobG9jKX0gbXVzdCBiZSBhIGZ1bmN0aW9uLCBvciB1bmRlZmluZWRgKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0Qm9vbGVhbihsb2MsIHZhbHVlKSB7XG4gIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJib29sZWFuXCIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bXNnKGxvYyl9IG11c3QgYmUgYSBib29sZWFuLCBvciB1bmRlZmluZWRgKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0T2JqZWN0KGxvYywgdmFsdWUpIHtcbiAgaWYgKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgKHR5cGVvZiB2YWx1ZSAhPT0gXCJvYmplY3RcIiB8fCBBcnJheS5pc0FycmF5KHZhbHVlKSB8fCAhdmFsdWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGFuIG9iamVjdCwgb3IgdW5kZWZpbmVkYCk7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGFzc2VydEFycmF5KGxvYywgdmFsdWUpIHtcbiAgaWYgKHZhbHVlICE9IG51bGwgJiYgIUFycmF5LmlzQXJyYXkodmFsdWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGFuIGFycmF5LCBvciB1bmRlZmluZWRgKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0SWdub3JlTGlzdChsb2MsIHZhbHVlKSB7XG4gIGNvbnN0IGFyciA9IGFzc2VydEFycmF5KGxvYywgdmFsdWUpO1xuXG4gIGlmIChhcnIpIHtcbiAgICBhcnIuZm9yRWFjaCgoaXRlbSwgaSkgPT4gYXNzZXJ0SWdub3JlSXRlbShhY2Nlc3MobG9jLCBpKSwgaXRlbSkpO1xuICB9XG5cbiAgcmV0dXJuIGFycjtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0SWdub3JlSXRlbShsb2MsIHZhbHVlKSB7XG4gIGlmICh0eXBlb2YgdmFsdWUgIT09IFwic3RyaW5nXCIgJiYgdHlwZW9mIHZhbHVlICE9PSBcImZ1bmN0aW9uXCIgJiYgISh2YWx1ZSBpbnN0YW5jZW9mIFJlZ0V4cCkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bXNnKGxvYyl9IG11c3QgYmUgYW4gYXJyYXkgb2Ygc3RyaW5nL0Z1bnRpb24vUmVnRXhwIHZhbHVlcywgb3IgdW5kZWZpbmVkYCk7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGFzc2VydENvbmZpZ0FwcGxpY2FibGVUZXN0KGxvYywgdmFsdWUpIHtcbiAgaWYgKHZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybiB2YWx1ZTtcblxuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICB2YWx1ZS5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICBpZiAoIWNoZWNrVmFsaWRUZXN0KGl0ZW0pKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgJHttc2coYWNjZXNzKGxvYywgaSkpfSBtdXN0IGJlIGEgc3RyaW5nL0Z1bmN0aW9uL1JlZ0V4cC5gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIGlmICghY2hlY2tWYWxpZFRlc3QodmFsdWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGEgc3RyaW5nL0Z1bmN0aW9uL1JlZ0V4cCwgb3IgYW4gYXJyYXkgb2YgdGhvc2VgKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gY2hlY2tWYWxpZFRlc3QodmFsdWUpIHtcbiAgcmV0dXJuIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiB8fCB0eXBlb2YgdmFsdWUgPT09IFwiZnVuY3Rpb25cIiB8fCB2YWx1ZSBpbnN0YW5jZW9mIFJlZ0V4cDtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0Q29uZmlnRmlsZVNlYXJjaChsb2MsIHZhbHVlKSB7XG4gIGlmICh2YWx1ZSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJib29sZWFuXCIgJiYgdHlwZW9mIHZhbHVlICE9PSBcInN0cmluZ1wiKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGEgdW5kZWZpbmVkLCBhIGJvb2xlYW4sIGEgc3RyaW5nLCBgICsgYGdvdCAke0pTT04uc3RyaW5naWZ5KHZhbHVlKX1gKTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gYXNzZXJ0QmFiZWxyY1NlYXJjaChsb2MsIHZhbHVlKSB7XG4gIGlmICh2YWx1ZSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiB2YWx1ZSA9PT0gXCJib29sZWFuXCIpIHJldHVybiB2YWx1ZTtcblxuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICB2YWx1ZS5mb3JFYWNoKChpdGVtLCBpKSA9PiB7XG4gICAgICBpZiAoIWNoZWNrVmFsaWRUZXN0KGl0ZW0pKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgJHttc2coYWNjZXNzKGxvYywgaSkpfSBtdXN0IGJlIGEgc3RyaW5nL0Z1bmN0aW9uL1JlZ0V4cC5gKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBlbHNlIGlmICghY2hlY2tWYWxpZFRlc3QodmFsdWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtdXN0IGJlIGEgdW5kZWZpbmVkLCBhIGJvb2xlYW4sIGEgc3RyaW5nL0Z1bmN0aW9uL1JlZ0V4cCBgICsgYG9yIGFuIGFycmF5IG9mIHRob3NlLCBnb3QgJHtKU09OLnN0cmluZ2lmeSh2YWx1ZSl9YCk7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGFzc2VydFBsdWdpbkxpc3QobG9jLCB2YWx1ZSkge1xuICBjb25zdCBhcnIgPSBhc3NlcnRBcnJheShsb2MsIHZhbHVlKTtcblxuICBpZiAoYXJyKSB7XG4gICAgYXJyLmZvckVhY2goKGl0ZW0sIGkpID0+IGFzc2VydFBsdWdpbkl0ZW0oYWNjZXNzKGxvYywgaSksIGl0ZW0pKTtcbiAgfVxuXG4gIHJldHVybiBhcnI7XG59XG5cbmZ1bmN0aW9uIGFzc2VydFBsdWdpbkl0ZW0obG9jLCB2YWx1ZSkge1xuICBpZiAoQXJyYXkuaXNBcnJheSh2YWx1ZSkpIHtcbiAgICBpZiAodmFsdWUubGVuZ3RoID09PSAwKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYCR7bXNnKGxvYyl9IG11c3QgaW5jbHVkZSBhbiBvYmplY3RgKTtcbiAgICB9XG5cbiAgICBpZiAodmFsdWUubGVuZ3RoID4gMykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhsb2MpfSBtYXkgb25seSBiZSBhIHR3by10dXBsZSBvciB0aHJlZS10dXBsZWApO1xuICAgIH1cblxuICAgIGFzc2VydFBsdWdpblRhcmdldChhY2Nlc3MobG9jLCAwKSwgdmFsdWVbMF0pO1xuXG4gICAgaWYgKHZhbHVlLmxlbmd0aCA+IDEpIHtcbiAgICAgIGNvbnN0IG9wdHMgPSB2YWx1ZVsxXTtcblxuICAgICAgaWYgKG9wdHMgIT09IHVuZGVmaW5lZCAmJiBvcHRzICE9PSBmYWxzZSAmJiAodHlwZW9mIG9wdHMgIT09IFwib2JqZWN0XCIgfHwgQXJyYXkuaXNBcnJheShvcHRzKSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGAke21zZyhhY2Nlc3MobG9jLCAxKSl9IG11c3QgYmUgYW4gb2JqZWN0LCBmYWxzZSwgb3IgdW5kZWZpbmVkYCk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHZhbHVlLmxlbmd0aCA9PT0gMykge1xuICAgICAgY29uc3QgbmFtZSA9IHZhbHVlWzJdO1xuXG4gICAgICBpZiAobmFtZSAhPT0gdW5kZWZpbmVkICYmIHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgJHttc2coYWNjZXNzKGxvYywgMikpfSBtdXN0IGJlIGEgc3RyaW5nLCBvciB1bmRlZmluZWRgKTtcbiAgICAgIH1cbiAgICB9XG4gIH0gZWxzZSB7XG4gICAgYXNzZXJ0UGx1Z2luVGFyZ2V0KGxvYywgdmFsdWUpO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBhc3NlcnRQbHVnaW5UYXJnZXQobG9jLCB2YWx1ZSkge1xuICBpZiAoKHR5cGVvZiB2YWx1ZSAhPT0gXCJvYmplY3RcIiB8fCAhdmFsdWUpICYmIHR5cGVvZiB2YWx1ZSAhPT0gXCJzdHJpbmdcIiAmJiB0eXBlb2YgdmFsdWUgIT09IFwiZnVuY3Rpb25cIikge1xuICAgIHRocm93IG5ldyBFcnJvcihgJHttc2cobG9jKX0gbXVzdCBiZSBhIHN0cmluZywgb2JqZWN0LCBmdW5jdGlvbmApO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufSJdfQ==