"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.resolvePlugin = resolvePlugin;
exports.resolvePreset = resolvePreset;
exports.loadPlugin = loadPlugin;
exports.loadPreset = loadPreset;

function _debug() {
  const data = _interopRequireDefault(require("debug"));

  _debug = function () {
    return data;
  };

  return data;
}

function _resolve() {
  const data = _interopRequireDefault(require("resolve"));

  _resolve = function () {
    return data;
  };

  return data;
}

function _path() {
  const data = _interopRequireDefault(require("path"));

  _path = function () {
    return data;
  };

  return data;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

const debug = (0, _debug().default)("babel:config:loading:files:plugins");
const EXACT_RE = /^module:/;
const BABEL_PLUGIN_PREFIX_RE = /^(?!@|module:|[^/]+\/|babel-plugin-)/;
const BABEL_PRESET_PREFIX_RE = /^(?!@|module:|[^/]+\/|babel-preset-)/;
const BABEL_PLUGIN_ORG_RE = /^(@babel\/)(?!plugin-|[^/]+\/)/;
const BABEL_PRESET_ORG_RE = /^(@babel\/)(?!preset-|[^/]+\/)/;
const OTHER_PLUGIN_ORG_RE = /^(@(?!babel\/)[^/]+\/)(?![^/]*babel-plugin(?:-|\/|$)|[^/]+\/)/;
const OTHER_PRESET_ORG_RE = /^(@(?!babel\/)[^/]+\/)(?![^/]*babel-preset(?:-|\/|$)|[^/]+\/)/;
const OTHER_ORG_DEFAULT_RE = /^(@(?!babel$)[^/]+)$/;

function resolvePlugin(name, dirname) {
  return resolveStandardizedName("plugin", name, dirname);
}

function resolvePreset(name, dirname) {
  return resolveStandardizedName("preset", name, dirname);
}

function loadPlugin(name, dirname) {
  const filepath = resolvePlugin(name, dirname);

  if (!filepath) {
    throw new Error(`Plugin ${name} not found relative to ${dirname}`);
  }

  const value = requireModule("plugin", filepath);
  debug("Loaded plugin %o from %o.", name, dirname);
  return {
    filepath,
    value
  };
}

function loadPreset(name, dirname) {
  const filepath = resolvePreset(name, dirname);

  if (!filepath) {
    throw new Error(`Preset ${name} not found relative to ${dirname}`);
  }

  const value = requireModule("preset", filepath);
  debug("Loaded preset %o from %o.", name, dirname);
  return {
    filepath,
    value
  };
}

function standardizeName(type, name) {
  if (_path().default.isAbsolute(name)) return name;
  const isPreset = type === "preset";
  return name.replace(isPreset ? BABEL_PRESET_PREFIX_RE : BABEL_PLUGIN_PREFIX_RE, `babel-${type}-`).replace(isPreset ? BABEL_PRESET_ORG_RE : BABEL_PLUGIN_ORG_RE, `$1${type}-`).replace(isPreset ? OTHER_PRESET_ORG_RE : OTHER_PLUGIN_ORG_RE, `$1babel-${type}-`).replace(OTHER_ORG_DEFAULT_RE, `$1/babel-${type}`).replace(EXACT_RE, "");
}

function resolveStandardizedName(type, name, dirname = process.cwd()) {
  const standardizedName = standardizeName(type, name);

  try {
    return _resolve().default.sync(standardizedName, {
      basedir: dirname
    });
  } catch (e) {
    if (e.code !== "MODULE_NOT_FOUND") throw e;

    if (standardizedName !== name) {
      let resolvedOriginal = false;

      try {
        _resolve().default.sync(name, {
          basedir: dirname
        });

        resolvedOriginal = true;
      } catch (e2) {}

      if (resolvedOriginal) {
        e.message += `\n- If you want to resolve "${name}", use "module:${name}"`;
      }
    }

    let resolvedBabel = false;

    try {
      _resolve().default.sync(standardizeName(type, "@babel/" + name), {
        basedir: dirname
      });

      resolvedBabel = true;
    } catch (e2) {}

    if (resolvedBabel) {
      e.message += `\n- Did you mean "@babel/${name}"?`;
    }

    let resolvedOppositeType = false;
    const oppositeType = type === "preset" ? "plugin" : "preset";

    try {
      _resolve().default.sync(standardizeName(oppositeType, name), {
        basedir: dirname
      });

      resolvedOppositeType = true;
    } catch (e2) {}

    if (resolvedOppositeType) {
      e.message += `\n- Did you accidentally pass a ${type} as a ${oppositeType}?`;
    }

    throw e;
  }
}

const LOADING_MODULES = new Set();

function requireModule(type, name) {
  if (LOADING_MODULES.has(name)) {
    throw new Error(`Reentrant ${type} detected trying to load "${name}". This module is not ignored ` + "and is trying to load itself while compiling itself, leading to a dependency cycle. " + 'We recommend adding it to your "ignore" list in your babelrc, or to a .babelignore.');
  }

  try {
    LOADING_MODULES.add(name);
    return require(name);
  } finally {
    LOADING_MODULES.delete(name);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvY29yZS9saWIvY29uZmlnL2ZpbGVzL3BsdWdpbnMuanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJyZXNvbHZlUGx1Z2luIiwicmVzb2x2ZVByZXNldCIsImxvYWRQbHVnaW4iLCJsb2FkUHJlc2V0IiwiX2RlYnVnIiwiZGF0YSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3Jlc29sdmUiLCJfcGF0aCIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiZGVidWciLCJFWEFDVF9SRSIsIkJBQkVMX1BMVUdJTl9QUkVGSVhfUkUiLCJCQUJFTF9QUkVTRVRfUFJFRklYX1JFIiwiQkFCRUxfUExVR0lOX09SR19SRSIsIkJBQkVMX1BSRVNFVF9PUkdfUkUiLCJPVEhFUl9QTFVHSU5fT1JHX1JFIiwiT1RIRVJfUFJFU0VUX09SR19SRSIsIk9USEVSX09SR19ERUZBVUxUX1JFIiwibmFtZSIsImRpcm5hbWUiLCJyZXNvbHZlU3RhbmRhcmRpemVkTmFtZSIsImZpbGVwYXRoIiwiRXJyb3IiLCJyZXF1aXJlTW9kdWxlIiwic3RhbmRhcmRpemVOYW1lIiwidHlwZSIsImlzQWJzb2x1dGUiLCJpc1ByZXNldCIsInJlcGxhY2UiLCJwcm9jZXNzIiwiY3dkIiwic3RhbmRhcmRpemVkTmFtZSIsInN5bmMiLCJiYXNlZGlyIiwiZSIsImNvZGUiLCJyZXNvbHZlZE9yaWdpbmFsIiwiZTIiLCJtZXNzYWdlIiwicmVzb2x2ZWRCYWJlbCIsInJlc29sdmVkT3Bwb3NpdGVUeXBlIiwib3Bwb3NpdGVUeXBlIiwiTE9BRElOR19NT0RVTEVTIiwiU2V0IiwiaGFzIiwiYWRkIiwiZGVsZXRlIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMz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b0IsR0FBRyxLQUEzQjtBQUNBLFVBQU1DLFlBQVksR0FBR2hCLElBQUksS0FBSyxRQUFULEdBQW9CLFFBQXBCLEdBQStCLFFBQXBEOztBQUVBLFFBQUk7QUFDRnJCLE1BQUFBLFFBQVEsR0FBR0ksT0FBWCxDQUFtQndCLElBQW5CLENBQXdCUixlQUFlLENBQUNpQixZQUFELEVBQWV2QixJQUFmLENBQXZDLEVBQTZEO0FBQzNEZSxRQUFBQSxPQUFPLEVBQUVkO0FBRGtELE9BQTdEOztBQUlBcUIsTUFBQUEsb0JBQW9CLEdBQUcsSUFBdkI7QUFDRCxLQU5ELENBTUUsT0FBT0gsRUFBUCxFQUFXLENBQUU7O0FBRWYsUUFBSUcsb0JBQUosRUFBMEI7QUFDeEJOLE1BQUFBLENBQUMsQ0FBQ0ksT0FBRixJQUFjLG1DQUFrQ2IsSUFBSyxTQUFRZ0IsWUFBYSxHQUExRTtBQUNEOztBQUVELFVBQU1QLENBQU47QUFDRDtBQUNGOztBQUVELE1BQU1RLGVBQWUsR0FBRyxJQUFJQyxHQUFKLEVBQXhCOztBQUVBLFNBQVNwQixhQUFULENBQXVCRSxJQUF2QixFQUE2QlAsSUFBN0IsRUFBbUM7QUFDakMsTUFBSXdCLGVBQWUsQ0FBQ0UsR0FBaEIsQ0FBb0IxQixJQUFwQixDQUFKLEVBQStCO0FBQzdCLFVBQU0sSUFBSUksS0FBSixDQUFXLGFBQVlHLElBQUssNkJBQTRCUCxJQUFLLGdDQUFuRCxHQUFxRixzRkFBckYsR0FBOEsscUZBQXhMLENBQU47QUFDRDs7QUFFRCxNQUFJO0FBQ0Z3QixJQUFBQSxlQUFlLENBQUNHLEdBQWhCLENBQW9CM0IsSUFBcEI7QUFDQSxXQUFPZixPQUFPLENBQUNlLElBQUQsQ0FBZDtBQUNELEdBSEQsU0FHVTtBQUNSd0IsSUFBQUEsZUFBZSxDQUFDSSxNQUFoQixDQUF1QjVCLElBQXZCO0FBQ0Q7QUFDRiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5yZXNvbHZlUGx1Z2luID0gcmVzb2x2ZVBsdWdpbjtcbmV4cG9ydHMucmVzb2x2ZVByZXNldCA9IHJlc29sdmVQcmVzZXQ7XG5leHBvcnRzLmxvYWRQbHVnaW4gPSBsb2FkUGx1Z2luO1xuZXhwb3J0cy5sb2FkUHJlc2V0ID0gbG9hZFByZXNldDtcblxuZnVuY3Rpb24gX2RlYnVnKCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiZGVidWdcIikpO1xuXG4gIF9kZWJ1ZyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gX3Jlc29sdmUoKSB7XG4gIGNvbnN0IGRhdGEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJyZXNvbHZlXCIpKTtcblxuICBfcmVzb2x2ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gX3BhdGgoKSB7XG4gIGNvbnN0IGRhdGEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJwYXRoXCIpKTtcblxuICBfcGF0aCA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuY29uc3QgZGVidWcgPSAoMCwgX2RlYnVnKCkuZGVmYXVsdCkoXCJiYWJlbDpjb25maWc6bG9hZGluZzpmaWxlczpwbHVnaW5zXCIpO1xuY29uc3QgRVhBQ1RfUkUgPSAvXm1vZHVsZTovO1xuY29uc3QgQkFCRUxfUExVR0lOX1BSRUZJWF9SRSA9IC9eKD8hQHxtb2R1bGU6fFteL10rXFwvfGJhYmVsLXBsdWdpbi0pLztcbmNvbnN0IEJBQkVMX1BSRVNFVF9QUkVGSVhfUkUgPSAvXig/IUB8bW9kdWxlOnxbXi9dK1xcL3xiYWJlbC1wcmVzZXQtKS87XG5jb25zdCBCQUJFTF9QTFVHSU5fT1JHX1JFID0gL14oQGJhYmVsXFwvKSg/IXBsdWdpbi18W14vXStcXC8pLztcbmNvbnN0IEJBQkVMX1BSRVNFVF9PUkdfUkUgPSAvXihAYmFiZWxcXC8pKD8hcHJlc2V0LXxbXi9dK1xcLykvO1xuY29uc3QgT1RIRVJfUExVR0lOX09SR19SRSA9IC9eKEAoPyFiYWJlbFxcLylbXi9dK1xcLykoPyFbXi9dKmJhYmVsLXBsdWdpbig/Oi18XFwvfCQpfFteL10rXFwvKS87XG5jb25zdCBPVEhFUl9QUkVTRVRfT1JHX1JFID0gL14oQCg/IWJhYmVsXFwvKVteL10rXFwvKSg/IVteL10qYmFiZWwtcHJlc2V0KD86LXxcXC98JCl8W14vXStcXC8pLztcbmNvbnN0IE9USEVSX09SR19ERUZBVUxUX1JFID0gL14oQCg/IWJhYmVsJClbXi9dKykkLztcblxuZnVuY3Rpb24gcmVzb2x2ZVBsdWdpbihuYW1lLCBkaXJuYW1lKSB7XG4gIHJldHVybiByZXNvbHZlU3RhbmRhcmRpemVkTmFtZShcInBsdWdpblwiLCBuYW1lLCBkaXJuYW1lKTtcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZVByZXNldChuYW1lLCBkaXJuYW1lKSB7XG4gIHJldHVybiByZXNvbHZlU3RhbmRhcmRpemVkTmFtZShcInByZXNldFwiLCBuYW1lLCBkaXJuYW1lKTtcbn1cblxuZnVuY3Rpb24gbG9hZFBsdWdpbihuYW1lLCBkaXJuYW1lKSB7XG4gIGNvbnN0IGZpbGVwYXRoID0gcmVzb2x2ZVBsdWdpbihuYW1lLCBkaXJuYW1lKTtcblxuICBpZiAoIWZpbGVwYXRoKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBQbHVnaW4gJHtuYW1lfSBub3QgZm91bmQgcmVsYXRpdmUgdG8gJHtkaXJuYW1lfWApO1xuICB9XG5cbiAgY29uc3QgdmFsdWUgPSByZXF1aXJlTW9kdWxlKFwicGx1Z2luXCIsIGZpbGVwYXRoKTtcbiAgZGVidWcoXCJMb2FkZWQgcGx1Z2luICVvIGZyb20gJW8uXCIsIG5hbWUsIGRpcm5hbWUpO1xuICByZXR1cm4ge1xuICAgIGZpbGVwYXRoLFxuICAgIHZhbHVlXG4gIH07XG59XG5cbmZ1bmN0aW9uIGxvYWRQcmVzZXQobmFtZSwgZGlybmFtZSkge1xuICBjb25zdCBmaWxlcGF0aCA9IHJlc29sdmVQcmVzZXQobmFtZSwgZGlybmFtZSk7XG5cbiAgaWYgKCFmaWxlcGF0aCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgUHJlc2V0ICR7bmFtZX0gbm90IGZvdW5kIHJlbGF0aXZlIHRvICR7ZGlybmFtZX1gKTtcbiAgfVxuXG4gIGNvbnN0IHZhbHVlID0gcmVxdWlyZU1vZHVsZShcInByZXNldFwiLCBmaWxlcGF0aCk7XG4gIGRlYnVnKFwiTG9hZGVkIHByZXNldCAlbyBmcm9tICVvLlwiLCBuYW1lLCBkaXJuYW1lKTtcbiAgcmV0dXJuIHtcbiAgICBmaWxlcGF0aCxcbiAgICB2YWx1ZVxuICB9O1xufVxuXG5mdW5jdGlvbiBzdGFuZGFyZGl6ZU5hbWUodHlwZSwgbmFtZSkge1xuICBpZiAoX3BhdGgoKS5kZWZhdWx0LmlzQWJzb2x1dGUobmFtZSkpIHJldHVybiBuYW1lO1xuICBjb25zdCBpc1ByZXNldCA9IHR5cGUgPT09IFwicHJlc2V0XCI7XG4gIHJldHVybiBuYW1lLnJlcGxhY2UoaXNQcmVzZXQgPyBCQUJFTF9QUkVTRVRfUFJFRklYX1JFIDogQkFCRUxfUExVR0lOX1BSRUZJWF9SRSwgYGJhYmVsLSR7dHlwZX0tYCkucmVwbGFjZShpc1ByZXNldCA/IEJBQkVMX1BSRVNFVF9PUkdfUkUgOiBCQUJFTF9QTFVHSU5fT1JHX1JFLCBgJDEke3R5cGV9LWApLnJlcGxhY2UoaXNQcmVzZXQgPyBPVEhFUl9QUkVTRVRfT1JHX1JFIDogT1RIRVJfUExVR0lOX09SR19SRSwgYCQxYmFiZWwtJHt0eXBlfS1gKS5yZXBsYWNlKE9USEVSX09SR19ERUZBVUxUX1JFLCBgJDEvYmFiZWwtJHt0eXBlfWApLnJlcGxhY2UoRVhBQ1RfUkUsIFwiXCIpO1xufVxuXG5mdW5jdGlvbiByZXNvbHZlU3RhbmRhcmRpemVkTmFtZSh0eXBlLCBuYW1lLCBkaXJuYW1lID0gcHJvY2Vzcy5jd2QoKSkge1xuICBjb25zdCBzdGFuZGFyZGl6ZWROYW1lID0gc3RhbmRhcmRpemVOYW1lKHR5cGUsIG5hbWUpO1xuXG4gIHRyeSB7XG4gICAgcmV0dXJuIF9yZXNvbHZlKCkuZGVmYXVsdC5zeW5jKHN0YW5kYXJkaXplZE5hbWUsIHtcbiAgICAgIGJhc2VkaXI6IGRpcm5hbWVcbiAgICB9KTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGlmIChlLmNvZGUgIT09IFwiTU9EVUxFX05PVF9GT1VORFwiKSB0aHJvdyBlO1xuXG4gICAgaWYgKHN0YW5kYXJkaXplZE5hbWUgIT09IG5hbWUpIHtcbiAgICAgIGxldCByZXNvbHZlZE9yaWdpbmFsID0gZmFsc2U7XG5cbiAgICAgIHRyeSB7XG4gICAgICAgIF9yZXNvbHZlKCkuZGVmYXVsdC5zeW5jKG5hbWUsIHtcbiAgICAgICAgICBiYXNlZGlyOiBkaXJuYW1lXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJlc29sdmVkT3JpZ2luYWwgPSB0cnVlO1xuICAgICAgfSBjYXRjaCAoZTIpIHt9XG5cbiAgICAgIGlmIChyZXNvbHZlZE9yaWdpbmFsKSB7XG4gICAgICAgIGUubWVzc2FnZSArPSBgXFxuLSBJZiB5b3Ugd2FudCB0byByZXNvbHZlIFwiJHtuYW1lfVwiLCB1c2UgXCJtb2R1bGU6JHtuYW1lfVwiYDtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBsZXQgcmVzb2x2ZWRCYWJlbCA9IGZhbHNlO1xuXG4gICAgdHJ5IHtcbiAgICAgIF9yZXNvbHZlKCkuZGVmYXVsdC5zeW5jKHN0YW5kYXJkaXplTmFtZSh0eXBlLCBcIkBiYWJlbC9cIiArIG5hbWUpLCB7XG4gICAgICAgIGJhc2VkaXI6IGRpcm5hbWVcbiAgICAgIH0pO1xuXG4gICAgICByZXNvbHZlZEJhYmVsID0gdHJ1ZTtcbiAgICB9IGNhdGNoIChlMikge31cblxuICAgIGlmIChyZXNvbHZlZEJhYmVsKSB7XG4gICAgICBlLm1lc3NhZ2UgKz0gYFxcbi0gRGlkIHlvdSBtZWFuIFwiQGJhYmVsLyR7bmFtZX1cIj9gO1xuICAgIH1cblxuICAgIGxldCByZXNvbHZlZE9wcG9zaXRlVHlwZSA9IGZhbHNlO1xuICAgIGNvbnN0IG9wcG9zaXRlVHlwZSA9IHR5cGUgPT09IFwicHJlc2V0XCIgPyBcInBsdWdpblwiIDogXCJwcmVzZXRcIjtcblxuICAgIHRyeSB7XG4gICAgICBfcmVzb2x2ZSgpLmRlZmF1bHQuc3luYyhzdGFuZGFyZGl6ZU5hbWUob3Bwb3NpdGVUeXBlLCBuYW1lKSwge1xuICAgICAgICBiYXNlZGlyOiBkaXJuYW1lXG4gICAgICB9KTtcblxuICAgICAgcmVzb2x2ZWRPcHBvc2l0ZVR5cGUgPSB0cnVlO1xuICAgIH0gY2F0Y2ggKGUyKSB7fVxuXG4gICAgaWYgKHJlc29sdmVkT3Bwb3NpdGVUeXBlKSB7XG4gICAgICBlLm1lc3NhZ2UgKz0gYFxcbi0gRGlkIHlvdSBhY2NpZGVudGFsbHkgcGFzcyBhICR7dHlwZX0gYXMgYSAke29wcG9zaXRlVHlwZX0/YDtcbiAgICB9XG5cbiAgICB0aHJvdyBlO1xuICB9XG59XG5cbmNvbnN0IExPQURJTkdfTU9EVUxFUyA9IG5ldyBTZXQoKTtcblxuZnVuY3Rpb24gcmVxdWlyZU1vZHVsZSh0eXBlLCBuYW1lKSB7XG4gIGlmIChMT0FESU5HX01PRFVMRVMuaGFzKG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBSZWVudHJhbnQgJHt0eXBlfSBkZXRlY3RlZCB0cnlpbmcgdG8gbG9hZCBcIiR7bmFtZX1cIi4gVGhpcyBtb2R1bGUgaXMgbm90IGlnbm9yZWQgYCArIFwiYW5kIGlzIHRyeWluZyB0byBsb2FkIGl0c2VsZiB3aGlsZSBjb21waWxpbmcgaXRzZWxmLCBsZWFkaW5nIHRvIGEgZGVwZW5kZW5jeSBjeWNsZS4gXCIgKyAnV2UgcmVjb21tZW5kIGFkZGluZyBpdCB0byB5b3VyIFwiaWdub3JlXCIgbGlzdCBpbiB5b3VyIGJhYmVscmMsIG9yIHRvIGEgLmJhYmVsaWdub3JlLicpO1xuICB9XG5cbiAgdHJ5IHtcbiAgICBMT0FESU5HX01PRFVMRVMuYWRkKG5hbWUpO1xuICAgIHJldHVybiByZXF1aXJlKG5hbWUpO1xuICB9IGZpbmFsbHkge1xuICAgIExPQURJTkdfTU9EVUxFUy5kZWxldGUobmFtZSk7XG4gIH1cbn0iXX0=