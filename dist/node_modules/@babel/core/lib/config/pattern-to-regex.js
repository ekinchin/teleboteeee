"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = pathToPattern;

function _path() {
  const data = _interopRequireDefault(require("path"));

  _path = function () {
    return data;
  };

  return data;
}

function _escapeRegExp() {
  const data = _interopRequireDefault(require("lodash/escapeRegExp"));

  _escapeRegExp = function () {
    return data;
  };

  return data;
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

const sep = `\\${_path().default.sep}`;
const endSep = `(?:${sep}|$)`;
const substitution = `[^${sep}]+`;
const starPat = `(?:${substitution}${sep})`;
const starPatLast = `(?:${substitution}${endSep})`;
const starStarPat = `${starPat}*?`;
const starStarPatLast = `${starPat}*?${starPatLast}?`;

function pathToPattern(pattern, dirname) {
  const parts = _path().default.resolve(dirname, pattern).split(_path().default.sep);

  return new RegExp(["^", ...parts.map((part, i) => {
    const last = i === parts.length - 1;
    if (part === "**") return last ? starStarPatLast : starStarPat;
    if (part === "*") return last ? starPatLast : starPat;

    if (part.indexOf("*.") === 0) {
      return substitution + (0, _escapeRegExp().default)(part.slice(1)) + (last ? endSep : sep);
    }

    return (0, _escapeRegExp().default)(part) + (last ? endSep : sep);
  })].join(""));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvY29yZS9saWIvY29uZmlnL3BhdHRlcm4tdG8tcmVnZXguanMiXSwibmFtZXMiOlsiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJkZWZhdWx0IiwicGF0aFRvUGF0dGVybiIsIl9wYXRoIiwiZGF0YSIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX2VzY2FwZVJlZ0V4cCIsIm9iaiIsIl9fZXNNb2R1bGUiLCJzZXAiLCJlbmRTZXAiLCJzdWJzdGl0dXRpb24iLCJzdGFyUGF0Iiwic3RhclBhdExhc3QiLCJzdGFyU3RhclBhdCIsInN0YXJTdGFyUGF0TGFzdCIsInBhdHRlcm4iLCJkaXJuYW1lIiwicGFydHMiLCJyZXNvbHZlIiwic3BsaXQiLCJSZWdFeHAiLCJtYXAiLCJwYXJ0IiwiaSIsImxhc3QiLCJsZW5ndGgiLCJpbmRleE9mIiwic2xpY2UiLCJqb2luIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsT0FBUixHQUFrQkMsYUFBbEI7O0FBRUEsU0FBU0MsS0FBVCxHQUFpQjtBQUNmLFFBQU1DLElBQUksR0FBR0Msc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxNQUFELENBQVIsQ0FBbkM7O0FBRUFILEVBQUFBLEtBQUssR0FBRyxZQUFZO0FBQ2xCLFdBQU9DLElBQVA7QUFDRCxHQUZEOztBQUlBLFNBQU9BLElBQVA7QUFDRDs7QUFFRCxTQUFTRyxhQUFULEdBQXlCO0FBQ3ZCLFFBQU1ILElBQUksR0FBR0Msc0JBQXNCLENBQUNDLE9BQU8sQ0FBQyxxQkFBRCxDQUFSLENBQW5DOztBQUVBQyxFQUFBQSxhQUFhLEdBQUcsWUFBWTtBQUMxQixXQUFPSCxJQUFQO0FBQ0QsR0FGRDs7QUFJQSxTQUFPQSxJQUFQO0FBQ0Q7O0FBRUQsU0FBU0Msc0JBQVQsQ0FBZ0NHLEdBQWhDLEVBQXFDO0FBQUUsU0FBT0EsR0FBRyxJQUFJQSxHQUFHLENBQUNDLFVBQVgsR0FBd0JELEdBQXhCLEdBQThCO0FBQUVQLElBQUFBLE9BQU8sRUFBRU87QUFBWCxHQUFyQztBQUF3RDs7QUFFL0YsTUFBTUUsR0FBRyxHQUFJLEtBQUlQLEtBQUssR0FBR0YsT0FBUixDQUFnQlMsR0FBSSxFQUFyQztBQUNBLE1BQU1DLE1BQU0sR0FBSSxNQUFLRCxHQUFJLEtBQXpCO0FBQ0EsTUFBTUUsWUFBWSxHQUFJLEtBQUlGLEdBQUksSUFBOUI7QUFDQSxNQUFNRyxPQUFPLEdBQUksTUFBS0QsWUFBYSxHQUFFRixHQUFJLEdBQXpDO0FBQ0EsTUFBTUksV0FBVyxHQUFJLE1BQUtGLFlBQWEsR0FBRUQsTUFBTyxHQUFoRDtBQUNBLE1BQU1JLFdBQVcsR0FBSSxHQUFFRixPQUFRLElBQS9CO0FBQ0EsTUFBTUcsZUFBZSxHQUFJLEdBQUVILE9BQVEsS0FBSUMsV0FBWSxHQUFuRDs7QUFFQSxTQUFTWixhQUFULENBQXVCZSxPQUF2QixFQUFnQ0MsT0FBaEMsRUFBeUM7QUFDdkMsUUFBTUMsS0FBSyxHQUFHaEIsS0FBSyxHQUFHRixPQUFSLENBQWdCbUIsT0FBaEIsQ0FBd0JGLE9BQXhCLEVBQWlDRCxPQUFqQyxFQUEwQ0ksS0FBMUMsQ0FBZ0RsQixLQUFLLEdBQUdGLE9BQVIsQ0FBZ0JTLEdBQWhFLENBQWQ7O0FBRUEsU0FBTyxJQUFJWSxNQUFKLENBQVcsQ0FBQyxHQUFELEVBQU0sR0FBR0gsS0FBSyxDQUFDSSxHQUFOLENBQVUsQ0FBQ0MsSUFBRCxFQUFPQyxDQUFQLEtBQWE7QUFDaEQsVUFBTUMsSUFBSSxHQUFHRCxDQUFDLEtBQUtOLEtBQUssQ0FBQ1EsTUFBTixHQUFlLENBQWxDO0FBQ0EsUUFBSUgsSUFBSSxLQUFLLElBQWIsRUFBbUIsT0FBT0UsSUFBSSxHQUFHVixlQUFILEdBQXFCRCxXQUFoQztBQUNuQixRQUFJUyxJQUFJLEtBQUssR0FBYixFQUFrQixPQUFPRSxJQUFJLEdBQUdaLFdBQUgsR0FBaUJELE9BQTVCOztBQUVsQixRQUFJVyxJQUFJLENBQUNJLE9BQUwsQ0FBYSxJQUFiLE1BQXVCLENBQTNCLEVBQThCO0FBQzVCLGFBQU9oQixZQUFZLEdBQUcsQ0FBQyxHQUFHTCxhQUFhLEdBQUdOLE9BQXBCLEVBQTZCdUIsSUFBSSxDQUFDSyxLQUFMLENBQVcsQ0FBWCxDQUE3QixDQUFmLElBQThESCxJQUFJLEdBQUdmLE1BQUgsR0FBWUQsR0FBOUUsQ0FBUDtBQUNEOztBQUVELFdBQU8sQ0FBQyxHQUFHSCxhQUFhLEdBQUdOLE9BQXBCLEVBQTZCdUIsSUFBN0IsS0FBc0NFLElBQUksR0FBR2YsTUFBSCxHQUFZRCxHQUF0RCxDQUFQO0FBQ0QsR0FWMEIsQ0FBVCxFQVVkb0IsSUFWYyxDQVVULEVBVlMsQ0FBWCxDQUFQO0FBV0QiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7XG4gIHZhbHVlOiB0cnVlXG59KTtcbmV4cG9ydHMuZGVmYXVsdCA9IHBhdGhUb1BhdHRlcm47XG5cbmZ1bmN0aW9uIF9wYXRoKCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwicGF0aFwiKSk7XG5cbiAgX3BhdGggPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIF9lc2NhcGVSZWdFeHAoKSB7XG4gIGNvbnN0IGRhdGEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJsb2Rhc2gvZXNjYXBlUmVnRXhwXCIpKTtcblxuICBfZXNjYXBlUmVnRXhwID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KG9iaikgeyByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogeyBkZWZhdWx0OiBvYmogfTsgfVxuXG5jb25zdCBzZXAgPSBgXFxcXCR7X3BhdGgoKS5kZWZhdWx0LnNlcH1gO1xuY29uc3QgZW5kU2VwID0gYCg/OiR7c2VwfXwkKWA7XG5jb25zdCBzdWJzdGl0dXRpb24gPSBgW14ke3NlcH1dK2A7XG5jb25zdCBzdGFyUGF0ID0gYCg/OiR7c3Vic3RpdHV0aW9ufSR7c2VwfSlgO1xuY29uc3Qgc3RhclBhdExhc3QgPSBgKD86JHtzdWJzdGl0dXRpb259JHtlbmRTZXB9KWA7XG5jb25zdCBzdGFyU3RhclBhdCA9IGAke3N0YXJQYXR9Kj9gO1xuY29uc3Qgc3RhclN0YXJQYXRMYXN0ID0gYCR7c3RhclBhdH0qPyR7c3RhclBhdExhc3R9P2A7XG5cbmZ1bmN0aW9uIHBhdGhUb1BhdHRlcm4ocGF0dGVybiwgZGlybmFtZSkge1xuICBjb25zdCBwYXJ0cyA9IF9wYXRoKCkuZGVmYXVsdC5yZXNvbHZlKGRpcm5hbWUsIHBhdHRlcm4pLnNwbGl0KF9wYXRoKCkuZGVmYXVsdC5zZXApO1xuXG4gIHJldHVybiBuZXcgUmVnRXhwKFtcIl5cIiwgLi4ucGFydHMubWFwKChwYXJ0LCBpKSA9PiB7XG4gICAgY29uc3QgbGFzdCA9IGkgPT09IHBhcnRzLmxlbmd0aCAtIDE7XG4gICAgaWYgKHBhcnQgPT09IFwiKipcIikgcmV0dXJuIGxhc3QgPyBzdGFyU3RhclBhdExhc3QgOiBzdGFyU3RhclBhdDtcbiAgICBpZiAocGFydCA9PT0gXCIqXCIpIHJldHVybiBsYXN0ID8gc3RhclBhdExhc3QgOiBzdGFyUGF0O1xuXG4gICAgaWYgKHBhcnQuaW5kZXhPZihcIiouXCIpID09PSAwKSB7XG4gICAgICByZXR1cm4gc3Vic3RpdHV0aW9uICsgKDAsIF9lc2NhcGVSZWdFeHAoKS5kZWZhdWx0KShwYXJ0LnNsaWNlKDEpKSArIChsYXN0ID8gZW5kU2VwIDogc2VwKTtcbiAgICB9XG5cbiAgICByZXR1cm4gKDAsIF9lc2NhcGVSZWdFeHAoKS5kZWZhdWx0KShwYXJ0KSArIChsYXN0ID8gZW5kU2VwIDogc2VwKTtcbiAgfSldLmpvaW4oXCJcIikpO1xufSJdfQ==