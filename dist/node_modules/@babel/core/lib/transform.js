"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.transformSync = transformSync;
exports.transformAsync = transformAsync;
exports.transform = void 0;

var _config = _interopRequireDefault(require("./config"));

var _transformation = require("./transformation");

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

const transform = function transform(code, opts, callback) {
  if (typeof opts === "function") {
    callback = opts;
    opts = undefined;
  }

  if (callback === undefined) return transformSync(code, opts);
  const cb = callback;
  process.nextTick(() => {
    let cfg;

    try {
      cfg = (0, _config.default)(opts);
      if (cfg === null) return cb(null, null);
    } catch (err) {
      return cb(err);
    }

    (0, _transformation.runAsync)(cfg, code, null, cb);
  });
};

exports.transform = transform;

function transformSync(code, opts) {
  const config = (0, _config.default)(opts);
  if (config === null) return null;
  return (0, _transformation.runSync)(config, code);
}

function transformAsync(code, opts) {
  return new Promise((res, rej) => {
    transform(code, opts, (err, result) => {
      if (err == null) res(result);else rej(err);
    });
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvY29yZS9saWIvdHJhbnNmb3JtLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwidHJhbnNmb3JtU3luYyIsInRyYW5zZm9ybUFzeW5jIiwidHJhbnNmb3JtIiwiX2NvbmZpZyIsIl9pbnRlcm9wUmVxdWlyZURlZmF1bHQiLCJyZXF1aXJlIiwiX3RyYW5zZm9ybWF0aW9uIiwib2JqIiwiX19lc01vZHVsZSIsImRlZmF1bHQiLCJjb2RlIiwib3B0cyIsImNhbGxiYWNrIiwidW5kZWZpbmVkIiwiY2IiLCJwcm9jZXNzIiwibmV4dFRpY2siLCJjZmciLCJlcnIiLCJydW5Bc3luYyIsImNvbmZpZyIsInJ1blN5bmMiLCJQcm9taXNlIiwicmVzIiwicmVqIiwicmVzdWx0Il0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQUEsTUFBTSxDQUFDQyxjQUFQLENBQXNCQyxPQUF0QixFQUErQixZQUEvQixFQUE2QztBQUMzQ0MsRUFBQUEsS0FBSyxFQUFFO0FBRG9DLENBQTdDO0FBR0FELE9BQU8sQ0FBQ0UsYUFBUixHQUF3QkEsYUFBeEI7QUFDQUYsT0FBTyxDQUFDRyxjQUFSLEdBQXlCQSxjQUF6QjtBQUNBSCxPQUFPLENBQUNJLFNBQVIsR0FBb0IsS0FBSyxDQUF6Qjs7QUFFQSxJQUFJQyxPQUFPLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsVUFBRCxDQUFSLENBQXBDOztBQUVBLElBQUlDLGVBQWUsR0FBR0QsT0FBTyxDQUFDLGtCQUFELENBQTdCOztBQUVBLFNBQVNELHNCQUFULENBQWdDRyxHQUFoQyxFQUFxQztBQUFFLFNBQU9BLEdBQUcsSUFBSUEsR0FBRyxDQUFDQyxVQUFYLEdBQXdCRCxHQUF4QixHQUE4QjtBQUFFRSxJQUFBQSxPQUFPLEVBQUVGO0FBQVgsR0FBckM7QUFBd0Q7O0FBRS9GLE1BQU1MLFNBQVMsR0FBRyxTQUFTQSxTQUFULENBQW1CUSxJQUFuQixFQUF5QkMsSUFBekIsRUFBK0JDLFFBQS9CLEVBQXlDO0FBQ3pELE1BQUksT0FBT0QsSUFBUCxLQUFnQixVQUFwQixFQUFnQztBQUM5QkMsSUFBQUEsUUFBUSxHQUFHRCxJQUFYO0FBQ0FBLElBQUFBLElBQUksR0FBR0UsU0FBUDtBQUNEOztBQUVELE1BQUlELFFBQVEsS0FBS0MsU0FBakIsRUFBNEIsT0FBT2IsYUFBYSxDQUFDVSxJQUFELEVBQU9DLElBQVAsQ0FBcEI7QUFDNUIsUUFBTUcsRUFBRSxHQUFHRixRQUFYO0FBQ0FHLEVBQUFBLE9BQU8sQ0FBQ0MsUUFBUixDQUFpQixNQUFNO0FBQ3JCLFFBQUlDLEdBQUo7O0FBRUEsUUFBSTtBQUNGQSxNQUFBQSxHQUFHLEdBQUcsQ0FBQyxHQUFHZCxPQUFPLENBQUNNLE9BQVosRUFBcUJFLElBQXJCLENBQU47QUFDQSxVQUFJTSxHQUFHLEtBQUssSUFBWixFQUFrQixPQUFPSCxFQUFFLENBQUMsSUFBRCxFQUFPLElBQVAsQ0FBVDtBQUNuQixLQUhELENBR0UsT0FBT0ksR0FBUCxFQUFZO0FBQ1osYUFBT0osRUFBRSxDQUFDSSxHQUFELENBQVQ7QUFDRDs7QUFFRCxLQUFDLEdBQUdaLGVBQWUsQ0FBQ2EsUUFBcEIsRUFBOEJGLEdBQTlCLEVBQW1DUCxJQUFuQyxFQUF5QyxJQUF6QyxFQUErQ0ksRUFBL0M7QUFDRCxHQVhEO0FBWUQsQ0FwQkQ7O0FBc0JBaEIsT0FBTyxDQUFDSSxTQUFSLEdBQW9CQSxTQUFwQjs7QUFFQSxTQUFTRixhQUFULENBQXVCVSxJQUF2QixFQUE2QkMsSUFBN0IsRUFBbUM7QUFDakMsUUFBTVMsTUFBTSxHQUFHLENBQUMsR0FBR2pCLE9BQU8sQ0FBQ00sT0FBWixFQUFxQkUsSUFBckIsQ0FBZjtBQUNBLE1BQUlTLE1BQU0sS0FBSyxJQUFmLEVBQXFCLE9BQU8sSUFBUDtBQUNyQixTQUFPLENBQUMsR0FBR2QsZUFBZSxDQUFDZSxPQUFwQixFQUE2QkQsTUFBN0IsRUFBcUNWLElBQXJDLENBQVA7QUFDRDs7QUFFRCxTQUFTVCxjQUFULENBQXdCUyxJQUF4QixFQUE4QkMsSUFBOUIsRUFBb0M7QUFDbEMsU0FBTyxJQUFJVyxPQUFKLENBQVksQ0FBQ0MsR0FBRCxFQUFNQyxHQUFOLEtBQWM7QUFDL0J0QixJQUFBQSxTQUFTLENBQUNRLElBQUQsRUFBT0MsSUFBUCxFQUFhLENBQUNPLEdBQUQsRUFBTU8sTUFBTixLQUFpQjtBQUNyQyxVQUFJUCxHQUFHLElBQUksSUFBWCxFQUFpQkssR0FBRyxDQUFDRSxNQUFELENBQUgsQ0FBakIsS0FBa0NELEdBQUcsQ0FBQ04sR0FBRCxDQUFIO0FBQ25DLEtBRlEsQ0FBVDtBQUdELEdBSk0sQ0FBUDtBQUtEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLnRyYW5zZm9ybVN5bmMgPSB0cmFuc2Zvcm1TeW5jO1xuZXhwb3J0cy50cmFuc2Zvcm1Bc3luYyA9IHRyYW5zZm9ybUFzeW5jO1xuZXhwb3J0cy50cmFuc2Zvcm0gPSB2b2lkIDA7XG5cbnZhciBfY29uZmlnID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiLi9jb25maWdcIikpO1xuXG52YXIgX3RyYW5zZm9ybWF0aW9uID0gcmVxdWlyZShcIi4vdHJhbnNmb3JtYXRpb25cIik7XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmNvbnN0IHRyYW5zZm9ybSA9IGZ1bmN0aW9uIHRyYW5zZm9ybShjb2RlLCBvcHRzLCBjYWxsYmFjaykge1xuICBpZiAodHlwZW9mIG9wdHMgPT09IFwiZnVuY3Rpb25cIikge1xuICAgIGNhbGxiYWNrID0gb3B0cztcbiAgICBvcHRzID0gdW5kZWZpbmVkO1xuICB9XG5cbiAgaWYgKGNhbGxiYWNrID09PSB1bmRlZmluZWQpIHJldHVybiB0cmFuc2Zvcm1TeW5jKGNvZGUsIG9wdHMpO1xuICBjb25zdCBjYiA9IGNhbGxiYWNrO1xuICBwcm9jZXNzLm5leHRUaWNrKCgpID0+IHtcbiAgICBsZXQgY2ZnO1xuXG4gICAgdHJ5IHtcbiAgICAgIGNmZyA9ICgwLCBfY29uZmlnLmRlZmF1bHQpKG9wdHMpO1xuICAgICAgaWYgKGNmZyA9PT0gbnVsbCkgcmV0dXJuIGNiKG51bGwsIG51bGwpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIGNiKGVycik7XG4gICAgfVxuXG4gICAgKDAsIF90cmFuc2Zvcm1hdGlvbi5ydW5Bc3luYykoY2ZnLCBjb2RlLCBudWxsLCBjYik7XG4gIH0pO1xufTtcblxuZXhwb3J0cy50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybVN5bmMoY29kZSwgb3B0cykge1xuICBjb25zdCBjb25maWcgPSAoMCwgX2NvbmZpZy5kZWZhdWx0KShvcHRzKTtcbiAgaWYgKGNvbmZpZyA9PT0gbnVsbCkgcmV0dXJuIG51bGw7XG4gIHJldHVybiAoMCwgX3RyYW5zZm9ybWF0aW9uLnJ1blN5bmMpKGNvbmZpZywgY29kZSk7XG59XG5cbmZ1bmN0aW9uIHRyYW5zZm9ybUFzeW5jKGNvZGUsIG9wdHMpIHtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXMsIHJlaikgPT4ge1xuICAgIHRyYW5zZm9ybShjb2RlLCBvcHRzLCAoZXJyLCByZXN1bHQpID0+IHtcbiAgICAgIGlmIChlcnIgPT0gbnVsbCkgcmVzKHJlc3VsdCk7ZWxzZSByZWooZXJyKTtcbiAgICB9KTtcbiAgfSk7XG59Il19