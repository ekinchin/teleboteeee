"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.chmod = chmod;
exports.readdir = readdir;
exports.readdirForCompilable = readdirForCompilable;
exports.isCompilableExtension = isCompilableExtension;
exports.addSourceMappingUrl = addSourceMappingUrl;
exports.transform = transform;
exports.compile = compile;
exports.deleteDir = deleteDir;
exports.requireChokidar = requireChokidar;
exports.adjustRelative = adjustRelative;

function _fsReaddirRecursive() {
  const data = _interopRequireDefault(require("fs-readdir-recursive"));

  _fsReaddirRecursive = function () {
    return data;
  };

  return data;
}

function babel() {
  const data = _interopRequireWildcard(require("@babel/core"));

  babel = function () {
    return data;
  };

  return data;
}

function _includes() {
  const data = _interopRequireDefault(require("lodash/includes"));

  _includes = function () {
    return data;
  };

  return data;
}

function _path() {
  const data = _interopRequireDefault(require("path"));

  _path = function () {
    return data;
  };

  return data;
}

function _fs() {
  const data = _interopRequireDefault(require("fs"));

  _fs = function () {
    return data;
  };

  return data;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  } else {
    var newObj = {};

    if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};

          if (desc.get || desc.set) {
            Object.defineProperty(newObj, key, desc);
          } else {
            newObj[key] = obj[key];
          }
        }
      }
    }

    newObj.default = obj;
    return newObj;
  }
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function chmod(src, dest) {
  _fs().default.chmodSync(dest, _fs().default.statSync(src).mode);
}

function readdir(dirname, includeDotfiles, filter) {
  return (0, _fsReaddirRecursive().default)(dirname, (filename, _index, currentDirectory) => {
    const stat = _fs().default.statSync(_path().default.join(currentDirectory, filename));

    if (stat.isDirectory()) return true;
    return (includeDotfiles || filename[0] !== ".") && (!filter || filter(filename));
  });
}

function readdirForCompilable(dirname, includeDotfiles) {
  return readdir(dirname, includeDotfiles, isCompilableExtension);
}

function isCompilableExtension(filename, altExts) {
  const exts = altExts || babel().DEFAULT_EXTENSIONS;

  const ext = _path().default.extname(filename);

  return (0, _includes().default)(exts, ext);
}

function addSourceMappingUrl(code, loc) {
  return code + "\n//# sourceMappingURL=" + _path().default.basename(loc);
}

const CALLER = {
  name: "@babel/cli"
};

function transform(filename, code, opts) {
  opts = Object.assign({}, opts, {
    caller: CALLER,
    filename
  });
  return new Promise((resolve, reject) => {
    babel().transform(code, opts, (err, result) => {
      if (err) reject(err);else resolve(result);
    });
  });
}

function compile(filename, opts) {
  opts = Object.assign({}, opts, {
    caller: CALLER
  });
  return new Promise((resolve, reject) => {
    babel().transformFile(filename, opts, (err, result) => {
      if (err) reject(err);else resolve(result);
    });
  });
}

function deleteDir(path) {
  if (_fs().default.existsSync(path)) {
    _fs().default.readdirSync(path).forEach(function (file) {
      const curPath = path + "/" + file;

      if (_fs().default.lstatSync(curPath).isDirectory()) {
        deleteDir(curPath);
      } else {
        _fs().default.unlinkSync(curPath);
      }
    });

    _fs().default.rmdirSync(path);
  }
}

process.on("uncaughtException", function (err) {
  console.error(err);
  process.exit(1);
});

function requireChokidar() {
  try {
    return require("chokidar");
  } catch (err) {
    console.error("The optional dependency chokidar failed to install and is required for " + "--watch. Chokidar is likely not supported on your platform.");
    throw err;
  }
}

function adjustRelative(relative, keepFileExtension) {
  if (keepFileExtension) {
    return relative;
  }

  return relative.replace(/\.(\w*?)$/, "") + ".js";
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvY2xpL2xpYi9iYWJlbC91dGlsLmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwiY2htb2QiLCJyZWFkZGlyIiwicmVhZGRpckZvckNvbXBpbGFibGUiLCJpc0NvbXBpbGFibGVFeHRlbnNpb24iLCJhZGRTb3VyY2VNYXBwaW5nVXJsIiwidHJhbnNmb3JtIiwiY29tcGlsZSIsImRlbGV0ZURpciIsInJlcXVpcmVDaG9raWRhciIsImFkanVzdFJlbGF0aXZlIiwiX2ZzUmVhZGRpclJlY3Vyc2l2ZSIsImRhdGEiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsImJhYmVsIiwiX2ludGVyb3BSZXF1aXJlV2lsZGNhcmQiLCJfaW5jbHVkZXMiLCJfcGF0aCIsIl9mcyIsIm9iaiIsIl9fZXNNb2R1bGUiLCJuZXdPYmoiLCJrZXkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsImNhbGwiLCJkZXNjIiwiZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yIiwiZ2V0Iiwic2V0IiwiZGVmYXVsdCIsInNyYyIsImRlc3QiLCJjaG1vZFN5bmMiLCJzdGF0U3luYyIsIm1vZGUiLCJkaXJuYW1lIiwiaW5jbHVkZURvdGZpbGVzIiwiZmlsdGVyIiwiZmlsZW5hbWUiLCJfaW5kZXgiLCJjdXJyZW50RGlyZWN0b3J5Iiwic3RhdCIsImpvaW4iLCJpc0RpcmVjdG9yeSIsImFsdEV4dHMiLCJleHRzIiwiREVGQVVMVF9FWFRFTlNJT05TIiwiZXh0IiwiZXh0bmFtZSIsImNvZGUiLCJsb2MiLCJiYXNlbmFtZSIsIkNBTExFUiIsIm5hbWUiLCJvcHRzIiwiYXNzaWduIiwiY2FsbGVyIiwiUHJvbWlzZSIsInJlc29sdmUiLCJyZWplY3QiLCJlcnIiLCJyZXN1bHQiLCJ0cmFuc2Zvcm1GaWxlIiwicGF0aCIsImV4aXN0c1N5bmMiLCJyZWFkZGlyU3luYyIsImZvckVhY2giLCJmaWxlIiwiY3VyUGF0aCIsImxzdGF0U3luYyIsInVubGlua1N5bmMiLCJybWRpclN5bmMiLCJwcm9jZXNzIiwib24iLCJjb25zb2xlIiwiZXJyb3IiLCJleGl0IiwicmVsYXRpdmUiLCJrZWVwRmlsZUV4dGVuc2lvbiIsInJlcGxhY2UiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBQSxNQUFNLENBQUNDLGNBQVAsQ0FBc0JDLE9BQXRCLEVBQStCLFlBQS9CLEVBQTZDO0FBQzNDQyxFQUFBQSxLQUFLLEVBQUU7QUFEb0MsQ0FBN0M7QUFHQUQsT0FBTyxDQUFDRSxLQUFSLEdBQWdCQSxLQUFoQjtBQUNBRixPQUFPLENBQUNHLE9BQVIsR0FBa0JBLE9BQWxCO0FBQ0FILE9BQU8sQ0FBQ0ksb0JBQVIsR0FBK0JBLG9CQUEvQjtBQUNBSixPQUFPLENBQUNLLHFCQUFSLEdBQWdDQSxxQkFBaEM7QUFDQUwsT0FBTyxDQUFDTSxtQkFBUixHQUE4QkEsbUJBQTlCO0FBQ0FOLE9BQU8sQ0FBQ08sU0FBUixHQUFvQkEsU0FBcEI7QUFDQVAsT0FBTyxDQUFDUSxPQUFSLEdBQWtCQSxPQUFsQjtBQUNBUixPQUFPLENBQUNTLFNBQVIsR0FBb0JBLFNBQXBCO0FBQ0FULE9BQU8sQ0FBQ1UsZUFBUixHQUEwQkEsZUFBMUI7QUFDQVYsT0FBTyxDQUFDVyxjQUFSLEdBQXlCQSxjQUF6Qjs7QUFFQSxTQUFTQyxtQkFBVCxHQUErQjtBQUM3QixRQUFNQyxJQUFJLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsc0JBQUQsQ0FBUixDQUFuQzs7QUFFQUgsRUFBQUEsbUJBQW1CLEdBQUcsWUFBWTtBQUNoQyxXQUFPQyxJQUFQO0FBQ0QsR0FGRDs7QUFJQSxTQUFPQSxJQUFQO0FBQ0Q7O0FBRUQsU0FBU0csS0FBVCxHQUFpQjtBQUNmLFFBQU1ILElBQUksR0FBR0ksdUJBQXVCLENBQUNGLE9BQU8sQ0FBQyxhQUFELENBQVIsQ0FBcEM7O0FBRUFDLEVBQUFBLEtBQUssR0FBRyxZQUFZO0FBQ2xCLFdB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XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5leHBvcnRzLmNobW9kID0gY2htb2Q7XG5leHBvcnRzLnJlYWRkaXIgPSByZWFkZGlyO1xuZXhwb3J0cy5yZWFkZGlyRm9yQ29tcGlsYWJsZSA9IHJlYWRkaXJGb3JDb21waWxhYmxlO1xuZXhwb3J0cy5pc0NvbXBpbGFibGVFeHRlbnNpb24gPSBpc0NvbXBpbGFibGVFeHRlbnNpb247XG5leHBvcnRzLmFkZFNvdXJjZU1hcHBpbmdVcmwgPSBhZGRTb3VyY2VNYXBwaW5nVXJsO1xuZXhwb3J0cy50cmFuc2Zvcm0gPSB0cmFuc2Zvcm07XG5leHBvcnRzLmNvbXBpbGUgPSBjb21waWxlO1xuZXhwb3J0cy5kZWxldGVEaXIgPSBkZWxldGVEaXI7XG5leHBvcnRzLnJlcXVpcmVDaG9raWRhciA9IHJlcXVpcmVDaG9raWRhcjtcbmV4cG9ydHMuYWRqdXN0UmVsYXRpdmUgPSBhZGp1c3RSZWxhdGl2ZTtcblxuZnVuY3Rpb24gX2ZzUmVhZGRpclJlY3Vyc2l2ZSgpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImZzLXJlYWRkaXItcmVjdXJzaXZlXCIpKTtcblxuICBfZnNSZWFkZGlyUmVjdXJzaXZlID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBiYWJlbCgpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCJAYmFiZWwvY29yZVwiKSk7XG5cbiAgYmFiZWwgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIF9pbmNsdWRlcygpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcImxvZGFzaC9pbmNsdWRlc1wiKSk7XG5cbiAgX2luY2x1ZGVzID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfcGF0aCgpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQocmVxdWlyZShcInBhdGhcIikpO1xuXG4gIF9wYXRoID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfZnMoKSB7XG4gIGNvbnN0IGRhdGEgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KHJlcXVpcmUoXCJmc1wiKSk7XG5cbiAgX2ZzID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfaW50ZXJvcFJlcXVpcmVXaWxkY2FyZChvYmopIHsgaWYgKG9iaiAmJiBvYmouX19lc01vZHVsZSkgeyByZXR1cm4gb2JqOyB9IGVsc2UgeyB2YXIgbmV3T2JqID0ge307IGlmIChvYmogIT0gbnVsbCkgeyBmb3IgKHZhciBrZXkgaW4gb2JqKSB7IGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqLCBrZXkpKSB7IHZhciBkZXNjID0gT2JqZWN0LmRlZmluZVByb3BlcnR5ICYmIE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IgPyBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKG9iaiwga2V5KSA6IHt9OyBpZiAoZGVzYy5nZXQgfHwgZGVzYy5zZXQpIHsgT2JqZWN0LmRlZmluZVByb3BlcnR5KG5ld09iaiwga2V5LCBkZXNjKTsgfSBlbHNlIHsgbmV3T2JqW2tleV0gPSBvYmpba2V5XTsgfSB9IH0gfSBuZXdPYmouZGVmYXVsdCA9IG9iajsgcmV0dXJuIG5ld09iajsgfSB9XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9XG5cbmZ1bmN0aW9uIGNobW9kKHNyYywgZGVzdCkge1xuICBfZnMoKS5kZWZhdWx0LmNobW9kU3luYyhkZXN0LCBfZnMoKS5kZWZhdWx0LnN0YXRTeW5jKHNyYykubW9kZSk7XG59XG5cbmZ1bmN0aW9uIHJlYWRkaXIoZGlybmFtZSwgaW5jbHVkZURvdGZpbGVzLCBmaWx0ZXIpIHtcbiAgcmV0dXJuICgwLCBfZnNSZWFkZGlyUmVjdXJzaXZlKCkuZGVmYXVsdCkoZGlybmFtZSwgKGZpbGVuYW1lLCBfaW5kZXgsIGN1cnJlbnREaXJlY3RvcnkpID0+IHtcbiAgICBjb25zdCBzdGF0ID0gX2ZzKCkuZGVmYXVsdC5zdGF0U3luYyhfcGF0aCgpLmRlZmF1bHQuam9pbihjdXJyZW50RGlyZWN0b3J5LCBmaWxlbmFtZSkpO1xuXG4gICAgaWYgKHN0YXQuaXNEaXJlY3RvcnkoKSkgcmV0dXJuIHRydWU7XG4gICAgcmV0dXJuIChpbmNsdWRlRG90ZmlsZXMgfHwgZmlsZW5hbWVbMF0gIT09IFwiLlwiKSAmJiAoIWZpbHRlciB8fCBmaWx0ZXIoZmlsZW5hbWUpKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJlYWRkaXJGb3JDb21waWxhYmxlKGRpcm5hbWUsIGluY2x1ZGVEb3RmaWxlcykge1xuICByZXR1cm4gcmVhZGRpcihkaXJuYW1lLCBpbmNsdWRlRG90ZmlsZXMsIGlzQ29tcGlsYWJsZUV4dGVuc2lvbik7XG59XG5cbmZ1bmN0aW9uIGlzQ29tcGlsYWJsZUV4dGVuc2lvbihmaWxlbmFtZSwgYWx0RXh0cykge1xuICBjb25zdCBleHRzID0gYWx0RXh0cyB8fCBiYWJlbCgpLkRFRkFVTFRfRVhURU5TSU9OUztcblxuICBjb25zdCBleHQgPSBfcGF0aCgpLmRlZmF1bHQuZXh0bmFtZShmaWxlbmFtZSk7XG5cbiAgcmV0dXJuICgwLCBfaW5jbHVkZXMoKS5kZWZhdWx0KShleHRzLCBleHQpO1xufVxuXG5mdW5jdGlvbiBhZGRTb3VyY2VNYXBwaW5nVXJsKGNvZGUsIGxvYykge1xuICByZXR1cm4gY29kZSArIFwiXFxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9XCIgKyBfcGF0aCgpLmRlZmF1bHQuYmFzZW5hbWUobG9jKTtcbn1cblxuY29uc3QgQ0FMTEVSID0ge1xuICBuYW1lOiBcIkBiYWJlbC9jbGlcIlxufTtcblxuZnVuY3Rpb24gdHJhbnNmb3JtKGZpbGVuYW1lLCBjb2RlLCBvcHRzKSB7XG4gIG9wdHMgPSBPYmplY3QuYXNzaWduKHt9LCBvcHRzLCB7XG4gICAgY2FsbGVyOiBDQUxMRVIsXG4gICAgZmlsZW5hbWVcbiAgfSk7XG4gIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgYmFiZWwoKS50cmFuc2Zvcm0oY29kZSwgb3B0cywgKGVyciwgcmVzdWx0KSA9PiB7XG4gICAgICBpZiAoZXJyKSByZWplY3QoZXJyKTtlbHNlIHJlc29sdmUocmVzdWx0KTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGNvbXBpbGUoZmlsZW5hbWUsIG9wdHMpIHtcbiAgb3B0cyA9IE9iamVjdC5hc3NpZ24oe30sIG9wdHMsIHtcbiAgICBjYWxsZXI6IENBTExFUlxuICB9KTtcbiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBiYWJlbCgpLnRyYW5zZm9ybUZpbGUoZmlsZW5hbWUsIG9wdHMsIChlcnIsIHJlc3VsdCkgPT4ge1xuICAgICAgaWYgKGVycikgcmVqZWN0KGVycik7ZWxzZSByZXNvbHZlKHJlc3VsdCk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBkZWxldGVEaXIocGF0aCkge1xuICBpZiAoX2ZzKCkuZGVmYXVsdC5leGlzdHNTeW5jKHBhdGgpKSB7XG4gICAgX2ZzKCkuZGVmYXVsdC5yZWFkZGlyU3luYyhwYXRoKS5mb3JFYWNoKGZ1bmN0aW9uIChmaWxlKSB7XG4gICAgICBjb25zdCBjdXJQYXRoID0gcGF0aCArIFwiL1wiICsgZmlsZTtcblxuICAgICAgaWYgKF9mcygpLmRlZmF1bHQubHN0YXRTeW5jKGN1clBhdGgpLmlzRGlyZWN0b3J5KCkpIHtcbiAgICAgICAgZGVsZXRlRGlyKGN1clBhdGgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgX2ZzKCkuZGVmYXVsdC51bmxpbmtTeW5jKGN1clBhdGgpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgX2ZzKCkuZGVmYXVsdC5ybWRpclN5bmMocGF0aCk7XG4gIH1cbn1cblxucHJvY2Vzcy5vbihcInVuY2F1Z2h0RXhjZXB0aW9uXCIsIGZ1bmN0aW9uIChlcnIpIHtcbiAgY29uc29sZS5lcnJvcihlcnIpO1xuICBwcm9jZXNzLmV4aXQoMSk7XG59KTtcblxuZnVuY3Rpb24gcmVxdWlyZUNob2tpZGFyKCkge1xuICB0cnkge1xuICAgIHJldHVybiByZXF1aXJlKFwiY2hva2lkYXJcIik7XG4gIH0gY2F0Y2ggKGVycikge1xuICAgIGNvbnNvbGUuZXJyb3IoXCJUaGUgb3B0aW9uYWwgZGVwZW5kZW5jeSBjaG9raWRhciBmYWlsZWQgdG8gaW5zdGFsbCBhbmQgaXMgcmVxdWlyZWQgZm9yIFwiICsgXCItLXdhdGNoLiBDaG9raWRhciBpcyBsaWtlbHkgbm90IHN1cHBvcnRlZCBvbiB5b3VyIHBsYXRmb3JtLlwiKTtcbiAgICB0aHJvdyBlcnI7XG4gIH1cbn1cblxuZnVuY3Rpb24gYWRqdXN0UmVsYXRpdmUocmVsYXRpdmUsIGtlZXBGaWxlRXh0ZW5zaW9uKSB7XG4gIGlmIChrZWVwRmlsZUV4dGVuc2lvbikge1xuICAgIHJldHVybiByZWxhdGl2ZTtcbiAgfVxuXG4gIHJldHVybiByZWxhdGl2ZS5yZXBsYWNlKC9cXC4oXFx3Kj8pJC8sIFwiXCIpICsgXCIuanNcIjtcbn0iXX0=