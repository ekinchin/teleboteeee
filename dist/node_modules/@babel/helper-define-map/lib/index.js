"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.push = push;
exports.hasComputed = hasComputed;
exports.toComputedObjectFromClass = toComputedObjectFromClass;
exports.toClassObject = toClassObject;
exports.toDefineObject = toDefineObject;

function _helperFunctionName() {
  const data = _interopRequireDefault(require("@babel/helper-function-name"));

  _helperFunctionName = function () {
    return data;
  };

  return data;
}

function _has() {
  const data = _interopRequireDefault(require("lodash/has"));

  _has = function () {
    return data;
  };

  return data;
}

function t() {
  const data = _interopRequireWildcard(require("@babel/types"));

  t = function () {
    return data;
  };

  return data;
}

function _interopRequireWildcard(obj) {
  if (obj && obj.__esModule) {
    return obj;
  } else {
    var newObj = {};

    if (obj != null) {
      for (var key in obj) {
        if (Object.prototype.hasOwnProperty.call(obj, key)) {
          var desc = Object.defineProperty && Object.getOwnPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : {};

          if (desc.get || desc.set) {
            Object.defineProperty(newObj, key, desc);
          } else {
            newObj[key] = obj[key];
          }
        }
      }
    }

    newObj.default = obj;
    return newObj;
  }
}

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : {
    default: obj
  };
}

function toKind(node) {
  if (t().isClassMethod(node) || t().isObjectMethod(node)) {
    if (node.kind === "get" || node.kind === "set") {
      return node.kind;
    }
  }

  return "value";
}

function push(mutatorMap, node, kind, file, scope) {
  const alias = t().toKeyAlias(node);
  let map = {};
  if ((0, _has().default)(mutatorMap, alias)) map = mutatorMap[alias];
  mutatorMap[alias] = map;
  map._inherits = map._inherits || [];

  map._inherits.push(node);

  map._key = node.key;

  if (node.computed) {
    map._computed = true;
  }

  if (node.decorators) {
    const decorators = map.decorators = map.decorators || t().arrayExpression([]);
    decorators.elements = decorators.elements.concat(node.decorators.map(dec => dec.expression).reverse());
  }

  if (map.value || map.initializer) {
    throw file.buildCodeFrameError(node, "Key conflict with sibling node");
  }

  let key, value;

  if (t().isObjectProperty(node) || t().isObjectMethod(node) || t().isClassMethod(node)) {
    key = t().toComputedKey(node, node.key);
  }

  if (t().isProperty(node)) {
    value = node.value;
  } else if (t().isObjectMethod(node) || t().isClassMethod(node)) {
    value = t().functionExpression(null, node.params, node.body, node.generator, node.async);
    value.returnType = node.returnType;
  }

  const inheritedKind = toKind(node);

  if (!kind || inheritedKind !== "value") {
    kind = inheritedKind;
  }

  if (scope && t().isStringLiteral(key) && (kind === "value" || kind === "initializer") && t().isFunctionExpression(value)) {
    value = (0, _helperFunctionName().default)({
      id: key,
      node: value,
      scope
    });
  }

  if (value) {
    t().inheritsComments(value, node);
    map[kind] = value;
  }

  return map;
}

function hasComputed(mutatorMap) {
  for (const key in mutatorMap) {
    if (mutatorMap[key]._computed) {
      return true;
    }
  }

  return false;
}

function toComputedObjectFromClass(obj) {
  const objExpr = t().arrayExpression([]);

  for (let i = 0; i < obj.properties.length; i++) {
    const prop = obj.properties[i];
    const val = prop.value;
    val.properties.unshift(t().objectProperty(t().identifier("key"), t().toComputedKey(prop)));
    objExpr.elements.push(val);
  }

  return objExpr;
}

function toClassObject(mutatorMap) {
  const objExpr = t().objectExpression([]);
  Object.keys(mutatorMap).forEach(function (mutatorMapKey) {
    const map = mutatorMap[mutatorMapKey];
    const mapNode = t().objectExpression([]);
    const propNode = t().objectProperty(map._key, mapNode, map._computed);
    Object.keys(map).forEach(function (key) {
      const node = map[key];
      if (key[0] === "_") return;
      const prop = t().objectProperty(t().identifier(key), node);
      t().inheritsComments(prop, node);
      t().removeComments(node);
      mapNode.properties.push(prop);
    });
    objExpr.properties.push(propNode);
  });
  return objExpr;
}

function toDefineObject(mutatorMap) {
  Object.keys(mutatorMap).forEach(function (key) {
    const map = mutatorMap[key];
    if (map.value) map.writable = t().booleanLiteral(true);
    map.configurable = t().booleanLiteral(true);
    map.enumerable = t().booleanLiteral(true);
  });
  return toClassObject(mutatorMap);
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL25vZGVfbW9kdWxlcy9AYmFiZWwvaGVscGVyLWRlZmluZS1tYXAvbGliL2luZGV4LmpzIl0sIm5hbWVzIjpbIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZXhwb3J0cyIsInZhbHVlIiwicHVzaCIsImhhc0NvbXB1dGVkIiwidG9Db21wdXRlZE9iamVjdEZyb21DbGFzcyIsInRvQ2xhc3NPYmplY3QiLCJ0b0RlZmluZU9iamVjdCIsIl9oZWxwZXJGdW5jdGlvbk5hbWUiLCJkYXRhIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfaGFzIiwidCIsIl9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkIiwib2JqIiwiX19lc01vZHVsZSIsIm5ld09iaiIsImtleSIsInByb3RvdHlwZSIsImhhc093blByb3BlcnR5IiwiY2FsbCIsImRlc2MiLCJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IiLCJnZXQiLCJzZXQiLCJkZWZhdWx0IiwidG9LaW5kIiwibm9kZSIsImlzQ2xhc3NNZXRob2QiLCJpc09iamVjdE1ldGhvZCIsImtpbmQiLCJtdXRhdG9yTWFwIiwiZmlsZSIsInNjb3BlIiwiYWxpYXMiLCJ0b0tleUFsaWFzIiwibWFwIiwiX2luaGVyaXRzIiwiX2tleSIsImNvbXB1dGVkIiwiX2NvbXB1dGVkIiwiZGVjb3JhdG9ycyIsImFycmF5RXhwcmVzc2lvbiIsImVsZW1lbnRzIiwiY29uY2F0IiwiZGVjIiwiZXhwcmVzc2lvbiIsInJldmVyc2UiLCJpbml0aWFsaXplciIsImJ1aWxkQ29kZUZyYW1lRXJyb3IiLCJpc09iamVjdFByb3BlcnR5IiwidG9Db21wdXRlZEtleSIsImlzUHJvcGVydHkiLCJmdW5jdGlvbkV4cHJlc3Npb24iLCJwYXJhbXMiLCJib2R5IiwiZ2VuZXJhdG9yIiwiYXN5bmMiLCJyZXR1cm5UeXBlIiwiaW5oZXJpdGVkS2luZCIsImlzU3RyaW5nTGl0ZXJhbCIsImlzRnVuY3Rpb25FeHByZXNzaW9uIiwiaWQiLCJpbmhlcml0c0NvbW1lbnRzIiwib2JqRXhwciIsImkiLCJwcm9wZXJ0aWVzIiwibGVuZ3RoIiwicHJvcCIsInZhbCIsInVuc2hpZnQiLCJvYmplY3RQcm9wZXJ0eSIsImlkZW50aWZpZXIiLCJvYmplY3RFeHByZXNzaW9uIiwia2V5cyIsImZvckVhY2giLCJtdXRhdG9yTWFwS2V5IiwibWFwTm9kZSIsInByb3BOb2RlIiwicmVtb3ZlQ29tbWVudHMiLCJ3cml0YWJsZSIsImJvb2xlYW5MaXRlcmFsIiwiY29uZmlndXJhYmxlIiwiZW51bWVyYWJsZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUFBLE1BQU0sQ0FBQ0MsY0FBUCxDQUFzQkMsT0FBdEIsRUFBK0IsWUFBL0IsRUFBNkM7QUFDM0NDLEVBQUFBLEtBQUssRUFBRTtBQURvQyxDQUE3QztBQUdBRCxPQUFPLENBQUNFLElBQVIsR0FBZUEsSUFBZjtBQUNBRixPQUFPLENBQUNHLFdBQVIsR0FBc0JBLFdBQXRCO0FBQ0FILE9BQU8sQ0FBQ0kseUJBQVIsR0FBb0NBLHlCQUFwQztBQUNBSixPQUFPLENBQUNLLGFBQVIsR0FBd0JBLGFBQXhCO0FBQ0FMLE9BQU8sQ0FBQ00sY0FBUixHQUF5QkEsY0FBekI7O0FBRUEsU0FBU0MsbUJBQVQsR0FBK0I7QUFDN0IsUUFBTUMsSUFBSSxHQUFHQyxzQkFBc0IsQ0FBQ0MsT0FBTyxDQUFDLDZCQUFELENBQVIsQ0FBbkM7O0FBRUFILEVBQUFBLG1CQUFtQixHQUFHLFlBQVk7QUFDaEMsV0FBT0MsSUFBUDtBQUNELEdBRkQ7O0FBSUEsU0FBT0EsSUFBUDtBQUNEOztBQUVELFNBQVNHLElBQVQsR0FBZ0I7QUFDZCxRQUFNSCxJQUFJLEdBQUdDLHNCQUFzQixDQUFDQyxPQUFPLENBQUMsWUFBRCxDQUFSLENBQW5DOztBQUVBQyxFQUFBQSxJQUFJLEdBQUcsWUFBWTtBQUNqQixXQUFPSCxJQUFQO0FBQ0QsR0FGRDs7QUFJQSxTQUFPQSxJQUFQO0FBQ0Q7O0FBRUQsU0FBU0ksQ0FBVCxHQUFhO0FBQ1gsUUFBTUos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QUFDNEMsUUFBSixHQUFlcEUsQ0FBQyxHQUFHcUUsY0FBSixDQUFtQixJQUFuQixDQUFmO0FBQ2Y3QyxJQUFBQSxHQUFHLENBQUM4QyxZQUFKLEdBQW1CdEUsQ0FBQyxHQUFHcUUsY0FBSixDQUFtQixJQUFuQixDQUFuQjtBQUNBN0MsSUFBQUEsR0FBRyxDQUFDK0MsVUFBSixHQUFpQnZFLENBQUMsR0FBR3FFLGNBQUosQ0FBbUIsSUFBbkIsQ0FBakI7QUFDRCxHQUxEO0FBTUEsU0FBTzVFLGFBQWEsQ0FBQzBCLFVBQUQsQ0FBcEI7QUFDRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHtcbiAgdmFsdWU6IHRydWVcbn0pO1xuZXhwb3J0cy5wdXNoID0gcHVzaDtcbmV4cG9ydHMuaGFzQ29tcHV0ZWQgPSBoYXNDb21wdXRlZDtcbmV4cG9ydHMudG9Db21wdXRlZE9iamVjdEZyb21DbGFzcyA9IHRvQ29tcHV0ZWRPYmplY3RGcm9tQ2xhc3M7XG5leHBvcnRzLnRvQ2xhc3NPYmplY3QgPSB0b0NsYXNzT2JqZWN0O1xuZXhwb3J0cy50b0RlZmluZU9iamVjdCA9IHRvRGVmaW5lT2JqZWN0O1xuXG5mdW5jdGlvbiBfaGVscGVyRnVuY3Rpb25OYW1lKCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwiQGJhYmVsL2hlbHBlci1mdW5jdGlvbi1uYW1lXCIpKTtcblxuICBfaGVscGVyRnVuY3Rpb25OYW1lID0gZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiBkYXRhO1xuICB9O1xuXG4gIHJldHVybiBkYXRhO1xufVxuXG5mdW5jdGlvbiBfaGFzKCkge1xuICBjb25zdCBkYXRhID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChyZXF1aXJlKFwibG9kYXNoL2hhc1wiKSk7XG5cbiAgX2hhcyA9IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gZGF0YTtcbiAgfTtcblxuICByZXR1cm4gZGF0YTtcbn1cblxuZnVuY3Rpb24gdCgpIHtcbiAgY29uc3QgZGF0YSA9IF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKHJlcXVpcmUoXCJAYmFiZWwvdHlwZXNcIikpO1xuXG4gIHQgPSBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIGRhdGE7XG4gIH07XG5cbiAgcmV0dXJuIGRhdGE7XG59XG5cbmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZVdpbGRjYXJkKG9iaikgeyBpZiAob2JqICYmIG9iai5fX2VzTW9kdWxlKSB7IHJldHVybiBvYmo7IH0gZWxzZSB7IHZhciBuZXdPYmogPSB7fTsgaWYgKG9iaiAhPSBudWxsKSB7IGZvciAodmFyIGtleSBpbiBvYmopIHsgaWYgKE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmosIGtleSkpIHsgdmFyIGRlc2MgPSBPYmplY3QuZGVmaW5lUHJvcGVydHkgJiYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciA/IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Iob2JqLCBrZXkpIDoge307IGlmIChkZXNjLmdldCB8fCBkZXNjLnNldCkgeyBPYmplY3QuZGVmaW5lUHJvcGVydHkobmV3T2JqLCBrZXksIGRlc2MpOyB9IGVsc2UgeyBuZXdPYmpba2V5XSA9IG9ialtrZXldOyB9IH0gfSB9IG5ld09iai5kZWZhdWx0ID0gb2JqOyByZXR1cm4gbmV3T2JqOyB9IH1cblxuZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH1cblxuZnVuY3Rpb24gdG9LaW5kKG5vZGUpIHtcbiAgaWYgKHQoKS5pc0NsYXNzTWV0aG9kKG5vZGUpIHx8IHQoKS5pc09iamVjdE1ldGhvZChub2RlKSkge1xuICAgIGlmIChub2RlLmtpbmQgPT09IFwiZ2V0XCIgfHwgbm9kZS5raW5kID09PSBcInNldFwiKSB7XG4gICAgICByZXR1cm4gbm9kZS5raW5kO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBcInZhbHVlXCI7XG59XG5cbmZ1bmN0aW9uIHB1c2gobXV0YXRvck1hcCwgbm9kZSwga2luZCwgZmlsZSwgc2NvcGUpIHtcbiAgY29uc3QgYWxpYXMgPSB0KCkudG9LZXlBbGlhcyhub2RlKTtcbiAgbGV0IG1hcCA9IHt9O1xuICBpZiAoKDAsIF9oYXMoKS5kZWZhdWx0KShtdXRhdG9yTWFwLCBhbGlhcykpIG1hcCA9IG11dGF0b3JNYXBbYWxpYXNdO1xuICBtdXRhdG9yTWFwW2FsaWFzXSA9IG1hcDtcbiAgbWFwLl9pbmhlcml0cyA9IG1hcC5faW5oZXJpdHMgfHwgW107XG5cbiAgbWFwLl9pbmhlcml0cy5wdXNoKG5vZGUpO1xuXG4gIG1hcC5fa2V5ID0gbm9kZS5rZXk7XG5cbiAgaWYgKG5vZGUuY29tcHV0ZWQpIHtcbiAgICBtYXAuX2NvbXB1dGVkID0gdHJ1ZTtcbiAgfVxuXG4gIGlmIChub2RlLmRlY29yYXRvcnMpIHtcbiAgICBjb25zdCBkZWNvcmF0b3JzID0gbWFwLmRlY29yYXRvcnMgPSBtYXAuZGVjb3JhdG9ycyB8fCB0KCkuYXJyYXlFeHByZXNzaW9uKFtdKTtcbiAgICBkZWNvcmF0b3JzLmVsZW1lbnRzID0gZGVjb3JhdG9ycy5lbGVtZW50cy5jb25jYXQobm9kZS5kZWNvcmF0b3JzLm1hcChkZWMgPT4gZGVjLmV4cHJlc3Npb24pLnJldmVyc2UoKSk7XG4gIH1cblxuICBpZiAobWFwLnZhbHVlIHx8IG1hcC5pbml0aWFsaXplcikge1xuICAgIHRocm93IGZpbGUuYnVpbGRDb2RlRnJhbWVFcnJvcihub2RlLCBcIktleSBjb25mbGljdCB3aXRoIHNpYmxpbmcgbm9kZVwiKTtcbiAgfVxuXG4gIGxldCBrZXksIHZhbHVlO1xuXG4gIGlmICh0KCkuaXNPYmplY3RQcm9wZXJ0eShub2RlKSB8fCB0KCkuaXNPYmplY3RNZXRob2Qobm9kZSkgfHwgdCgpLmlzQ2xhc3NNZXRob2Qobm9kZSkpIHtcbiAgICBrZXkgPSB0KCkudG9Db21wdXRlZEtleShub2RlLCBub2RlLmtleSk7XG4gIH1cblxuICBpZiAodCgpLmlzUHJvcGVydHkobm9kZSkpIHtcbiAgICB2YWx1ZSA9IG5vZGUudmFsdWU7XG4gIH0gZWxzZSBpZiAodCgpLmlzT2JqZWN0TWV0aG9kKG5vZGUpIHx8IHQoKS5pc0NsYXNzTWV0aG9kKG5vZGUpKSB7XG4gICAgdmFsdWUgPSB0KCkuZnVuY3Rpb25FeHByZXNzaW9uKG51bGwsIG5vZGUucGFyYW1zLCBub2RlLmJvZHksIG5vZGUuZ2VuZXJhdG9yLCBub2RlLmFzeW5jKTtcbiAgICB2YWx1ZS5yZXR1cm5UeXBlID0gbm9kZS5yZXR1cm5UeXBlO1xuICB9XG5cbiAgY29uc3QgaW5oZXJpdGVkS2luZCA9IHRvS2luZChub2RlKTtcblxuICBpZiAoIWtpbmQgfHwgaW5oZXJpdGVkS2luZCAhPT0gXCJ2YWx1ZVwiKSB7XG4gICAga2luZCA9IGluaGVyaXRlZEtpbmQ7XG4gIH1cblxuICBpZiAoc2NvcGUgJiYgdCgpLmlzU3RyaW5nTGl0ZXJhbChrZXkpICYmIChraW5kID09PSBcInZhbHVlXCIgfHwga2luZCA9PT0gXCJpbml0aWFsaXplclwiKSAmJiB0KCkuaXNGdW5jdGlvbkV4cHJlc3Npb24odmFsdWUpKSB7XG4gICAgdmFsdWUgPSAoMCwgX2hlbHBlckZ1bmN0aW9uTmFtZSgpLmRlZmF1bHQpKHtcbiAgICAgIGlkOiBrZXksXG4gICAgICBub2RlOiB2YWx1ZSxcbiAgICAgIHNjb3BlXG4gICAgfSk7XG4gIH1cblxuICBpZiAodmFsdWUpIHtcbiAgICB0KCkuaW5oZXJpdHNDb21tZW50cyh2YWx1ZSwgbm9kZSk7XG4gICAgbWFwW2tpbmRdID0gdmFsdWU7XG4gIH1cblxuICByZXR1cm4gbWFwO1xufVxuXG5mdW5jdGlvbiBoYXNDb21wdXRlZChtdXRhdG9yTWFwKSB7XG4gIGZvciAoY29uc3Qga2V5IGluIG11dGF0b3JNYXApIHtcbiAgICBpZiAobXV0YXRvck1hcFtrZXldLl9jb21wdXRlZCkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIGZhbHNlO1xufVxuXG5mdW5jdGlvbiB0b0NvbXB1dGVkT2JqZWN0RnJvbUNsYXNzKG9iaikge1xuICBjb25zdCBvYmpFeHByID0gdCgpLmFycmF5RXhwcmVzc2lvbihbXSk7XG5cbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBvYmoucHJvcGVydGllcy5sZW5ndGg7IGkrKykge1xuICAgIGNvbnN0IHByb3AgPSBvYmoucHJvcGVydGllc1tpXTtcbiAgICBjb25zdCB2YWwgPSBwcm9wLnZhbHVlO1xuICAgIHZhbC5wcm9wZXJ0aWVzLnVuc2hpZnQodCgpLm9iamVjdFByb3BlcnR5KHQoKS5pZGVudGlmaWVyKFwia2V5XCIpLCB0KCkudG9Db21wdXRlZEtleShwcm9wKSkpO1xuICAgIG9iakV4cHIuZWxlbWVudHMucHVzaCh2YWwpO1xuICB9XG5cbiAgcmV0dXJuIG9iakV4cHI7XG59XG5cbmZ1bmN0aW9uIHRvQ2xhc3NPYmplY3QobXV0YXRvck1hcCkge1xuICBjb25zdCBvYmpFeHByID0gdCgpLm9iamVjdEV4cHJlc3Npb24oW10pO1xuICBPYmplY3Qua2V5cyhtdXRhdG9yTWFwKS5mb3JFYWNoKGZ1bmN0aW9uIChtdXRhdG9yTWFwS2V5KSB7XG4gICAgY29uc3QgbWFwID0gbXV0YXRvck1hcFttdXRhdG9yTWFwS2V5XTtcbiAgICBjb25zdCBtYXBOb2RlID0gdCgpLm9iamVjdEV4cHJlc3Npb24oW10pO1xuICAgIGNvbnN0IHByb3BOb2RlID0gdCgpLm9iamVjdFByb3BlcnR5KG1hcC5fa2V5LCBtYXBOb2RlLCBtYXAuX2NvbXB1dGVkKTtcbiAgICBPYmplY3Qua2V5cyhtYXApLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgICAgY29uc3Qgbm9kZSA9IG1hcFtrZXldO1xuICAgICAgaWYgKGtleVswXSA9PT0gXCJfXCIpIHJldHVybjtcbiAgICAgIGNvbnN0IHByb3AgPSB0KCkub2JqZWN0UHJvcGVydHkodCgpLmlkZW50aWZpZXIoa2V5KSwgbm9kZSk7XG4gICAgICB0KCkuaW5oZXJpdHNDb21tZW50cyhwcm9wLCBub2RlKTtcbiAgICAgIHQoKS5yZW1vdmVDb21tZW50cyhub2RlKTtcbiAgICAgIG1hcE5vZGUucHJvcGVydGllcy5wdXNoKHByb3ApO1xuICAgIH0pO1xuICAgIG9iakV4cHIucHJvcGVydGllcy5wdXNoKHByb3BOb2RlKTtcbiAgfSk7XG4gIHJldHVybiBvYmpFeHByO1xufVxuXG5mdW5jdGlvbiB0b0RlZmluZU9iamVjdChtdXRhdG9yTWFwKSB7XG4gIE9iamVjdC5rZXlzKG11dGF0b3JNYXApLmZvckVhY2goZnVuY3Rpb24gKGtleSkge1xuICAgIGNvbnN0IG1hcCA9IG11dGF0b3JNYXBba2V5XTtcbiAgICBpZiAobWFwLnZhbHVlKSBtYXAud3JpdGFibGUgPSB0KCkuYm9vbGVhbkxpdGVyYWwodHJ1ZSk7XG4gICAgbWFwLmNvbmZpZ3VyYWJsZSA9IHQoKS5ib29sZWFuTGl0ZXJhbCh0cnVlKTtcbiAgICBtYXAuZW51bWVyYWJsZSA9IHQoKS5ib29sZWFuTGl0ZXJhbCh0cnVlKTtcbiAgfSk7XG4gIHJldHVybiB0b0NsYXNzT2JqZWN0KG11dGF0b3JNYXApO1xufSJdfQ==